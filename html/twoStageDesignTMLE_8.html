<div class="container">

<table style="width: 100%;"><tr>
<td>twoStageTMLE</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>twoStageTMLE</h2>

<h3>Description</h3>

<p>Inverse probability of censoring weighted TMLE for evaluating
parameters when the full set of covariates is available on only
a subset of observations.
</p>


<h3>Usage</h3>

<pre><code class="language-R">twoStageTMLE(
  Y,
  A,
  W,
  Delta.W,
  W.stage2,
  Z = NULL,
  Delta = rep(1, length(Y)),
  pi = NULL,
  piform = NULL,
  pi.SL.library = c("SL.glm", "SL.gam", "SL.glmnet", "tmle.SL.dbarts.k.5"),
  V.pi = 10,
  pi.discreteSL = TRUE,
  condSetNames = c("A", "W", "Y"),
  id = NULL,
  Q.family = "gaussian",
  augmentW = TRUE,
  augW.SL.library = c("SL.glm", "SL.glmnet", "tmle.SL.dbarts2"),
  rareOutcome = FALSE,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>outcome</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>binary treatment indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>
<p>covariate matrix observed on everyone</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Delta.W</code></td>
<td>
<p>binary indicator of missing second stage covariates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W.stage2</code></td>
<td>
<p>matrix of second stage covariates observed on subset
of observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>optional mediator of treatment effect for evaluating a
controlled direct effect</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Delta</code></td>
<td>
<p>binary indicator of missing value for outcome <code>Y</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi</code></td>
<td>
<p>optional vector of missingness probabilities for <code>W.stage2</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>piform</code></td>
<td>
<p>parametric regression formula for estimating <code>pi</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi.SL.library</code></td>
<td>
<p>super learner library for estimating <code>pi</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V.pi</code></td>
<td>
<p>number of cross validation folds for estimating <code>pi</code>
using super learner</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi.discreteSL</code></td>
<td>
<p>Use discrete super learning when <code>TRUE</code>, otherwise
ensemble super learning</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condSetNames</code></td>
<td>
<p>Variables to include as predictors of missingness
in <code>W.stage2</code>, any combination of <code>Y, A</code>, and either <code>W</code> (for all
covariates in <code>W</code>), or individual covariate names in <code>W</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>Identifier of independent units of observation, e.g., clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q.family</code></td>
<td>
<p>Regression family for the outcome</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>augmentW</code></td>
<td>
<p>When <code>TRUE</code> include predicted values for the outcome
the set of covariates used to model the propensity score</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>augW.SL.library</code></td>
<td>
<p>super learner library for preliminary outcome
regression model (ignored when <code>augmentW</code> is <code>FALSE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rareOutcome</code></td>
<td>
<p>When <code>TRUE</code> specifies less ambitious SL for Q in call
to <code>tmle</code> (discreteSL, glm, glmnet, bart library, <code>V=20</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>When <code>TRUE</code> prints informational messages</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other parameters passed to the tmle function (not checked)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>object of class 'twoStageTMLE'.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>tmle</code></td>
<td>
<p>Treatment effect estimates and summary information</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>twoStage</code></td>
<td>
<p>IPCW weight estimation summary, <code>pi</code> are the probabilities,
<code>coef</code> are SL weights or coefficients from glm fit, <code>type</code> of
estimation procedure, <code>discreteSL</code> flag indicating whether discrete
super learning was used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>augW</code></td>
<td>
<p>Matrix of predicted outcomes based on stage 1 covariates only</p>
</td>
</tr>
</table>
<h3>See Also</h3>


<ul>
<li> <p><code>tmle::tmle()</code> for details on customizing the estimation procedure
</p>
</li>
<li> <p><code>twoStageTMLEmsm()</code> for estimating conditional effects
</p>
</li>
<li>
<p> S Rose and MJ van der Laan. A Targeted Maximum Likelihood Estimator for
Two-Stage Designs. <em>Int J Biostat.</em> 2011 Jan 1; 7(1): 17.
<a href="https://doi.org/10.2202/1557-4679.1217">doi:10.2202/1557-4679.1217</a>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">n &lt;- 1000
W1 &lt;- rnorm(n)
W2 &lt;- rnorm(n)
W3 &lt;- rnorm(n)
A &lt;- rbinom(n, 1, plogis(-1 + .2*W1 + .3*W2 + .1*W3))
Y &lt;- 10 + A + W1 + W2 + A*W1 + W3 + rnorm(n)
d &lt;- data.frame(Y, A, W1, W2, W3)
# Set 400 with data on W3, more likely if W1 &gt; 1
n.sample &lt;- 400
p.sample &lt;- 0.5 + .2*(W1 &gt; 1)
rows.sample &lt;- sample(1:n, size = n.sample, p = p.sample)
Delta.W &lt;- rep(0,n)
Delta.W[rows.sample] &lt;- 1
W3.stage2 &lt;- cbind(W3 = W3[Delta.W==1])
#1. specify parametric models and do not augment W (fast, but not recommended)
result1 &lt;- twoStageTMLE(Y=Y, A=A, W=cbind(W1, W2), Delta.W = Delta.W, 
   W.stage2 = W3.stage2, piform = "Delta.W~ I(W1 &gt; 0)", V.pi= 5,verbose = TRUE, 
   Qform = "Y~A+W1",gform="A~W1 + W2 +W3", augmentW = FALSE)
summary(result1)

#2. specify a parametric model for conditional missingness probabilities (pi)
#   and use default values to estimate marginal effect using \code{tmle}
result2 &lt;- twoStageTMLE(Y=Y, A=A, W=cbind(W1, W2), Delta.W = Delta.W, 
     W.stage2 = cbind(W3)[Delta.W == 1], piform = "Delta.W~ I(W1 &gt; 0)", 
     V.pi= 5,verbose = TRUE)
result2

</code></pre>


</div>