<div class="container">

<table style="width: 100%;"><tr>
<td>simulate_tci</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate open- or closed-loop control</h2>

<h3>Description</h3>

<p>Simulate responses from a 'pkmod' or 'poppkmod' object using TCI control.
Infusion rates are calculated to reach targets using 'pkmod_prior'. Data values
are simulated using 'pkmod_true'. 'pkmod_prior' and 'pkmod_true' do not need to
have the same parameters or structure and should be different when simulating
responses under model misspecification.
If update times (argument 'update_tms') are provided then the function 'simulate_clc'
is called for "closed-loop" control and model parameters will be updated via
Bayes' rule using available data. Only parameters with values in the Omega matrix
will be updated. A data processing delay can be added through the argument 'delay'.
See ?bayes_update? for more details. If update times are not specified, then
the function 'simulate_olc' will be called to implement "open-loop" control
and model parameters will not be updated. Simulation results have class 'tci_sim'
and can be plotted using 'plot.tci_sim()'.
</p>


<h3>Usage</h3>

<pre><code class="language-R">simulate_tci(
  pkmod_prior,
  pkmod_true,
  target_vals,
  target_tms,
  obs_tms,
  update_tms = NULL,
  type = c("effect", "plasma"),
  custom_alg = NULL,
  resp_bounds = NULL,
  delay = 0,
  seed = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkmod_prior</code></td>
<td>
<p>'pkmod' or 'poppkmod' object describing a PK/PK-PD model that is used to calculate
TCI infusion rates and is updated as data are simulated and incorporated. Must have an
associated Omega matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pkmod_true</code></td>
<td>
<p>‘pkmod' or 'poppkmod' object describing the patient’s "true" response. This model
will be used to simulate observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_vals</code></td>
<td>
<p>A vector of numeric values indicating PK or PD targets for TCI algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_tms</code></td>
<td>
<p>A vector of numeric values indicating times at which the TCI algorithm should
begin targeting each value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_tms</code></td>
<td>
<p>Times at which data values should be simulated from 'pkmod_true'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>update_tms</code></td>
<td>
<p>Times at which 'pkmod_prior' should be updated using all available
simulated observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of TCI algorithm to be used. Options are "plasma" and "effect".
Defaults to "effect". Will be overwritten if 'custom_alg' is non-null.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>custom_alg</code></td>
<td>
<p>Custom TCI algorithm to overwrite default plasma- or effect-site targeting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp_bounds</code></td>
<td>
<p>Optional vector of two values indicating minimum and maximum values possible for the response.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delay</code></td>
<td>
<p>Optional numeric value indicating a temporal delay between when observations
are simulated and when they should be made available for updating 'pkmod_prior'. For example,
a delay should be set to account for a processing time delay in Bispectral Index measurements
or the time required to measure drug concentrations from collected samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>An integer used to initialize the random number generator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. Print progress as simulation is run.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">data &lt;- data.frame(ID = 1:3, AGE = c(20,30,40), TBW = c(60,70,80),
HGT = c(150,160,170), MALE = c(TRUE,FALSE,TRUE))
pkmod_prior &lt;- poppkmod(data, drug = "ppf", model = "eleveld")
pkmod_true  &lt;- poppkmod(data, drug = "ppf", model = "eleveld", sample = TRUE)
obs_tms &lt;- seq(1/6,10,1/6)
target_vals = c(75,60,50,50)
target_tms = c(0,3,6,10)

# open-loop simulation (without updates)
sim_ol &lt;- simulate_tci(pkmod_prior, pkmod_true, target_vals, target_tms, obs_tms,
seed = 200)
plot(sim_ol)

# closed-loop simulation (with updates)
## Not run: 
sim_cl &lt;- simulate_tci(pkmod_prior, pkmod_true, target_vals, target_tms, obs_tms,
update_tms = c(2,4,6,8), seed = 200)
plot(sim_cl, wrap_id = TRUE, show_inf = TRUE, show_data = TRUE)

## End(Not run)
</code></pre>


</div>