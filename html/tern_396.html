<div class="container">

<table style="width: 100%;"><tr>
<td>cox_regression</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cox proportional hazards regression</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>Fits a Cox regression model and estimates hazard ratio to describe the effect size in a survival analysis.
</p>


<h3>Usage</h3>

<pre><code class="language-R">summarize_coxreg(
  lyt,
  variables,
  control = control_coxreg(),
  at = list(),
  multivar = FALSE,
  common_var = "STUDYID",
  .stats = c("n", "hr", "ci", "pval", "pval_inter"),
  .formats = c(n = "xx", hr = "xx.xx", ci = "(xx.xx, xx.xx)", pval =
    "x.xxxx | (&lt;0.0001)", pval_inter = "x.xxxx | (&lt;0.0001)"),
  varlabels = NULL,
  .indent_mods = NULL,
  na_str = "",
  .section_div = NA_character_
)

s_coxreg(model_df, .stats, .which_vars = "all", .var_nms = NULL)

a_coxreg(
  df,
  labelstr,
  eff = FALSE,
  var_main = FALSE,
  multivar = FALSE,
  variables,
  at = list(),
  control = control_coxreg(),
  .spl_context,
  .stats,
  .formats,
  .indent_mods = NULL,
  na_str = "",
  cache_env = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lyt</code></td>
<td>
<p>(<code>PreDataTableLayouts</code>)<br> layout that analyses will be added to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>(named <code>list</code> of <code>string</code>)<br> list of additional analysis variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>(<code>list</code>)<br> a list of parameters as returned by the helper function <code>control_coxreg()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>at</code></td>
<td>
<p>(<code>list</code> of <code>numeric</code>)<br> when the candidate covariate is a <code>numeric</code>, use <code>at</code> to specify
the value of the covariate at which the effect should be estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>multivar</code></td>
<td>
<p>(<code>flag</code>)<br> whether multivariate Cox regression should run (defaults to <code>FALSE</code>), otherwise
univariate Cox regression will run.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>common_var</code></td>
<td>
<p>(<code>string</code>)<br> the name of a factor variable in the dataset which takes the same value
for all rows. This should be created during pre-processing if no such variable currently exists.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.stats</code></td>
<td>
<p>(<code>character</code>)<br> the names of statistics to be reported among:
</p>

<ul>
<li> <p><code>n</code>: number of observations (univariate only)
</p>
</li>
<li> <p><code>hr</code>: hazard ratio
</p>
</li>
<li> <p><code>ci</code>: confidence interval
</p>
</li>
<li> <p><code>pval</code>: p-value of the treatment effect
</p>
</li>
<li> <p><code>pval_inter</code>: p-value of the interaction effect between the treatment and the covariate (univariate only)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.formats</code></td>
<td>
<p>(named <code>character</code> or <code>list</code>)<br> formats for the statistics. See Details in <code>analyze_vars</code> for more
information on the <code>"auto"</code> setting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varlabels</code></td>
<td>
<p>(<code>list</code>)<br> a named list corresponds to the names of variables found in data, passed
as a named list and corresponding to time, event, arm, strata, and covariates terms. If arm is missing
from variables, then only Cox model(s) including the covariates will be fitted and the corresponding
effect estimates will be tabulated later.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.indent_mods</code></td>
<td>
<p>(named <code>integer</code>)<br> indent modifiers for the labels. Defaults to 0, which corresponds to the
unmodified default behavior. Can be negative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_str</code></td>
<td>
<p>(<code>string</code>)<br> custom string to replace all <code>NA</code> values with. Defaults to <code>""</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.section_div</code></td>
<td>
<p>(<code>string</code> or <code>NA</code>)<br> string which should be repeated as a section divider between sections.
Defaults to <code>NA</code> for no section divider. If a vector of two strings are given, the first will be used between
treatment and covariate sections and the second between different covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_df</code></td>
<td>
<p>(<code>data.frame</code>)<br> contains the resulting model fit from a fit_coxreg
function with tidying applied via <code>broom::tidy()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.which_vars</code></td>
<td>
<p>(<code>character</code>)<br> which rows should statistics be returned for from the given model.
Defaults to <code>"all"</code>. Other options include <code>"var_main"</code> for main effects, <code>"inter"</code> for interaction effects,
and <code>"multi_lvl"</code> for multivariate model covariate level rows. When <code>.which_vars</code> is <code>"all"</code>, specific
variables can be selected by specifying <code>.var_nms</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.var_nms</code></td>
<td>
<p>(<code>character</code>)<br> the <code>term</code> value of rows in <code>df</code> for which <code>.stats</code> should be returned. Typically
this is the name of a variable. If using variable labels, <code>var</code> should be a vector of both the desired
variable name and the variable label in that order to see all <code>.stats</code> related to that variable. When <code>.which_vars</code>
is <code>"var_main"</code>, <code>.var_nms</code> should be only the variable name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>(<code>data.frame</code>)<br> data set containing all analysis variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelstr</code></td>
<td>
<p>(<code>string</code>)<br> label of the level of the parent split currently being summarized
(must be present as second argument in Content Row Functions). See <code>rtables::summarize_row_groups()</code>
for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eff</code></td>
<td>
<p>(<code>flag</code>)<br> whether treatment effect should be calculated. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_main</code></td>
<td>
<p>(<code>flag</code>)<br> whether main effects should be calculated. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.spl_context</code></td>
<td>
<p>(<code>data.frame</code>)<br> gives information about ancestor split states
that is passed by <code>rtables</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache_env</code></td>
<td>
<p>(<code>environment</code>)<br> an environment object used to cache the regression model in order to
avoid repeatedly fitting the same model for every row in the table. Defaults to <code>NULL</code> (no caching).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Cox models are the most commonly used methods to estimate the magnitude of
the effect in survival analysis. It assumes proportional hazards: the ratio
of the hazards between groups (e.g., two arms) is constant over time.
This ratio is referred to as the "hazard ratio" (HR) and is one of the
most commonly reported metrics to describe the effect size in survival
analysis (NEST Team, 2020).
</p>


<h3>Value</h3>


<ul><li> <p><code>summarize_coxreg()</code> returns a layout object suitable for passing to further layouting functions,
or to <code>rtables::build_table()</code>. Adding this function to an <code>rtable</code> layout will add a Cox regression table
containing the chosen statistics to the table layout.
</p>
</li></ul>
<ul><li> <p><code>s_coxreg()</code> returns the selected statistic for from the Cox regression model for the selected variable(s).
</p>
</li></ul>
<ul><li> <p><code>a_coxreg()</code> returns formatted <code>rtables::CellValue()</code>.
</p>
</li></ul>
<h3>Functions</h3>


<ul>
<li> <p><code>summarize_coxreg()</code>: Layout-creating function which creates a Cox regression summary table
layout. This function is a wrapper for several <code>rtables</code> layouting functions. This function
is a wrapper for <code>rtables::analyze_colvars()</code> and <code>rtables::summarize_row_groups()</code>.
</p>
</li>
<li> <p><code>s_coxreg()</code>: Statistics function that transforms results tabulated
from <code>fit_coxreg_univar()</code> or <code>fit_coxreg_multivar()</code> into a list.
</p>
</li>
<li> <p><code>a_coxreg()</code>: Analysis function which is used as <code>afun</code> in <code>rtables::analyze()</code>
and <code>cfun</code> in <code>rtables::summarize_row_groups()</code> within <code>summarize_coxreg()</code>.
</p>
</li>
</ul>
<h3>See Also</h3>

<p>fit_coxreg for relevant fitting functions, h_cox_regression for relevant
helper functions, and tidy_coxreg for custom tidy methods.
</p>
<p><code>fit_coxreg_univar()</code> and <code>fit_coxreg_multivar()</code> which also take the <code>variables</code>, <code>data</code>,
<code>at</code> (univariate only), and <code>control</code> arguments but return unformatted univariate and multivariate
Cox regression models, respectively.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(survival)

# Testing dataset [survival::bladder].
set.seed(1, kind = "Mersenne-Twister")
dta_bladder &lt;- with(
  data = bladder[bladder$enum &lt; 5, ],
  tibble::tibble(
    TIME = stop,
    STATUS = event,
    ARM = as.factor(rx),
    COVAR1 = as.factor(enum) %&gt;% formatters::with_label("A Covariate Label"),
    COVAR2 = factor(
      sample(as.factor(enum)),
      levels = 1:4, labels = c("F", "F", "M", "M")
    ) %&gt;% formatters::with_label("Sex (F/M)")
  )
)
dta_bladder$AGE &lt;- sample(20:60, size = nrow(dta_bladder), replace = TRUE)
dta_bladder$STUDYID &lt;- factor("X")

u1_variables &lt;- list(
  time = "TIME", event = "STATUS", arm = "ARM", covariates = c("COVAR1", "COVAR2")
)

u2_variables &lt;- list(time = "TIME", event = "STATUS", covariates = c("COVAR1", "COVAR2"))

m1_variables &lt;- list(
  time = "TIME", event = "STATUS", arm = "ARM", covariates = c("COVAR1", "COVAR2")
)

m2_variables &lt;- list(time = "TIME", event = "STATUS", covariates = c("COVAR1", "COVAR2"))

# summarize_coxreg

result_univar &lt;- basic_table() %&gt;%
  summarize_coxreg(variables = u1_variables) %&gt;%
  build_table(dta_bladder)
result_univar

result_univar_covs &lt;- basic_table() %&gt;%
  summarize_coxreg(
    variables = u2_variables,
  ) %&gt;%
  build_table(dta_bladder)
result_univar_covs

result_multivar &lt;- basic_table() %&gt;%
  summarize_coxreg(
    variables = m1_variables,
    multivar = TRUE,
  ) %&gt;%
  build_table(dta_bladder)
result_multivar

result_multivar_covs &lt;- basic_table() %&gt;%
  summarize_coxreg(
    variables = m2_variables,
    multivar = TRUE,
    varlabels = c("Covariate 1", "Covariate 2") # custom labels
  ) %&gt;%
  build_table(dta_bladder)
result_multivar_covs

# s_coxreg

# Univariate
univar_model &lt;- fit_coxreg_univar(variables = u1_variables, data = dta_bladder)
df1 &lt;- broom::tidy(univar_model)

s_coxreg(model_df = df1, .stats = "hr")

# Univariate with interactions
univar_model_inter &lt;- fit_coxreg_univar(
  variables = u1_variables, control = control_coxreg(interaction = TRUE), data = dta_bladder
)
df1_inter &lt;- broom::tidy(univar_model_inter)

s_coxreg(model_df = df1_inter, .stats = "hr", .which_vars = "inter", .var_nms = "COVAR1")

# Univariate without treatment arm - only "COVAR2" covariate effects
univar_covs_model &lt;- fit_coxreg_univar(variables = u2_variables, data = dta_bladder)
df1_covs &lt;- broom::tidy(univar_covs_model)

s_coxreg(model_df = df1_covs, .stats = "hr", .var_nms = c("COVAR2", "Sex (F/M)"))

# Multivariate.
multivar_model &lt;- fit_coxreg_multivar(variables = m1_variables, data = dta_bladder)
df2 &lt;- broom::tidy(multivar_model)

s_coxreg(model_df = df2, .stats = "pval", .which_vars = "var_main", .var_nms = "COVAR1")
s_coxreg(
  model_df = df2, .stats = "pval", .which_vars = "multi_lvl",
  .var_nms = c("COVAR1", "A Covariate Label")
)

# Multivariate without treatment arm - only "COVAR1" main effect
multivar_covs_model &lt;- fit_coxreg_multivar(variables = m2_variables, data = dta_bladder)
df2_covs &lt;- broom::tidy(multivar_covs_model)

s_coxreg(model_df = df2_covs, .stats = "hr")

a_coxreg(
  df = dta_bladder,
  labelstr = "Label 1",
  variables = u1_variables,
  .spl_context = list(value = "COVAR1"),
  .stats = "n",
  .formats = "xx"
)

a_coxreg(
  df = dta_bladder,
  labelstr = "",
  variables = u1_variables,
  .spl_context = list(value = "COVAR2"),
  .stats = "pval",
  .formats = "xx.xxxx"
)

</code></pre>


</div>