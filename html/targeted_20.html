<div class="container">

<table style="width: 100%;"><tr>
<td>ml_model</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>R6 class for prediction models</h2>

<h3>Description</h3>

<p>Provides standardized estimation and prediction methods
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>info</code></dt>
<dd>
<p>Optional information/name of the model</p>
</dd>
<dt><code>formals</code></dt>
<dd>
<p>List with formal arguments of estimation and
prediction functions</p>
</dd>
<dt><code>formula</code></dt>
<dd>
<p>Formula specifying response and design matrix</p>
</dd>
<dt><code>args</code></dt>
<dd>
<p>additional arguments specified during initialization</p>
</dd>
</dl>
</div>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>fit</code></dt>
<dd>
<p>Active binding returning estimated model object</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-ml_model-new"><code>ml_model$new()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-estimate"><code>ml_model$estimate()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-predict"><code>ml_model$predict()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-update"><code>ml_model$update()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-print"><code>ml_model$print()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-response"><code>ml_model$response()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-design"><code>ml_model$design()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-opt"><code>ml_model$opt()</code></a>
</p>
</li>
<li> <p><a href="#method-ml_model-clone"><code>ml_model$clone()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-ml_model-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Create a new prediction model object
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$new(
  formula = NULL,
  estimate,
  predict = stats::predict,
  predict.args = NULL,
  info = NULL,
  specials,
  response.arg = "y",
  x.arg = "x",
  ...
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>formula</code></dt>
<dd>
<p>formula specifying outcome and design matrix</p>
</dd>
<dt><code>estimate</code></dt>
<dd>
<p>function for fitting the model (must be a function
response, 'y', and design matrix, 'x'. Alternatively, a function
with a single 'formula' argument)</p>
</dd>
<dt><code>predict</code></dt>
<dd>
<p>prediction function (must be a function of model
object, 'object', and new design matrix, 'newdata')</p>
</dd>
<dt><code>predict.args</code></dt>
<dd>
<p>optional arguments to prediction function</p>
</dd>
<dt><code>info</code></dt>
<dd>
<p>optional description of the model</p>
</dd>
<dt><code>specials</code></dt>
<dd>
<p>optional additional terms (weights, offset,
id, subset, ...) passed to 'estimate'</p>
</dd>
<dt><code>response.arg</code></dt>
<dd>
<p>name of response argument</p>
</dd>
<dt><code>x.arg</code></dt>
<dd>
<p>name of design matrix argument</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>optional arguments to fitting function</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-estimate"></a>



<h4>Method <code>estimate()</code>
</h4>

<p>Estimation method
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$estimate(data, ..., store = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>data</code></dt>
<dd>
<p>data.frame</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to estimation method</p>
</dd>
<dt><code>store</code></dt>
<dd>
<p>Logical determining if estimated model should be
stored inside the class.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-predict"></a>



<h4>Method <code>predict()</code>
</h4>

<p>Prediction method
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$predict(newdata, ..., object = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>newdata</code></dt>
<dd>
<p>data.frame</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to prediction method</p>
</dd>
<dt><code>object</code></dt>
<dd>
<p>Optional model fit object</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-update"></a>



<h4>Method <code>update()</code>
</h4>

<p>Update formula
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$update(formula, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>formula</code></dt>
<dd>
<p>formula or character which defines the new response</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to lower level functions</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-print"></a>



<h4>Method <code>print()</code>
</h4>

<p>Print method
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$print(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>Additional arguments to lower level functions</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-response"></a>



<h4>Method <code>response()</code>
</h4>

<p>Extract response from data
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$response(data, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>data</code></dt>
<dd>
<p>data.frame</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>additional arguments to 'design'</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-design"></a>



<h4>Method <code>design()</code>
</h4>

<p>Extract design matrix (features) from data
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$design(data, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>data</code></dt>
<dd>
<p>data.frame</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>additional arguments to 'design'</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-opt"></a>



<h4>Method <code>opt()</code>
</h4>

<p>Get options
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$opt(arg, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>arg</code></dt>
<dd>
<p>name of option to get value of</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p>additional arguments to lower level functions</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ml_model-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>ml_model$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>Author(s)</h3>

<p>Klaus KÃ¤hler Holst
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(iris)
rf &lt;- function(formula, ...)
ml_model$new(formula, info="grf::probability_forest",
  estimate=function(x,y, ...) grf::probability_forest(X=x, Y=y, ...),
  predict=function(object, newdata)
             predict(object, newdata)$predictions, ...)

args &lt;- expand.list(num.trees=c(100,200), mtry=1:3,
          formula=c(Species ~ ., Species ~ Sepal.Length + Sepal.Width))
models &lt;- lapply(args, function(par) do.call(rf, par))

x &lt;- models[[1]]$clone()
x$estimate(iris)
predict(x, newdata=head(iris))

 # Reduce Ex. timing
a &lt;- targeted::cv(models, data=iris)
cbind(coef(a), attr(args, "table"))


ff &lt;- ml_model$new(estimate=function(y,x) lm.fit(x=x, y=y),
        predict=function(object, newdata) newdata%*%object$coefficients)
## tmp &lt;- ff$estimate(y, x=x)
## ff$predict(x)
</code></pre>


</div>