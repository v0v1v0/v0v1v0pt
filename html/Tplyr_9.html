<div class="container">

<table style="width: 100%;"><tr>
<td>add_risk_diff</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add risk difference to a count layer</h2>

<h3>Description</h3>

<p>A very common requirement for summary tables is to calculate the risk difference between treatment
groups. <code>add_risk_diff</code> allows you to do this. The underlying risk difference calculations
are performed using the Base R function <code>prop.test</code> - so prior to using this function,
be sure to familiarize yourself with its functionality.
</p>


<h3>Usage</h3>

<pre><code class="language-R">add_risk_diff(layer, ..., args = list(), distinct = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>layer</code></td>
<td>
<p>Layer upon which the risk difference will be attached</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Comparison groups, provided as character vectors where the first group is the comparison,
and the second is the reference</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>args</code></td>
<td>
<p>Arguments passed directly into <code>prop.test</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distinct</code></td>
<td>
<p>Logical - Use distinct counts (if available).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>add_risk_diff</code> can only be attached to a count layer, so the count layer must be constructed
first. <code>add_risk_diff</code> allows you to compare the difference between treatment group, so all
comparisons should be based upon the values within the specified <code>treat_var</code> in your
<code>tplyr_table</code> object.
</p>
<p>Comparisons are specified by providing two-element character vectors. You can provide as many of
these groups as you want. You can also use groups that have been constructed using
<code>add_treat_grps</code> or <code>add_total_group</code>. The first element provided will be considered
the 'reference' group (i.e. the left side of the comparison), and the second group will be considered
the 'comparison'. So if you'd like to see the risk difference of 'T1 - Placebo', you would specify
this as <code>c('T1', 'Placebo')</code>.
</p>
<p>Tplyr forms your two-way table in the background, and then runs <code>prop.test</code> appropriately.
Similar to way that the display of layers are specified, the exact values and format of how you'd like
the risk difference display are set using <code>set_format_strings</code>. This controls both the values
and the format of how the risk difference is displayed. Risk difference formats are set within
<code>set_format_strings</code> by using the name 'riskdiff'.
</p>
<p>You have 5 variables to choose from in your data presentation:
</p>

<dl>
<dt><strong>comp</strong></dt>
<dd>
<p>Probability of the left hand side group (i.e. comparison)</p>
</dd>
<dt><strong>ref</strong></dt>
<dd>
<p>Probability of the right hand side group (i.e. reference)</p>
</dd>
<dt><strong>dif</strong></dt>
<dd>
<p>Difference of comparison - reference</p>
</dd>
<dt><strong>low</strong></dt>
<dd>
<p>Lower end of the confidence interval (default is 95%, override with the <code>args</code> paramter)</p>
</dd>
<dt><strong>high</strong></dt>
<dd>
<p>Upper end of the confidence interval (default is 95%, override with the <code>args</code> paramter)</p>
</dd>
</dl>
<p>Use these variable names when forming your <code>f_str</code> objects. The default presentation, if no
string format is specified, will be:
</p>
<p><code>f_str('xx.xxx (xx.xxx, xx.xxx)', dif, low, high)</code>
</p>
<p>Note - within Tplyr, you can account for negatives by allowing an extra space within your integer
side settings. This will help with your alignment.
</p>
<p>If columns are specified on a Tplyr table, risk difference comparisons still only take place between
groups within the <code>treat_var</code> variable - but they are instead calculated treating the <code>cols</code>
variables as by variables. Just like the tplyr layers themselves, the risk difference will then be transposed
and display each risk difference as separate variables by each of the <code>cols</code> variables.
</p>
<p>If <code>distinct</code> is TRUE (the default), all calculations will take place on the distinct counts, if
they are available. Otherwise, non-distinct counts will be used.
</p>
<p>One final note - <code>prop.test</code> may throw quite a few warnings. This is natural, because it
alerts you when there's not enough data for the approximations to be correct. This may be unnerving
coming from a SAS programming world, but this is R is trying to alert you that the values provided
don't have enough data to truly be statistically accurate.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(magrittr)

## Two group comparisons with default options applied
t &lt;- tplyr_table(mtcars, gear)

# Basic risk diff for two groups, using defaults
l1 &lt;- group_count(t, carb) %&gt;%
  # Compare 3 vs. 4, 3 vs. 5
  add_risk_diff(
    c('3', '4'),
    c('3', '5')
  )

# Build and show output
add_layers(t, l1) %&gt;% build()

## Specify custom formats and display variables
t &lt;- tplyr_table(mtcars, gear)

# Create the layer with custom formatting
l2 &lt;- group_count(t, carb) %&gt;%
  # Compare 3 vs. 4, 3 vs. 5
  add_risk_diff(
    c('3', '4'),
    c('3', '5')
  ) %&gt;%
  set_format_strings(
    'n_counts' = f_str('xx (xx.x)', n, pct),
    'riskdiff' = f_str('xx.xxx, xx.xxx, xx.xxx, xx.xxx, xx.xxx', comp, ref, dif, low, high)
  )

# Build and show output
add_layers(t, l2) %&gt;% build()

## Passing arguments to prop.test
t &lt;- tplyr_table(mtcars, gear)

# Create the layer with args option
l3 &lt;- group_count(t, carb) %&gt;%
  # Compare 3 vs. 4, 4 vs. 5
  add_risk_diff(
    c('3', '4'),
    c('3', '5'),
    args = list(conf.level = 0.9, correct=FALSE, alternative='less')
  )

# Build and show output
add_layers(t, l3) %&gt;% build()
</code></pre>


</div>