<div class="container">

<table style="width: 100%;"><tr>
<td>tv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a time-varying dataset</h2>

<h3>Description</h3>

<p>Create a time-varying dataset
</p>


<h3>Usage</h3>

<pre><code class="language-R">time_varying(
  x,
  specs,
  exposure,
  ...,
  grid.only = FALSE,
  time_units = c("days", "seconds"),
  id = "pat_id",
  sort = NA,
  n_cores = as.numeric(Sys.getenv("SLURM_CPUS_PER_TASK", 1))
)

check_tv_data(x, time_units, id, sort)

check_tv_exposure(x, expected_ids, time_units, id, ..., check_overlap = TRUE)

check_tv_specs(specs, expected_features = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A data.frame with four columns: &lt;id&gt;, "feature", "datetime", "value"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>specs</code></td>
<td>
<p>a data.frame with four columns: "feature", "use_for_grid", "lookback_start", "lookback_end", "aggregation". See details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exposure</code></td>
<td>
<p>a data.frame with (at least) three columns: &lt;id&gt;, "exposure_start", "exposure_stop"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments. Currently just passes <code>check_overlap</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid.only</code></td>
<td>
<p>Should just the grid be computed and returned? Useful only for debugging</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_units</code></td>
<td>
<p>What time units should be used? Seconds or days</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>The id to use. Default is "pat_id"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sort</code></td>
<td>
<p>Logical, indicating whether to sort the data before performing the analysis. By default (<code>NA</code>),
sorting is only done when useful (that is: <code>x$datetime</code> is a POSIXct and <code>time_units == "days"</code>).
A warning is issued when <code>x$datetime</code> is a Date to make the user aware that the input ought to be sorted to
get the right answer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_cores</code></td>
<td>
<p>Number of cores to use. If slurm is being used, it checks the <code>SLURM_CPUS_PER_TASK</code> variable.
Else it defaults to 1, for no parallelization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expected_ids</code></td>
<td>
<p>A vector of expected ids based on the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check_overlap</code></td>
<td>
<p>Should overlap be checked among exposure rows? A potentially costly operation,
so you can opt out of it if you're really sure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expected_features</code></td>
<td>
<p>A vector of expected features based on the data.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The defaults for specs are to use everything for the grid creation, and to set <code>lookback_start=0</code>, with a message in both cases.
Currently supported aggregation functions include counting ("count" or "n"), last-value-carried forward ("last value" or "lvcf"),
any/none ("any" or "binary"), time since ("time since" or "ts"), min/max/mean, and the special "event" (for which look backs are ignored).
</p>
<p>The look back window begins at <code>row_start - lookback_end</code> and ends at <code>row_start - lookback_start</code>. Passing NA to either look back
changes the corresponding window boundary to <code>exposure_start</code>.
</p>


<h3>Value</h3>

<p>A data.frame, with one row per grid value and one column per feature specification (plus grid columns).
</p>


<h3>Examples</h3>

<pre><code class="language-R">  data(tv_example)
  time_varying(tv_example$data, tv_example$specs, tv_example$exposure,
               time_units = "days", id = "mcn")
</code></pre>


</div>