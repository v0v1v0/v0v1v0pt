<div class="container">

<table style="width: 100%;"><tr>
<td>h_survival_biomarkers_subgroups</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Helper functions for tabulating biomarker effects on survival by subgroup</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>Helper functions which are documented here separately to not confuse the user
when reading about the user-facing functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">h_surv_to_coxreg_variables(variables, biomarker)

h_coxreg_mult_cont_df(variables, data, control = control_coxreg())

h_tab_surv_one_biomarker(
  df,
  vars,
  time_unit,
  na_str = default_na_str(),
  .indent_mods = 0L,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>(named <code>list</code> of <code>string</code>)<br> list of additional analysis variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>biomarker</code></td>
<td>
<p>(<code>string</code>)<br> the name of the biomarker variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>(<code>data.frame</code>)<br> the dataset containing the variables to summarize.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>(<code>list</code>)<br> a list of parameters as returned by the helper function <code>control_coxreg()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>(<code>data.frame</code>)<br> results for a single biomarker, as part of what is
returned by <code>extract_survival_biomarkers()</code> (it needs a couple of columns which are
added by that high-level function relative to what is returned by <code>h_coxreg_mult_cont_df()</code>,
see the example).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>(<code>character</code>)<br> the names of statistics to be reported among:
</p>

<ul>
<li> <p><code>n_tot_events</code>: Total number of events per group.
</p>
</li>
<li> <p><code>n_tot</code>: Total number of observations per group.
</p>
</li>
<li> <p><code>median</code>: Median survival time.
</p>
</li>
<li> <p><code>hr</code>: Hazard ratio.
</p>
</li>
<li> <p><code>ci</code>: Confidence interval of hazard ratio.
</p>
</li>
<li> <p><code>pval</code>: p-value of the effect.
Note, one of the statistics <code>n_tot</code> and <code>n_tot_events</code>, as well as both <code>hr</code> and <code>ci</code> are required.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_unit</code></td>
<td>
<p>(<code>string</code>)<br> label with unit of median survival time. Default <code>NULL</code> skips displaying unit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_str</code></td>
<td>
<p>(<code>string</code>)<br> string used to replace all <code>NA</code> or empty values in the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.indent_mods</code></td>
<td>
<p>(named <code>integer</code>)<br> indent modifiers for the labels. Defaults to 0, which corresponds to the
unmodified default behavior. Can be negative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments for the lower level functions.</p>
</td>
</tr>
</table>
<h3>Value</h3>


<ul><li> <p><code>h_surv_to_coxreg_variables()</code> returns a named <code>list</code> of elements <code>time</code>, <code>event</code>, <code>arm</code>,
<code>covariates</code>, and <code>strata</code>.
</p>
</li></ul>
<ul><li> <p><code>h_coxreg_mult_cont_df()</code> returns a <code>data.frame</code> containing estimates and statistics for the selected biomarkers.
</p>
</li></ul>
<ul><li> <p><code>h_tab_surv_one_biomarker()</code> returns an <code>rtables</code> table object with the given statistics arranged in columns.
</p>
</li></ul>
<h3>Functions</h3>


<ul>
<li> <p><code>h_surv_to_coxreg_variables()</code>: Helps with converting the "survival" function variable list
to the "Cox regression" variable list. The reason is that currently there is an inconsistency between the variable
names accepted by <code>extract_survival_subgroups()</code> and <code>fit_coxreg_multivar()</code>.
</p>
</li>
<li> <p><code>h_coxreg_mult_cont_df()</code>: Prepares estimates for number of events, patients and median survival
times, as well as hazard ratio estimates, confidence intervals and p-values, for multiple biomarkers
in a given single data set.
<code>variables</code> corresponds to names of variables found in <code>data</code>, passed as a named list and requires elements
<code>tte</code>, <code>is_event</code>, <code>biomarkers</code> (vector of continuous biomarker variables) and optionally <code>subgroups</code> and <code>strata</code>.
</p>
</li>
<li> <p><code>h_tab_surv_one_biomarker()</code>: Prepares a single sub-table given a <code>df_sub</code> containing
the results for a single biomarker.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">library(dplyr)
library(forcats)

adtte &lt;- tern_ex_adtte

# Save variable labels before data processing steps.
adtte_labels &lt;- formatters::var_labels(adtte, fill = FALSE)

adtte_f &lt;- adtte %&gt;%
  filter(PARAMCD == "OS") %&gt;%
  mutate(
    AVALU = as.character(AVALU),
    is_event = CNSR == 0
  )
labels &lt;- c("AVALU" = adtte_labels[["AVALU"]], "is_event" = "Event Flag")
formatters::var_labels(adtte_f)[names(labels)] &lt;- labels

# This is how the variable list is converted internally.
h_surv_to_coxreg_variables(
  variables = list(
    tte = "AVAL",
    is_event = "EVNT",
    covariates = c("A", "B"),
    strata = "D"
  ),
  biomarker = "AGE"
)

# For a single population, estimate separately the effects
# of two biomarkers.
df &lt;- h_coxreg_mult_cont_df(
  variables = list(
    tte = "AVAL",
    is_event = "is_event",
    biomarkers = c("BMRKR1", "AGE"),
    covariates = "SEX",
    strata = c("STRATA1", "STRATA2")
  ),
  data = adtte_f
)
df

# If the data set is empty, still the corresponding rows with missings are returned.
h_coxreg_mult_cont_df(
  variables = list(
    tte = "AVAL",
    is_event = "is_event",
    biomarkers = c("BMRKR1", "AGE"),
    covariates = "REGION1",
    strata = c("STRATA1", "STRATA2")
  ),
  data = adtte_f[NULL, ]
)

# Starting from above `df`, zoom in on one biomarker and add required columns.
df1 &lt;- df[1, ]
df1$subgroup &lt;- "All patients"
df1$row_type &lt;- "content"
df1$var &lt;- "ALL"
df1$var_label &lt;- "All patients"
h_tab_surv_one_biomarker(
  df1,
  vars = c("n_tot", "n_tot_events", "median", "hr", "ci", "pval"),
  time_unit = "days"
)

</code></pre>


</div>