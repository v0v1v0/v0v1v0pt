<div class="container">

<table style="width: 100%;"><tr>
<td>theta2fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fit time series extremes
</h2>

<h3>Description</h3>

<p>Appropriate marginal transforms are done before the fit using standard procedures, before the dependence model is fitted to the data. Then the measure of dependence <code class="reqn">\theta(x,m)</code> is derived using a method described in Eastoe and Tawn (2012).
</p>


<h3>Usage</h3>

<pre><code class="language-R">theta2fit(ts, lapl = FALSE, nlag = 1, R = 1000,
          u.mar = 0, u.dep, probs = seq(u.dep, 0.9999, length.out = 30),
          method.mar = c("mle","mom","pwm"), method = c("prop", "MCi"),
          silent = FALSE,
          R.boot = 0, block.length = m * 5, levels = c(.025,.975))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ts</code></td>
<td>

<p>numeric vector; time series to be fitted.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lapl</code></td>
<td>

<p>logical; is <code>ts</code> on the Laplace scale already? The default (FALSE) assumes unknown marginal distribution.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlag</code></td>
<td>

<p>integer; number of lags to be considered when modelling the dependence in time.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>

<p>integer; the number of samples used for estimating <code class="reqn">\theta(x,m)</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u.mar</code></td>
<td>

<p>marginal threshold; used when transforming the time series to Laplace scale if <code>lapl</code> is FALSE; not used otherwise.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u.dep</code></td>
<td>

<p>dependence threshold; level above which the dependence is modelled. <code>u.dep</code> can be lower than <code>u.mar</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>

<p>vector of probabilities; the values of <code class="reqn">x</code> for which to evaluate <code class="reqn">\theta(x,m)</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method.mar</code></td>
<td>

<p>a character string defining the method used to estimate the marginal GPD; either <code>"mle"</code> for maximum likelihood of <code>"mom"</code> for method of moments or <code>"pwm"</code> for probability weighted moments methods. Defaults to <code>"mle"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>

<p>a character string defining the method used to estimate the dependence measure; either <code>"prop"</code> for proportions or <code>"MCi"</code> for Monte Carlo integration (see Details).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>

<p>logical (<code>FALSE</code>); verbosity.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R.boot</code></td>
<td>

<p>integer; the number of samples used for the block bootstrap for the confidence intervals.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>block.length</code></td>
<td>

<p>integer; the block length used for the block-bootstrapped confidence intervals.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levels</code></td>
<td>

<p>vector of probabilities; the quantiles of the bootstrap distribution of the extremal measure to be computed.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The standard procedure (<code>method="prop"</code>) to estimating probabilities from a Heffernan-Tawn fit best illustrated in the bivariate context (<code class="reqn">Y\mid X&gt;u</code>):
</p>
<p>1. sample <code class="reqn">X</code> from an exponential distribution above <code class="reqn">v \ge u</code>,
</p>
<p>2. sample <code class="reqn">Z</code> (residuals) from their empirical distribution,
</p>
<p>3. compute <code class="reqn">Y</code> using the relation <code class="reqn">Y = \alpha\times X + X^\beta\times Z</code>,
</p>
<p>4. estimate <code class="reqn">Pr(X &gt; v_x, Y &gt; v_y)</code> by calculating the proportion <code class="reqn">p</code> of <code class="reqn">Y</code> samples above <code class="reqn">v_y</code> and multiply <code class="reqn">p</code> with the marginal survival distribution evaluated at <code class="reqn">v_x</code>.
</p>
<p>With <code>method="MCi"</code> a Monte Carlo integration approach is used, where the survivor distribution of <code class="reqn">Z</code> is evaluated at pseudo-residuals of the form
</p>
<p style="text-align: center;"><code class="reqn">\frac{v_y - \alpha\times X}{X^\beta},</code>
</p>

<p>where <code class="reqn">X</code> is sampled from an exponential distribution above <code class="reqn">v_x</code>. Taking the mean of these survival probabilities, we get the Monte Carlo equivalent of <code class="reqn">p</code> in the proportion approach.
</p>


<h3>Value</h3>

<p>List containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>depfit </code></td>
<td>
<p>an object of class 'stepfit'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs </code></td>
<td>
<p><code>probs</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levels </code></td>
<td>
<p><code>probs</code> transformed to original scale of <code>ts</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta </code></td>
<td>
<p>a matrix with <em>proportion</em> or <em>Monte Carlo</em> estimates of <code class="reqn">\theta(x,m)</code>. Rows correspond to values in <code>probs</code>, columns are point estimates and bootstrap quantiles</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>dep2fit</code>, <code>thetafit</code>, <code>thetaruns</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## generate data from an AR(1)
## with Gaussian marginal distribution
n   &lt;- 10000
dep &lt;- 0.5
ar    &lt;- numeric(n)
ar[1] &lt;- rnorm(1)
for(i in 2:n)
  ar[i] &lt;- rnorm(1, mean=dep*ar[i-1], sd=1-dep^2)
plot(ar, type="l")
plot(density(ar))
grid &lt;- seq(-3,3,0.01)
lines(grid, dnorm(grid), col="blue")

## rescale the margin (focus on dependence)
ar &lt;- qlapl(pnorm(ar))

## fit the data
fit &lt;- theta2fit(ts=ar, u.mar=0.95, u.dep=0.98)

## plot theta(x,1)
plot(fit)
abline(h=1, lty="dotted")
</code></pre>


</div>