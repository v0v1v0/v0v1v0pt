<div class="container">

<table style="width: 100%;"><tr>
<td>WhichAnswerOriginal</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>WhichAnswerOriginal</h2>

<h3>Description</h3>

<p>Given the answers of the students gathered in a table, and a full answer sheet of all versions (Including a "reference/original" version), it finds where those answers are found in the original exam, by copying from the original version the matching rows and binding them in order for every student. It then combines all of them in a list, and includes as well all the remaining student information in the attribute "StudentInfo".
</p>
<p>It is intended as an internal function to generate the grades, and to identify in a very general way where the answers of the students are (relative to the reference/original version).
</p>


<h3>Usage</h3>

<pre><code class="language-R">WhichAnswerOriginal(
  StudentAnswers,
  FullExamAnswerSheet,
  OriginalExamVersion = 0,
  names.FullExamVersion = "Version",
  names.FullExamOriginalCols,
  names.CorrectAndIncorrectCols,
  names.StudentAnswerQCols,
  names.StudentAnswerExamVersion
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>StudentAnswers</code></td>
<td>
<p>DataFrame, each row is a student, each column is some information about said student. Any column not included in <code>names.StudentAnswerQCols</code> will be understood as information of the student and will be saved as part of the information table when we output the result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FullExamAnswerSheet</code></td>
<td>
<p>Answer sheet of all the exam versions, following the conventions of the <code>FullAnswerSheet</code> outputted by <code>CreateRandomExams</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OriginalExamVersion</code></td>
<td>
<p>The version of the original exam, without randomization, as stored on the <code>FullExamAnswerSheet</code>. The default value is <code>0</code>, as that is the convention on <code>CreateRandomExams</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.FullExamVersion</code></td>
<td>
<p>The name of the column in which the version of the exam is stored on the <code>FullExamAnswerSheet</code>. The default value is "<code>Version</code>", as that is the convention on <code>CreateRandomExams</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.FullExamOriginalCols</code></td>
<td>
<p>The names of the columns that contain the information of the items relative to where they were positioned in the original ordering of the exam, before randomizing the exam. The convention from <code>CreateRandomExams</code> is to finish all of them by  "<code>_original</code>".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.CorrectAndIncorrectCols</code></td>
<td>
<p>It should be a character vector. The names of the columns in the <code>FullExamAnswerSheet</code> that contain the correct and incorrect answers, in that order. This column should have an integer value if it is indeed a correct value in the correct column and a incorrect value in the incorrect value, and <code>NA</code> otherwise. (The should be "complementary")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.StudentAnswerQCols</code></td>
<td>
<p>The names in the <code>StudentAnswers</code> that store the answers from every student to the exam, ordered. These columns should contain integers values. Where 1 refers to the first answer, and n refers to the nth answers in <strong>their exam</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.StudentAnswerExamVersion</code></td>
<td>
<p>The name of the column in the <code>StudentAnswers</code> that identifies the version of the exam</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>StudentAnswers</code> should be a data frame with one student answers represented by every row. The answers of the student to the exam should be ordered.
</p>
<p>It is important that the colums named <code>names.StudentAnswerQCols</code> should contain all their answers, if a student didn't answer a question leave a <code>NA</code> or an invalid integer value as an answer, like 0, or a number larger than the number of answers to that question, so that is is found as out of bounds.
</p>


<h3>Value</h3>

<p>It returns a list. Each element of the list is a dataframe, and there is one dataframe for each student in the <code>StudentInfo</code> table provided.
</p>
<p>All the columns that are not in the columns <code>names.StudentAnswerQCols</code>  are regarded as "<code>StudentInfo</code>", and they are added to the attribute "<code>StudentInfo</code>" of the output as a data frame.
</p>

<dl>
<dt>List elements:</dt>
<dd>
<p>They are outputted in order, that is to say, for <code>StudentAnswers[i,]</code> the list that provides the information for that row will be <code>outputlist[[i]]</code>.
</p>
<p><code>outputlist[[i]]</code> is a dataframe that identifies the rows that the student answered as they are found on the original/reference version. Therefore, if a student answeres a certain value, and that value is not reflected on the original version, it get's ignored.
</p>
</dd>
<dt>
<code>StudentInfo</code> attribute</dt>
<dd>
<p>A dataframe containing all the student information that wasn't their answers.</p>
</dd>
</dl>
<h3>Underlying algorithm</h3>

<p>To identify the rows on the original exam it does the following:
</p>

<ol>
<li>
<p> It first finds their exam in the full answer sheet by their exam version.
</p>
</li>
<li>
<p> After that, it  removes from their exam the rows that identify the correct/incorrect choices.
</p>
</li>
<li>
<p> By trying to match that row with a row on the reference exam it can tell where that quesiton is found on the original exam.
</p>
</li>
<li>
<p>  Then it identifies where that question is found on the original version, and it finds there which of the possible correct/incorrect choices is found.
</p>
</li>
<li>
<p> If it didn't find any correct/incorrect choice matching the value given by the student, it marks it as out of bounds and replaces both correct and incorrect columns with <code>NA</code>.
</p>
</li>
<li>
<p> If it still doesn't find the row, it simply ignores it, and the output will have one less row.
</p>
</li>
<li>
<p> Now you can tell how many questions the student answered correctly by looking at how many values are not NA in the correct choice column of the output list.
</p>
</li>
</ol>
<h3>Removing Questions from the exam</h3>

<p>Note that if after creating the exam, you found that a question is bugged and can't be used to grade the exam, all you have to do is tell the student to answer "something" and you only have to remove it from the original/reference version in the Full Answer Sheet. When you apply the grading function, that question will then be ignored.
</p>
<p>Notice how this creates output lists with different lengths in the case that two students didn't have that same question in their exam.
</p>
<p>For example, if a exam has 15 questions out of a 50 question document. If student A has a bugged question and student B doesn't, the answer sheet produced for student A will have 14 rows while the one for student B will have 15 rows.
</p>


<h3>Notes</h3>

<p><strong>Note1:</strong> Remember that in the original answer sheet there are two columns, one with correctchoice, another one with wrong choice. If the value is NA of one of those two columns it SHOULD NOT be NA on the other row.
</p>
<p><strong>Note2:</strong>  The idea is that the data frames can be read to know the score of the student by counting the number of values that are not NAs on the correct choice column. (The numbers on the correct/incorrect columns themselves can be used for statistical purposes, to tell how many students answered each question).
</p>
<p><strong>Note3:</strong> The data frames can be used for many other statistical purposes very easily.
</p>


<h3>See Also</h3>

<p><code>GradeExams</code> and <code>ObtainExamStats</code> for examples on how to use the output of this function to obtain more detailed information.
</p>


<h3>Examples</h3>

<pre><code class="language-R">

asheet_file &lt;-
    system.file(
        "extdata",
        "ExampleTables",
        "ExampleAnswerSheet.csv",
        package = "TexExamRandomizer")
responses_file &lt;-
    system.file(
        "extdata",
        "ExampleTables",
        "ExampleResponses.csv",
        package = "TexExamRandomizer")
FullAnswerSheet &lt;-
    read.csv(
        asheet_file,
        header = TRUE,
        stringsAsFactors = FALSE,
        na.strings = c("", "NA", "Na"),
        strip.white = TRUE)
Responses &lt;- read.csv(
    responses_file,
    header = TRUE,
    stringsAsFactors = FALSE,
    na.strings = c("", "NA", "Na"),
    strip.white = TRUE)
compiledanswers &lt;-
    WhichAnswerOriginal(
        StudentAnswers = Responses,
        FullExamAnswerSheet = FullAnswerSheet,
        names.StudentAnswerQCols = grep(
            names(Responses),
            pattern = "^Q.*[[:digit:]]",
            value = TRUE),
        names.StudentAnswerExamVersion = grep(
            names(Responses),
            pattern = "Version",
            value = TRUE),
        OriginalExamVersion = 0,
        names.FullExamVersion = "Version",
        names.FullExamOriginalCols = grep(
            names(FullAnswerSheet),
            pattern = "_original",
             value = TRUE),
        names.CorrectAndIncorrectCols = c(
            "choice",
            "CorrectChoice")
    )
nicknames &lt;- attr(compiledanswers, "StudentInfo")$Nickname

for (i in 1:length(compiledanswers)) {
    cat("Student\t", nicknames[i], " got\t",
        sum(!is.na(compiledanswers[[i]]$CorrectChoice)),
        " questions correctly\n", sep = "")
}
</code></pre>


</div>