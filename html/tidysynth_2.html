<div class="container">

<table style="width: 100%;"><tr>
<td>generate_control</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>generate_control</h2>

<h3>Description</h3>

<p>Uses the weights generated from <code>generate_weights()</code> to weight control units
from the donor pool to denerate a synthetic version of the treated unit time
series.
</p>


<h3>Usage</h3>

<pre><code class="language-R">generate_control(data)
</code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>nested data of type <code>tbl_df</code> generated from <code>sythetic_control()</code>.
See <code>synthetic_control()</code> documentation for more information. In addition,
<code>.unit_weights</code> must be generate using <code>generate_weights()</code>. See
documentation for more information on how to generate weights.</p>
</td>
</tr></table>
<h3>Value</h3>

<p><code>tbl_df</code> with nested fields containing the following:
</p>

<ul>
<li> <p><code>.id</code>: unit id for the intervention case (this will differ when a placebo
unit).
</p>
</li>
<li> <p><code>.placebo</code>: indicator field taking on the value of 1 if a unit is a
placebo unit, 0 if it's the specified treated unit.
</p>
</li>
<li> <p><code>.type</code>: type of the nested data construct: <code>treated</code> or <code>controls</code>.
Keeps tract of which data construct is located in <code>.outcome</code> field.
</p>
</li>
<li> <p><code>.outcome</code>: nested data construct containing the outcome variable
configured for the sythnetic control method. Data is configured into a wide
format for the optimization task.
</p>
</li>
<li> <p><code>.predictors</code>: nested data construct containing the covariate matrices
for the treated and control (donor) units. Data is configured into a wide
format for the optimization task.
</p>
</li>
<li> <p><code>.synthetic_control</code>: nested data construct containing the synthetic
control version of the outcome variable generated from the unit weights.
</p>
</li>
<li> <p><code>.unit_weights</code>: Nested column of unit weights (i.e. how each unit from
the donor pool contributes to the synthetic control). Weights should sum to
</p>
</li>
</ul>
<ol><li> 
</li></ol>
<ul>
<li> <p><code>.predictor_weights</code>: Nested column of predictor variable weights (i.e.
the significance of each predictor in optimizing the weights that generate
the synthetic control). Weights should sum to 1. If variable weights are
provided, those variable weights are provided.
</p>
</li>
<li> <p><code>.original_data</code>: original impute data filtered by treated or control
units. This allows for easy processing down stream when generating
predictors.
</p>
</li>
<li> <p><code>.meta</code>: stores information regarding the unit and time index, the
treated unit and time and the name of the outcome variable. Used downstream
in subsequent functions.
</p>
</li>
<li> <p><code>.loss</code>: the RMPE loss for both sets of weights.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">


# Smoking example data
data(smoking)

smoking_out &lt;-
smoking %&gt;%

# initial the synthetic control object
synthetic_control(outcome = cigsale,
                  unit = state,
                  time = year,
                  i_unit = "California",
                  i_time = 1988,
                  generate_placebos= FALSE) %&gt;%

# Generate the aggregate predictors used to generate the weights
  generate_predictor(time_window=1980:1988,
                     lnincome = mean(lnincome, na.rm = TRUE),
                     retprice = mean(retprice, na.rm = TRUE),
                     age15to24 = mean(age15to24, na.rm = TRUE)) %&gt;%

  generate_predictor(time_window=1984:1988,
                     beer = mean(beer, na.rm = TRUE)) %&gt;%

  generate_predictor(time_window=1975,
                     cigsale_1975 = cigsale) %&gt;%

  generate_predictor(time_window=1980,
                     cigsale_1980 = cigsale) %&gt;%

  generate_predictor(time_window=1988,
                     cigsale_1988 = cigsale) %&gt;%


  # Generate the fitted weights for the synthetic control
  generate_weights(optimization_window =1970:1988,
                   Margin.ipop=.02,Sigf.ipop=7,Bound.ipop=6) %&gt;%

  # Generate the synthetic control
  generate_control()

# Plot the observed and synthetic trend
smoking_out %&gt;% plot_trends(time_window = 1970:2000)



</code></pre>


</div>