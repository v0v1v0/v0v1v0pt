<div class="container">

<table style="width: 100%;"><tr>
<td>pluginEstimate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>SDE plugin estimator solver</h2>

<h3>Description</h3>

<p>Calculates recursive estimator for given hazard estimates, integrand function and gradients.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pluginEstimate(n, hazMatrix, F_fun, JacobianList, X0, V0, isLebesgue = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Total number of indiivduals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hazMatrix</code></td>
<td>
<p>Matrix consisting of hazards(rows) and their increments(columns) along the same time scale</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>F_fun</code></td>
<td>
<p>Integrand function F = (F_1,F_2,...) for the differential equation system</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>JacobianList</code></td>
<td>
<p>The Jacobian matrices of F_1, F_2, ... organized in a <code>list</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X0</code></td>
<td>
<p>Matrix containing initial values for the parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V0</code></td>
<td>
<p>Matrix containing initial values for the variance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>isLebesgue</code></td>
<td>
<p>(Optional, to improve efficientcy) Provide the index of <code>A</code> (e.g. 2) that is a regular <code>dt</code> integral, i.e. not a cumulative hazard.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>list</code> containing the parameter estimate <code>X</code>, and its covariance estimates <code>V/n</code>
</p>


<h3>Author(s)</h3>

<p>Pål Christie Ryalen <a href="mailto:p.c.ryalen@medisin.uio.no">p.c.ryalen@medisin.uio.no</a>
</p>


<h3>References</h3>

<p>Ryalen, P.C., Stensrud, M.J., Røysland, K.: <em>Transforming cumulative hazards</em>, arXiv, to appear in Biometrika 2018.
</p>


<h3>Examples</h3>

<pre><code class="language-R">###############################################################
#########################  Survival  ##########################
###############################################################
library(timereg)

n &lt;- 100
dfr &lt;- data.frame(to = rexp(n,1),from=0,event=1)

fit &lt;- survfit(Surv(from,to,event==1)~1,data=dfr)

times &lt;- fit$time
dN &lt;- fit$n.event
Y &lt;- fit$n.risk
Y[1] &lt;- n

dA &lt;- matrix(dN/Y,nrow=1,ncol=length(dN))

# Function specification
F_fun_Survival &lt;- function(x)-matrix(x,1,1)
JacobianListSurvival &lt;- list(function(x)-matrix(1,1,1))
X0_Survival &lt;- matrix(1,1,1)
V0_Survival &lt;- matrix(0,1,1)

paramEst_survival &lt;- pluginEstimate(
  n,dA,F_fun_Survival,JacobianListSurvival,X0_Survival,V0_Survival
)

KM &lt;- cumprod(1 - dA)
Greenwood &lt;- KM^2 * cumsum(dA^2)

plot(
  times,paramEst_survival$X,type="s",main="SDE plugin survival estimates",
  ylab="",xlab="time"
)
lines(times,paramEst_survival$X + 1.96*sqrt(paramEst_survival$covariance[1,1,]),type="s")
lines(times,paramEst_survival$X - 1.96*sqrt(paramEst_survival$covariance[1,1,]),type="s")
lines(seq(0,10,length.out=100),exp(-seq(0,10,length.out=100)),col=2)
legend("topright",c("SDE plugin estimates","Exact"),lty=1,col=c(1,2),bty="n")

plot(
  times,paramEst_survival$covariance,type="s",
  main="SDE plugin variance vs Greenwood variance",ylab="",xlab="time"
)
lines(times,Greenwood,type="s",col=4,lty=1)
legend("topright",c("SDE plugin estimates","Greenwood"),lty=1,col=c(1,4),bty="n")

#################################################################################
############ Competing risks and Cumulative incidence(two states) ###############
#################################################################################

n &lt;- 200
x1 &lt;- rexp(n,1)
x2 &lt;- rexp(n,1.3)
to.states &lt;- ifelse(x1&lt;x2,0,1)

dfr &lt;- data.frame(from=0,to=c(x1[to.states==0],x2[to.states==1]),to.state=to.states)
dfr &lt;- dfr[order(dfr$to),]

nrisk &lt;- c(n,n:1)
dA1 &lt;- c(0,1*(dfr$to.state==0))/nrisk
dA2 &lt;- c(0,1*(dfr$to.state==1))/nrisk

hazMatrix &lt;- rbind(dA1,dA2)

F_fun_cuminc &lt;- function(X)rbind(c(X[2],0),c(-X[2],-X[2]))
JacobianList_cuminc &lt;- list( function(X)matrix(c(0,0,1,-1),nrow=2),
                             function(X)matrix(c(0,0,0,-1),nrow=2) )

X0_cuminc &lt;- matrix(c(0,1),nrow=2,ncol=1)
V0_cuminc &lt;- matrix(0,nrow=2,ncol=2)

paramEst_cuminc &lt;- pluginEstimate(n,hazMatrix,F_fun_cuminc,JacobianList_cuminc,X0_cuminc,V0_cuminc)

times &lt;- c(0,dfr$to)

plot(
  times,paramEst_cuminc$X[1,],type="s",ylab="",xlab="time",
  main="SDE plugin cumulative incidence estimate",ylim=c(0,0.7)
)
lines(times,paramEst_cuminc$X[1,] + 1.96*sqrt(paramEst_cuminc$covariance[1,1,]),type="s")
lines(times,paramEst_cuminc$X[1,] - 1.96*sqrt(paramEst_cuminc$covariance[1,1,]),type="s")
lines(seq(0,10,length.out = 1000),10/1000*cumsum(exp(-seq(0,10,length.out = 1000)*(1 + 1.3))),col=2)
legend("topright",c("SDE plugin estimates","Exact"),lty=1,col=c(1,2),bty="n")


##########################################################################################
####################  Relative survival(two different populations)  ######################
##########################################################################################

n &lt;- 300
t1 &lt;- sort(rexp(n,1))
t2 &lt;- sort(rexp(n,1.3))
times &lt;- sort(c(0,t1,t2))
nrisk &lt;- 300:1
dA1 &lt;- 1*(t1 %in% times)/nrisk
dA2 &lt;- 1*(t2 %in% times)/nrisk

tmatch1 &lt;- match(t1,times)
tmatch2 &lt;- match(t2,times)

hazMatrix &lt;- matrix(0,nrow=2,ncol=length(times))
hazMatrix[1,tmatch1] &lt;- dA1
hazMatrix[2,tmatch2] &lt;- dA2

F_fun_RelSurv &lt;- function(X)matrix(c(-X,X),ncol=2)
JacobianList_RelSurv &lt;- list(function(X)matrix(-1,nrow=1,ncol=1),
                             function(X)matrix(1,nrow=1,ncol=1))

X0_RelSurv &lt;- matrix(1,nrow=1,ncol=1)
V0_RelSurv &lt;- matrix(0,nrow=1,ncol=1)


paramEst_relsurv &lt;- pluginEstimate(
  n,hazMatrix,F_fun_RelSurv,JacobianList_RelSurv,X0_RelSurv,V0_RelSurv
)


plot(
  times,paramEst_relsurv$X[1,],type="s",ylab="",xlab="time",
  main="SDE plugin relative survival estimate",ylim=c(-1,5.8),xlim=c(0,4)
)
lines(times,paramEst_relsurv$X[1,] + 1.96*sqrt(paramEst_relsurv$covariance[1,,]),type="s")
lines(times,paramEst_relsurv$X[1,] - 1.96*sqrt(paramEst_relsurv$covariance[1,,]),type="s")
lines(seq(0,10,length.out = 100),exp(seq(0,10,length.out = 100)*(1.3-1)),col=2)
legend("topleft",c("SDE plugin estimates","Exact"),lty=1,col=c(1,2),bty="n")
</code></pre>


</div>