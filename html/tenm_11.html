<div class="container">

<table style="width: 100%;"><tr>
<td>ellipsoid_selection</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>ellipsoid_selection: Performs models selection for ellipsoid models</h2>

<h3>Description</h3>

<p>The function performs model selection for ellipsoid models
using three criteria: a) the omission rate, b) the significance of partial
ROC and binomial tests and c) the AUC value.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ellipsoid_selection(
  env_train,
  env_test = NULL,
  env_vars,
  nvarstest,
  level = 0.95,
  mve = TRUE,
  env_bg = NULL,
  omr_criteria,
  parallel = FALSE,
  ncores = NULL,
  comp_each = 100,
  proc = FALSE,
  proc_iter = 100,
  rseed = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>env_train</code></td>
<td>
<p>A data frame with the environmental training data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env_test</code></td>
<td>
<p>A data frame with the environmental testing data.
Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env_vars</code></td>
<td>
<p>A vector with the names of environmental variables used in
the selection process. To help choosing which variables to use see
<code>correlation_finder</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nvarstest</code></td>
<td>
<p>A vector indicating the number of variables to fit the
ellipsoids during model selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>Proportion of points to be included in the ellipsoids,
equivalent to the error (E) proposed by Peterson et al. (2008).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mve</code></td>
<td>
<p>Logical. If <code>TRUE</code>, a minimum volume ellipsoid will be computed.
using <code>cov.rob</code> from <span class="pkg">MASS</span>. If <code>FALSE</code>, the covariance
matrix of the input data will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env_bg</code></td>
<td>
<p>Environmental data to compute the approximated prevalence
of the model, should be a sample of the environmental layers of
the calibration area.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omr_criteria</code></td>
<td>
<p>Omission rate criteria: the allowable omission rate for
the selection process. Default is NULL (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Logical. If <code>TRUE</code>, computations will run in parallel.
Default is <code>F</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>Number of cores to use for parallel processing. Default uses
all available cores minus one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp_each</code></td>
<td>
<p>Number of models to run in each job in parallel computation.
Default is 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proc</code></td>
<td>
<p>Logical. If <code>TRUE</code>, a partial ROC test will be run.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proc_iter</code></td>
<td>
<p>Numeric. Total iterations for the partial ROC bootstrap.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rseed</code></td>
<td>
<p>Logical. If <code>TRUE</code>, set a random seed for partial ROC bootstrap.
Default is <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Model selection occurs in environmental space (E-space). For each variable
combination specified in nvarstest, the omission rate (omr) in E-space is
computed using <code>inEllipsoid</code> function.
Results are ordered by omr of the testing data. If env_bg is provided,
an estimated prevalence is computed and results are additionally ordered
by partial AUC. Model selection can be run in parallel.
For more details and examples go to <code>ellipsoid_omr</code> help.
</p>


<h3>Value</h3>

<p>A data.frame with the following columns:
</p>

<ul>
<li>
<p> "fitted_vars": Names of variables that were fitted.
</p>
</li>
<li>
<p> "nvars": Number of fitted variables
</p>
</li>
<li>
<p> "om_rate_train": Omission rate of the training data.
</p>
</li>
<li>
<p> "non_pred_train_ids": Row IDs of non-predicted training data.
</p>
</li>
<li>
<p> "om_rate_test"': Omission rate of the testing data.
</p>
</li>
<li>
<p> "non_pred_test_ids": Row IDs of non-predicted testing data.
</p>
</li>
<li>
<p> "bg_prevalence": Approximated prevalence of the model (see details).
</p>
</li>
<li>
<p> "pval_bin": p-value of the binomial test.
</p>
</li>
<li>
<p> "pval_proc": p-value of the partial ROC test.
</p>
</li>
<li>
<p> "env_bg_paucratio": Environmental partial AUC ratio value.
</p>
</li>
<li>
<p> "env_bg_auc": Environmental AUC value.
</p>
</li>
<li>
<p> "mean_omr_train_test": Mean value of omission rates (train and test).
</p>
</li>
<li>
<p> "rank_by_omr_train_test": Rank value of importance in model selection
by omission rate.
</p>
</li>
<li>
<p> "rank_omr_aucratio": Rank value by AUC ratio.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Luis Osorio-Olvera <a href="mailto:luismurao@gmail.com">luismurao@gmail.com</a>
</p>


<h3>References</h3>

<p>Peterson, A.T. et al. (2008) Rethinking receiver operating
characteristic analysis applications in ecological niche modeling. Ecol.
Modell. 213, 63â€“72. <a href="https://doi.org/10.1016/j.ecolmodel.2007.11.008">doi:10.1016/j.ecolmodel.2007.11.008</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(tenm)
data("abronia")
tempora_layers_dir &lt;- system.file("extdata/bio",package = "tenm")
abt &lt;- tenm::sp_temporal_data(occs = abronia,
                              longitude = "decimalLongitude",
                              latitude = "decimalLatitude",
                              sp_date_var = "year",
                              occ_date_format="y",
                              layers_date_format= "y",
                              layers_by_date_dir = tempora_layers_dir,
                              layers_ext="*.tif$")
abtc &lt;- tenm::clean_dup_by_date(abt,threshold = 10/60)
future::plan("multisession",workers=2)
abex &lt;- tenm::ex_by_date(this_species = abtc,train_prop=0.7)
abbg &lt;- tenm::bg_by_date(this_species = abex,
                         buffer_ngbs=10,n_bg=50000)
future::plan("sequential")
varcorrs &lt;- tenm::correlation_finder(environmental_data =
                                     abex$env_data[,-ncol(abex$env_data)],
                                     method = "spearman",
                                     threshold = 0.8,
                                     verbose = FALSE)
edata &lt;- abex$env_data
etrain &lt;- edata[edata$trian_test=="Train",] |&gt; data.frame()
etest &lt;- edata[edata$trian_test=="Test",] |&gt; data.frame()
bg &lt;- abbg$env_bg
res1 &lt;- tenm::ellipsoid_selection(env_train = etrain,
                                  env_test = etest,
                                  env_vars = varcorrs$descriptors,
                                  nvarstest = 3,
                                  level = 0.975,
                                  mve = TRUE,
                                  env_bg = bg,
                                  omr_criteria = 0.1,
                                  parallel = FALSE,proc = TRUE)
head(res1)


</code></pre>


</div>