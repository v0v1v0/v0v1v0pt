<div class="container">

<table style="width: 100%;"><tr>
<td>h_response_subgroups</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Helper functions for tabulating binary response by subgroup</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>Helper functions that tabulate in a data frame statistics such as response rate
and odds ratio for population subgroups.
</p>


<h3>Usage</h3>

<pre><code class="language-R">h_proportion_df(rsp, arm)

h_proportion_subgroups_df(
  variables,
  data,
  groups_lists = list(),
  label_all = "All Patients"
)

h_odds_ratio_df(rsp, arm, strata_data = NULL, conf_level = 0.95, method = NULL)

h_odds_ratio_subgroups_df(
  variables,
  data,
  groups_lists = list(),
  conf_level = 0.95,
  method = NULL,
  label_all = "All Patients"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rsp</code></td>
<td>
<p>(<code>logical</code>)<br> vector indicating whether each subject is a responder or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arm</code></td>
<td>
<p>(<code>factor</code>)<br> the treatment group variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>(named <code>list</code> of <code>string</code>)<br> list of additional analysis variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>(<code>data.frame</code>)<br> the dataset containing the variables to summarize.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups_lists</code></td>
<td>
<p>(named <code>list</code> of <code>list</code>)<br> optionally contains for each <code>subgroups</code> variable a
list, which specifies the new group levels via the names and the
levels that belong to it in the character vectors that are elements of the list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_all</code></td>
<td>
<p>(<code>string</code>)<br> label for the total population analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata_data</code></td>
<td>
<p>(<code>factor</code>, <code>data.frame</code>, or <code>NULL</code>)<br> required if stratified analysis is performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf_level</code></td>
<td>
<p>(<code>proportion</code>)<br> confidence level of the interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>(<code>string</code> or <code>NULL</code>)<br> specifies the test used to calculate the p-value for the difference between
two proportions. For options, see <code>test_proportion_diff()</code>. Default is <code>NULL</code> so no test is performed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Main functionality is to prepare data for use in a layout-creating function.
</p>


<h3>Value</h3>


<ul><li> <p><code>h_proportion_df()</code> returns a <code>data.frame</code> with columns <code>arm</code>, <code>n</code>, <code>n_rsp</code>, and <code>prop</code>.
</p>
</li></ul>
<ul><li> <p><code>h_proportion_subgroups_df()</code> returns a <code>data.frame</code> with columns <code>arm</code>, <code>n</code>, <code>n_rsp</code>, <code>prop</code>, <code>subgroup</code>,
<code>var</code>, <code>var_label</code>, and <code>row_type</code>.
</p>
</li></ul>
<ul><li> <p><code>h_odds_ratio_df()</code> returns a <code>data.frame</code> with columns <code>arm</code>, <code>n_tot</code>, <code>or</code>, <code>lcl</code>, <code>ucl</code>, <code>conf_level</code>, and
optionally <code>pval</code> and <code>pval_label</code>.
</p>
</li></ul>
<ul><li> <p><code>h_odds_ratio_subgroups_df()</code> returns a <code>data.frame</code> with columns <code>arm</code>, <code>n_tot</code>, <code>or</code>, <code>lcl</code>, <code>ucl</code>,
<code>conf_level</code>, <code>subgroup</code>, <code>var</code>, <code>var_label</code>, and <code>row_type</code>.
</p>
</li></ul>
<h3>Functions</h3>


<ul>
<li> <p><code>h_proportion_df()</code>: Helper to prepare a data frame of binary responses by arm.
</p>
</li>
<li> <p><code>h_proportion_subgroups_df()</code>: Summarizes proportion of binary responses by arm and across subgroups
in a data frame. <code>variables</code> corresponds to the names of variables found in <code>data</code>, passed as a named list and
requires elements <code>rsp</code>, <code>arm</code> and optionally <code>subgroups</code>. <code>groups_lists</code> optionally specifies
groupings for <code>subgroups</code> variables.
</p>
</li>
<li> <p><code>h_odds_ratio_df()</code>: Helper to prepare a data frame with estimates of
the odds ratio between a treatment and a control arm.
</p>
</li>
<li> <p><code>h_odds_ratio_subgroups_df()</code>: Summarizes estimates of the odds ratio between a treatment and a control
arm across subgroups in a data frame. <code>variables</code> corresponds to the names of variables found in
<code>data</code>, passed as a named list and requires elements <code>rsp</code>, <code>arm</code> and optionally <code>subgroups</code>
and <code>strata</code>. <code>groups_lists</code> optionally specifies groupings for <code>subgroups</code> variables.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">library(dplyr)
library(forcats)

adrs &lt;- tern_ex_adrs
adrs_labels &lt;- formatters::var_labels(adrs)

adrs_f &lt;- adrs %&gt;%
  filter(PARAMCD == "BESRSPI") %&gt;%
  filter(ARM %in% c("A: Drug X", "B: Placebo")) %&gt;%
  droplevels() %&gt;%
  mutate(
    # Reorder levels of factor to make the placebo group the reference arm.
    ARM = fct_relevel(ARM, "B: Placebo"),
    rsp = AVALC == "CR"
  )
formatters::var_labels(adrs_f) &lt;- c(adrs_labels, "Response")

h_proportion_df(
  c(TRUE, FALSE, FALSE),
  arm = factor(c("A", "A", "B"), levels = c("A", "B"))
)

h_proportion_subgroups_df(
  variables = list(rsp = "rsp", arm = "ARM", subgroups = c("SEX", "BMRKR2")),
  data = adrs_f
)

# Define groupings for BMRKR2 levels.
h_proportion_subgroups_df(
  variables = list(rsp = "rsp", arm = "ARM", subgroups = c("SEX", "BMRKR2")),
  data = adrs_f,
  groups_lists = list(
    BMRKR2 = list(
      "low" = "LOW",
      "low/medium" = c("LOW", "MEDIUM"),
      "low/medium/high" = c("LOW", "MEDIUM", "HIGH")
    )
  )
)

# Unstratatified analysis.
h_odds_ratio_df(
  c(TRUE, FALSE, FALSE, TRUE),
  arm = factor(c("A", "A", "B", "B"), levels = c("A", "B"))
)

# Include p-value.
h_odds_ratio_df(adrs_f$rsp, adrs_f$ARM, method = "chisq")

# Stratatified analysis.
h_odds_ratio_df(
  rsp = adrs_f$rsp,
  arm = adrs_f$ARM,
  strata_data = adrs_f[, c("STRATA1", "STRATA2")],
  method = "cmh"
)

# Unstratified analysis.
h_odds_ratio_subgroups_df(
  variables = list(rsp = "rsp", arm = "ARM", subgroups = c("SEX", "BMRKR2")),
  data = adrs_f
)

# Stratified analysis.
h_odds_ratio_subgroups_df(
  variables = list(
    rsp = "rsp",
    arm = "ARM",
    subgroups = c("SEX", "BMRKR2"),
    strata = c("STRATA1", "STRATA2")
  ),
  data = adrs_f
)

# Define groupings of BMRKR2 levels.
h_odds_ratio_subgroups_df(
  variables = list(
    rsp = "rsp",
    arm = "ARM",
    subgroups = c("SEX", "BMRKR2")
  ),
  data = adrs_f,
  groups_lists = list(
    BMRKR2 = list(
      "low" = "LOW",
      "low/medium" = c("LOW", "MEDIUM"),
      "low/medium/high" = c("LOW", "MEDIUM", "HIGH")
    )
  )
)

</code></pre>


</div>