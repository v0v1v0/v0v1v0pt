<div class="container">

<table style="width: 100%;"><tr>
<td>run_test_file</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Run an R file containing tests; gather results</h2>

<h3>Description</h3>

<p>Run an R file containing tests; gather results
</p>


<h3>Usage</h3>

<pre><code class="language-R">run_test_file(
  file,
  at_home = TRUE,
  verbose = getOption("tt.verbose", 2),
  color = getOption("tt.pr.color", TRUE),
  remove_side_effects = TRUE,
  side_effects = FALSE,
  set_env = list(),
  encoding = "unknown",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p><code>[character]</code> File location of a .R file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>at_home</code></td>
<td>
<p><code>[logical]</code> toggle local tests.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p><code>[integer]</code> verbosity level. 0: be quiet, 1: print
status per file, 2: print status and increase counter after each test expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color</code></td>
<td>
<p><code>[logical]</code> toggle colorize counts in verbose mode (see Note)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>remove_side_effects</code></td>
<td>
<p><code>[logical]</code> toggle remove user-defined side
effects? See section on side effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>side_effects</code></td>
<td>
<p><code>[logical|list]</code> Either a logical,
or a list of arguments to pass to <code>report_side_effects</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>set_env</code></td>
<td>
<p><code>[named list]</code>. Key=value pairs of environment variables
that will be set before the test file is run and reset afterwards. These are not
counted as side effects of the code under scrutiny.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>encoding</code></td>
<td>
<p><code>[character]</code> Define encoding argument passed to <code>parse</code>
when parsing <code>file</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Currently unused</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In <span class="pkg">tinytest</span>, a test file is just an R script where some or all
of the statements express an <code>expectation</code>.
<code>run_test_file</code> runs the file while gathering results of the
expectations in a <code>tinytests</code> object.
</p>
<p>The graphics device is set to <code>pdf(file=tempfile())</code> for the run of the
test file.
</p>


<h3>Value</h3>

<p>A <code>list</code> of class <code>tinytests</code>, which is a list of
<code>tinytest</code> objects.
</p>


<h3>Side-effects caused by test code</h3>

<p>All calls to <code>Sys.setenv</code> and <code>options</code>
defined in a test file are captured and undone once the test file has run,
if <code>remove_side_effects</code> is set to <code>TRUE</code>.
</p>


<h3>Tracking side effects</h3>

<p>Certain side effects can be tracked, even when they are not explicitly
evoked in the test file. See <code>report_side_effects</code> for side
effects tracked by <span class="pkg">tinytest</span>.  Calls to <code>report_side_effects</code>
within the test file overrule settings provided with this function.
</p>


<h3>Note</h3>

<p>Not all terminals support ansi escape characters, so colorized output can be
switched off. This can also be done globally by setting
<code>options(tt.pr.color=FALSE)</code>.  Some terminals that do support ansi
escape characters may contain bugs. An example is the RStudio terminal
(RStudio 1.1) running on Ubuntu 16.04 (and possibly other OSs).
</p>


<h3>See Also</h3>

<p><code>ignore</code>
</p>
<p>Other test-files: 
<code>build_install_test()</code>,
<code>exit_file()</code>,
<code>run_test_dir()</code>,
<code>summary.tinytests()</code>,
<code>test_package()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># create a test file, in temp directory
tests &lt;- "
addOne &lt;- function(x) x + 2

Sys.setenv(lolz=2)

expect_true(addOne(0) &gt; 0)
expect_equal(2, addOne(1))

Sys.unsetenv('lolz')
"
testfile &lt;- tempfile(pattern="test_", fileext=".R")
write(tests, testfile)

# run test file
out &lt;- run_test_file(testfile,color=FALSE)
out
# print everything in short format, include passes in print.
print(out, nlong=0, passes=TRUE)

# run test file, track supported side-effects
run_test_file(testfile, side_effects=TRUE)

# run test file, track only changes in working directory 
run_test_file(testfile, side_effects=list(pwd=TRUE, envvar=FALSE))


</code></pre>


</div>