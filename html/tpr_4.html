<div class="container">

<table style="width: 100%;"><tr>
<td>dnase</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> rhDNase Data </h2>

<h3>Description</h3>

<p>Randomized trial of rhDNase for treatment of cystic fibrosis
</p>


<h3>Usage</h3>

<pre><code class="language-R">data(dnase)</code></pre>


<h3>Format</h3>

<p>A data frame with 767 observations on the following 6 variables.
</p>

<dl>
<dt><code>id</code></dt>
<dd>
<p>subject id</p>
</dd>
<dt><code>rx</code></dt>
<dd>
<p>treatment arm: 0 = placebo, 1 = rhDNase</p>
</dd>
<dt><code>fev</code></dt>
<dd>
<p>forced expirotary volume, a measure of lung capacity</p>
</dd>
<dt><code>futime</code></dt>
<dd>
<p>follow time</p>
</dd>
<dt><code>iv1</code></dt>
<dd>
<p>IV start time</p>
</dd>
<dt><code>iv2</code></dt>
<dd>
<p>IV stop time</p>
</dd>
</dl>
<h3>Details</h3>

<p>During an exacerbation, patients received intravenous (IV) 
antibiotics and were considered unsusceptible until seven
exacerbation-free days beyond the end of IV therapy.
</p>
<p>A few subjects were infected at the time of enrollment,
for instance a subject has a first infection interval of
-21 to 7. We do not count this first infection as an "event",
and the subject first enters the risk set at day 7.
</p>


<h3>Source</h3>

<p>Therneau and Grambsch (2000). Modeling Survival Data: Extending the
Cox model. Springer. 
http://www.mayo.edu/hsr/people/therneau/book/data/dnase.html
</p>


<h3>References</h3>

<p>Yan and Fine (2008). Analysis of Episodic Data with Application to
Recurrent Pulmonary Exacerbations in Cystic Fibrosis Patients. JASA.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## This example steps through how to set up for the tpr function.
## Three objects are needed:
##     1) response process (an object of "lgtdl")
##     2) data availability process (an object of "lgtdl")
##     3) a time-independent covariate matrix

data(dnase)

## extracting the unique id and subject level information
dat &lt;- unique(dnase[,c("id", "futime", "fev", "rx")])

## construct temporal process response for recurrent enent
rec &lt;- lapply(split(dnase[,c("id", "iv1", "futime")], dnase$id),
              function(x) {
                v &lt;- x$iv1
                maxfu &lt;- max(x$futime)
                ## iv1 may be negative!!!
                if (is.na(v[1])) c(0, maxfu + 1.0)
                else if (v[1] &lt; 0) c(v[1] - 1, v[!is.na(v)], maxfu + 1.0)
                else c(0, v[!is.na(v)], maxfu + 1.0)
              })

yrec &lt;- lapply(rec,
               function(x) {
                 dat &lt;- data.frame(time=x, cov=1:length(x)-1)
                 len &lt;- length(x)
                 dat$cov[len] &lt;- dat$cov[len - 1]
                 as.lgtdl(dat)
               })

## construct temporal process response for accumulative days exacerbation
do1.acc &lt;- function(x) {
  gap &lt;- x$iv2 - x$iv1 + 1
  if (all(is.na(gap))) yy &lt;- tt &lt;- NULL
  else {
    gap &lt;- na.omit(gap)
    yy &lt;- cumsum(rep(1, sum(gap)))
    tt &lt;- unlist(sapply(1:length(gap), function(i)
                        seq(x$iv1[i], x$iv2[i], by=1.0)))
  }
  yy &lt;- c(0, yy, rev(yy)[1])
  if (!is.null(tt[1]) &amp;&amp; tt[1] &lt; 0)
    tt &lt;- c(tt[1] - 1, tt, max(x$futime) + 1.0)
  else tt &lt;- c(0, tt, max(x$futime) + 1.0)
  as.lgtdl(data.frame(time=tt, cov=yy))
}

yacc &lt;- lapply(split(dnase[,c("id", "iv1", "iv2", "futime")], dnase$id),
              do1.acc)

## construct data availability (or at risk) indicator process
tu &lt;- max(dat$futime) + 0.001
rt &lt;- lapply(1:nrow(dat),
             function(i) {
               x &lt;- dat[i, "futime"]
               time &lt;- c(0, x, tu)
               cov &lt;- c(1, 0, 0)
               as.lgtdl(data.frame(time=time, cov=cov))
             })

## time-independent covariate matrix
xmat &lt;- model.matrix(~ rx + fev, data=dat)
## time-window in days
tlim &lt;- c(10, 168)
good &lt;- unlist(lapply(yrec, function(x) x$time[1] == 0))


## fully functional temporal process regression

## for recurrent event
m.rec &lt;- tpr(yrec, rt, xmat[,1:3], list(), xmat[,-(1:3),drop=FALSE], list(),
             tis=10:160, w = rep(1, 151), family = poisson(),
             evstr = list(link = 5, v = 3))
par(mfrow=c(1,3), mgp=c(2,1,0), mar=c(4,2,1,0), oma=c(0,2,0,0))
for(i in 1:3) ci.plot(m.rec$tis, m.rec$alpha[,i], sqrt(m.rec$valpha[,i]))
## hypothesis test of significance
## integral test, covariate index 2 and 3
sig.test.int.ff(m.rec, idx=2:3, ncut=2)
sig.test.boots.ff(m.rec, idx=2:3, nsim=1000)
## constant fit
cfit &lt;- cst.fit.ff(m.rec, idx=2:3)

## goodness-of-fit test for constant fit
gof.test.int.ff(m.rec, idx=2:3, ncut=2)
gof.test.boots.ff(m.rec, idx=2:3, nsim=1000)




## for cumulative days in exacerbation
m.acc &lt;- tpr(yacc, rt, xmat[,1:3], list(), xmat[,-(1:3),drop=FALSE], list(),
             tis=10:160, w = rep(1, 151), family = gaussian(),
             evstr = list(link = 1, v = 1))
par(mfrow=c(1,3), mgp=c(2,1,0), mar=c(4,2,1,0), oma=c(0,2,0,0))
for(i in 1:3) ci.plot(m.acc$tis, m.acc$alpha[,i], sqrt(m.acc$valpha[,i]))
</code></pre>


</div>