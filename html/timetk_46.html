<div class="container">

<table style="width: 100%;"><tr>
<td>plot_acf_diagnostics</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Visualize the ACF, PACF, and CCFs for One or More Time Series</h2>

<h3>Description</h3>

<p>Returns the <strong>ACF and PACF of a target</strong> and
optionally <strong>CCF's of one or more lagged predictors</strong> in interactive <code>plotly</code> plots. Scales
to multiple time series with <code>group_by()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_acf_diagnostics(
  .data,
  .date_var,
  .value,
  .ccf_vars = NULL,
  .lags = 1000,
  .show_ccf_vars_only = FALSE,
  .show_white_noise_bars = TRUE,
  .facet_ncol = 1,
  .facet_scales = "fixed",
  .line_color = "#2c3e50",
  .line_size = 0.5,
  .line_alpha = 1,
  .point_color = "#2c3e50",
  .point_size = 1,
  .point_alpha = 1,
  .x_intercept = NULL,
  .x_intercept_color = "#E31A1C",
  .hline_color = "#2c3e50",
  .white_noise_line_type = 2,
  .white_noise_line_color = "#A6CEE3",
  .title = "Lag Diagnostics",
  .x_lab = "Lag",
  .y_lab = "Correlation",
  .interactive = TRUE,
  .plotly_slider = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.data</code></td>
<td>
<p>A data frame or tibble with numeric features (values) in descending
chronological order</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.date_var</code></td>
<td>
<p>A column containing either date or date-time values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.value</code></td>
<td>
<p>A numeric column with a value to have ACF and PACF calculations
performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.ccf_vars</code></td>
<td>
<p>Additional features to perform Lag Cross Correlations (CCFs)
versus the <code>.value</code>. Useful for evaluating external lagged regressors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.lags</code></td>
<td>
<p>A sequence of one or more lags to evaluate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.show_ccf_vars_only</code></td>
<td>
<p>Hides the ACF and PACF plots so you can focus on only CCFs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.show_white_noise_bars</code></td>
<td>
<p>Shows the white noise significance bounds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.facet_ncol</code></td>
<td>
<p>Facets: Number of facet columns. Has no effect if using <code>grouped_df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.facet_scales</code></td>
<td>
<p>Facets: Options include "fixed", "free", "free_y", "free_x"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.line_color</code></td>
<td>
<p>Line color. Use keyword: "scale_color" to change the color by the facet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.line_size</code></td>
<td>
<p>Line size (linewidth)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.line_alpha</code></td>
<td>
<p>Line opacity. Adjust the transparency of the line. Range: (0, 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.point_color</code></td>
<td>
<p>Point color. Use keyword: "scale_color" to change the color by the facet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.point_size</code></td>
<td>
<p>Point size</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.point_alpha</code></td>
<td>
<p>Opacity. Adjust the transparency of the points. Range: (0, 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.x_intercept</code></td>
<td>
<p>Numeric lag. Adds a vertical line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.x_intercept_color</code></td>
<td>
<p>Color for the x-intercept line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.hline_color</code></td>
<td>
<p>Color for the y-intercept = 0 line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.white_noise_line_type</code></td>
<td>
<p>Line type for white noise bars. Set to 2 for "dashed" by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.white_noise_line_color</code></td>
<td>
<p>Line color for white noise bars.
Set to <code>tidyquant::palette_light()</code> "steel blue" by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.title</code></td>
<td>
<p>Title for the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.x_lab</code></td>
<td>
<p>X-axis label for the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.y_lab</code></td>
<td>
<p>Y-axis label for the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.interactive</code></td>
<td>
<p>Returns either a static (<code>ggplot2</code>) visualization or an interactive (<code>plotly</code>) visualization</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.plotly_slider</code></td>
<td>
<p>If TRUE, returns a plotly x-axis range slider.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><strong>Simplified ACF, PACF, &amp; CCF</strong>
</p>
<p>We are often interested in all 3 of these functions. Why not get all 3+ at once?
Now you can.
</p>

<ul>
<li> <p><strong>ACF</strong> - Autocorrelation between a target variable and lagged versions of itself
</p>
</li>
<li> <p><strong>PACF</strong> - Partial Autocorrelation removes the dependence of lags on
other lags highlighting key seasonalities.
</p>
</li>
<li> <p><strong>CCF</strong> - Shows how lagged predictors can be used for prediction of a target
variable.
</p>
</li>
</ul>
<p><strong>Lag Specification</strong>
</p>
<p>Lags (<code>.lags</code>) can either be specified as:
</p>

<ul>
<li>
<p> A time-based phrase indicating a duraction (e.g. <code style="white-space: pre;">⁠2 months⁠</code>)
</p>
</li>
<li>
<p> A maximum lag (e.g. <code>.lags = 28</code>)
</p>
</li>
<li>
<p> A sequence of lags (e.g. <code>.lags = 7:28</code>)
</p>
</li>
</ul>
<p><strong>Scales to Multiple Time Series with Groups</strong>
</p>
<p>The <code>plot_acf_diagnostics()</code> works with <code>grouped_df</code>'s, meaning you can
group your time series by one or more categorical columns with <code>dplyr::group_by()</code>
and then apply <code>plot_acf_diagnostics()</code> to return group-wise lag diagnostics.
</p>
<p><strong>Special Note on Groups</strong>
</p>
<p>Unlike other plotting utilities, the <code>.facet_vars</code> arguments is NOT included.
Use <code>dplyr::group_by()</code> for processing multiple time series groups.
</p>
<p><strong>Calculating the White Noise Significance Bars</strong>
</p>
<p>The formula for the significance bars is <code>+2/sqrt(T)</code> and <code>-2/sqrt(T)</code> where <code>T</code> is the length of the
time series. For a white noise time series, 95% of the data points should fall
within this range. Those that don't may be significant autocorrelations.
</p>


<h3>Value</h3>

<p>A static <code>ggplot2</code> plot or an interactive <code>plotly</code> plot
</p>


<h3>See Also</h3>


<ul>
<li> <p><strong>Visualizing ACF, PACF, &amp; CCF:</strong> <code>plot_acf_diagnostics()</code>
</p>
</li>
<li> <p><strong>Visualizing Seasonality:</strong> <code>plot_seasonal_diagnostics()</code>
</p>
</li>
<li> <p><strong>Visualizing Time Series:</strong> <code>plot_time_series()</code>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">library(dplyr)
library(ggplot2)


# Apply Transformations
# - Differencing transformation to identify ARIMA &amp; SARIMA Orders
m4_hourly %&gt;%
    group_by(id) %&gt;%
    plot_acf_diagnostics(
        date, value,               # ACF &amp; PACF
        .lags = "7 days",          # 7-Days of hourly lags
        .interactive = FALSE
    )

# Apply Transformations
# - Differencing transformation to identify ARIMA &amp; SARIMA Orders
m4_hourly %&gt;%
    group_by(id) %&gt;%
    plot_acf_diagnostics(
        date,
        diff_vec(value, lag = 1), # Difference the value column
        .lags        = 0:(24*7),   # 7-Days of hourly lags
        .interactive = FALSE
    ) +
    ggtitle("ACF Diagnostics",  subtitle = "1st Difference")

# CCFs Too!
walmart_sales_weekly %&gt;%
    select(id, Date, Weekly_Sales, Temperature, Fuel_Price) %&gt;%
    group_by(id) %&gt;%
    plot_acf_diagnostics(
        Date, Weekly_Sales,                        # ACF &amp; PACF
        .ccf_vars    = c(Temperature, Fuel_Price), # CCFs
        .lags        = "3 months", # 3 months of weekly lags
        .interactive = FALSE
    )

</code></pre>


</div>