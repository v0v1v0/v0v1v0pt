<div class="container">

<table style="width: 100%;"><tr>
<td>geom_spatraster</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Visualise <code>SpatRaster</code> objects</h2>

<h3>Description</h3>

<p>This geom is used to visualise <code>SpatRaster</code> objects (see <code>terra::rast()</code>).
The geom is designed for visualise the object by layers, as <code>terra::plot()</code>
does.
</p>
<p>For plotting <code>SpatRaster</code> objects as map tiles (i.e. RGB <code>SpatRaster</code>), use
<code>geom_spatraster_rgb()</code>.
</p>
<p>The underlying implementation is based on <code>ggplot2::geom_raster()</code>.
</p>
<p><code>stat_spatraster()</code> is provided as a complementary function, so the <code>geom</code>
can be modified.
</p>


<h3>Usage</h3>

<pre><code class="language-R">geom_spatraster(
  mapping = aes(),
  data,
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = FALSE,
  interpolate = FALSE,
  maxcell = 5e+05,
  use_coltab = TRUE,
  ...
)

stat_spatraster(
  mapping = aes(),
  data,
  geom = "raster",
  na.rm = TRUE,
  show.legend = NA,
  inherit.aes = FALSE,
  maxcell = 5e+05,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code>ggplot2::aes()</code>. See
<strong>Aesthetics</strong> specially in the use of <code>fill</code> aesthetic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>SpatRaster</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>If <code>TRUE</code>, the default, missing values are silently removed. If
<code>FALSE</code>, missing values are removed with a warning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics, rather
than combining with them.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interpolate</code></td>
<td>
<p>If <code>TRUE</code> interpolate linearly, if <code>FALSE</code>
(the default) don't interpolate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxcell</code></td>
<td>
<p>positive integer. Maximum number of cells to use for
the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_coltab</code></td>
<td>
<p>Logical. Only applicable to <code>SpatRaster</code> objects that have
an associated coltab. Should the coltab be used on the
plot? See also <code>scale_fill_coltab()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed on to <code>layer()</code>'s <code>params</code> argument. These
arguments broadly fall into one of 4 categories below. Notably, further
arguments to the <code>position</code> argument, or aesthetics that are required
can <em>not</em> be passed through <code>...</code>. Unknown arguments that are not part
of the 4 categories below are ignored.
</p>

<ul>
<li>
<p> Static aesthetics that are not mapped to a scale, but are at a fixed
value and apply to the layer as a whole. For example, <code>colour = "red"</code>
or <code>linewidth = 3</code>. The geom's documentation has an <strong>Aesthetics</strong>
section that lists the available options. The 'required' aesthetics
cannot be passed on to the <code>params</code>. Please note that while passing
unmapped aesthetics as vectors is technically possible, the order and
required length is not guaranteed to be parallel to the input data.
</p>
</li>
<li>
<p> When constructing a layer using
a <code style="white-space: pre;">⁠stat_*()⁠</code> function, the <code>...</code> argument can be used to pass on
parameters to the <code>geom</code> part of the layer. An example of this is
<code>stat_density(geom = "area", outline.type = "both")</code>. The geom's
documentation lists which parameters it can accept.
</p>
</li>
<li>
<p> Inversely, when constructing a layer using a
<code style="white-space: pre;">⁠geom_*()⁠</code> function, the <code>...</code> argument can be used to pass on parameters
to the <code>stat</code> part of the layer. An example of this is
<code>geom_area(stat = "density", adjust = 0.5)</code>. The stat's documentation
lists which parameters it can accept.
</p>
</li>
<li>
<p> The <code>key_glyph</code> argument of <code>layer()</code> may also be passed on through
<code>...</code>. This can be one of the functions described as
key glyphs, to change the display of the layer in the legend.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geom</code></td>
<td>
<p>The geometric object to use display the data. Recommended <code>geom</code>
for <code>SpatRaster</code> are <code>"raster"</code> (the default), <code>"point"</code>,<code>"text"</code> and
<code>"label"</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <a href="https://CRAN.R-project.org/package=ggplot2"><span class="pkg">ggplot2</span></a> layer
</p>


<h3>
<a href="https://CRAN.R-project.org/package=terra"><span class="pkg">terra</span></a> equivalent</h3>

<p><code>terra::plot()</code>
</p>


<h3>Coords</h3>

<p>When the <code>SpatRaster</code> does not present a crs (i.e.,
<code>terra::crs(rast) == ""</code>) the geom does not make any assumption on the
scales.
</p>
<p>On <code>SpatRaster</code> that have a crs, the geom uses <code>ggplot2::coord_sf()</code> to
adjust the scales. That means that also the
<strong><code>SpatRaster</code> may be reprojected</strong>.
</p>


<h3>Aesthetics</h3>

<p><code>geom_spatraster()</code> understands the following aesthetics:
</p>

<ul>
<li> <p><code>fill</code>
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
</ul>
<p>If <code>fill</code> is not provided, <code>geom_spatraster()</code> creates a <a href="https://CRAN.R-project.org/package=ggplot2"><span class="pkg">ggplot2</span></a>
layer with all the layers of the <code>SpatRaster</code> object. Use <code>facet_wrap(~lyr)</code>
to display properly the <code>SpatRaster</code> layers.
</p>
<p>If <code>fill</code> is used, it should contain the name of one layer that is present
on the <code>SpatRaster</code> (i.e.
<code style="white-space: pre;">⁠geom_spatraster(data = rast, aes(fill = &lt;name_of_lyr&gt;)⁠</code>). Names of the
layers can be retrieved using <code>names(rast)</code>.
</p>
<p>Using <code>geom_spatraster(..., mapping = aes(fill = NULL))</code> or
<code style="white-space: pre;">⁠geom_spatraster(..., fill = &lt;color value(s)&gt;)⁠</code> would create a layer with no
mapped <code>fill</code> aesthetic.
</p>
<p><code>fill</code> can use computed variables.
</p>
<p>For <code>alpha</code> use computed variable. See section <strong>Computed variables</strong>.
</p>


<h4><code>stat_spatraster()</code></h4>

<p><code>stat_spatraster()</code> understands the same aesthetics than <code>geom_spatraster()</code>
when using <code>geom = "raster"</code> (the default):
</p>

<ul>
<li> <p><code>fill</code>
</p>
</li>
<li> <p><code>alpha</code>
</p>
</li>
</ul>
<p>When <code>geom = "raster"</code> the <code>fill</code> parameter would behave as in
<code>geom_spatraster()</code>. If another <code>geom</code> is used <code>stat_spatraster()</code> would
understand the aesthetics of the required <code>geom</code> and
<code style="white-space: pre;">⁠aes(fill = &lt;name_of_lyr&gt;)⁠</code> would not be applicable.
</p>
<p>Note also that mapping of aesthetics <code>x</code> and <code>y</code> is provided by default,
so the user does not need to add those aesthetics on <code>aes()</code>. In all the
cases the aesthetics should be mapped by using computed variables. See
section <strong>Computed variables</strong> and <strong>Examples</strong>.
</p>



<h3>Facets</h3>

<p>You can use <code> facet_wrap(~lyr)</code> for creating a faceted plot by each layer of
the <code>SpatRaster</code> object. See <code>ggplot2::facet_wrap()</code> for details.
</p>


<h3>Computed variables</h3>

<p>This geom computes internally some variables that are available for use as
aesthetics, using (for example) <code>aes(alpha = after_stat(value))</code> (see
<code>ggplot2::after_stat()</code>).
</p>

<ul>
<li> <p><code>after_stat(value)</code>: Values of the <code>SpatRaster.</code>
</p>
</li>
<li> <p><code>after_stat(lyr)</code>: Name of the layer.
</p>
</li>
</ul>
<h3>Source</h3>

<p>Based on the <code>layer_spatial()</code> implementation on <a href="https://CRAN.R-project.org/package=ggspatial"><span class="pkg">ggspatial</span></a> package.
Thanks to <a href="https://github.com/paleolimbot">Dewey Dunnington</a> and <a href="https://github.com/paleolimbot/ggspatial/graphs/contributors">ggspatial contributors</a>.
</p>


<h3>See Also</h3>

<p><code>ggplot2::geom_raster()</code>, <code>ggplot2::coord_sf()</code>,
<code>ggplot2::facet_wrap()</code>
</p>
<p>Recommended <code>geoms</code>:
</p>

<ul>
<li> <p><code>ggplot2::geom_point()</code>.
</p>
</li>
<li> <p><code>ggplot2::geom_label()</code>.
</p>
</li>
<li> <p><code>ggplot2::geom_text()</code>.
</p>
</li>
</ul>
<p>Other <a href="https://CRAN.R-project.org/package=ggplot2"><span class="pkg">ggplot2</span></a> utils:
<code>autoplot.Spat</code>,
<code>fortify.Spat</code>,
<code>geom_spat_contour</code>,
<code>geom_spatraster_rgb()</code>,
<code>ggspatvector</code>,
<code>stat_spat_coordinates()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Avg temperature on spring in Castille and Leon (Spain)
file_path &lt;- system.file("extdata/cyl_temp.tif", package = "tidyterra")

library(terra)
temp_rast &lt;- rast(file_path)

library(ggplot2)

# Display a single layer
names(temp_rast)

ggplot() +
  geom_spatraster(data = temp_rast, aes(fill = tavg_04)) +
  # You can use coord_sf
  coord_sf(crs = 3857) +
  scale_fill_grass_c(palette = "celsius")

# Display facets
ggplot() +
  geom_spatraster(data = temp_rast) +
  facet_wrap(~lyr, ncol = 2) +
  scale_fill_grass_b(palette = "celsius", breaks = seq(0, 20, 2.5))

# Non spatial rasters

no_crs &lt;- rast(crs = NA, extent = c(0, 100, 0, 100), nlyr = 1)
values(no_crs) &lt;- seq_len(ncell(no_crs))


ggplot() +
  geom_spatraster(data = no_crs)

# Downsample

ggplot() +
  geom_spatraster(data = no_crs, maxcell = 25)



# Using stat_spatraster
# Default
ggplot() +
  stat_spatraster(data = temp_rast) +
  facet_wrap(~lyr)

# Using points
ggplot() +
  stat_spatraster(
    data = temp_rast,
    aes(color = after_stat(value)),
    geom = "point", maxcell = 250
  ) +
  scale_colour_viridis_c(na.value = "transparent") +
  facet_wrap(~lyr)

# Using points and labels

r_single &lt;- temp_rast %&gt;% select(1)

ggplot() +
  stat_spatraster(
    data = r_single,
    aes(color = after_stat(value)),
    geom = "point",
    maxcell = 2000
  ) +
  stat_spatraster(
    data = r_single,
    aes(label = after_stat(round(value, 2))),
    geom = "label",
    alpha = 0.85,
    maxcell = 20
  ) +
  scale_colour_viridis_c(na.value = "transparent")

</code></pre>


</div>