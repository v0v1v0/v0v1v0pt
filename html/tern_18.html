<div class="container">

<table style="width: 100%;"><tr>
<td>summarize_patients_exposure_in_cols</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Count number of patients and sum exposure across all patients in columns</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>The analyze function <code>analyze_patients_exposure_in_cols()</code> creates a layout element to count total numbers of
patients and sum an analysis value (i.e. exposure) across all patients in columns.
</p>
<p>The primary analysis variable <code>ex_var</code> is the exposure variable used to calculate the <code>sum_exposure</code> statistic. The
<code>id</code> variable is used to uniquely identify patients in the data such that only unique patients are counted in the
<code>n_patients</code> statistic, and the <code>var</code> variable is used to create a row split if needed. The percentage returned as
part of the <code>n_patients</code> statistic is the proportion of all records that correspond to a unique patient.
</p>
<p>The summarize function <code>summarize_patients_exposure_in_cols()</code> performs the same function as
<code>analyze_patients_exposure_in_cols()</code> except it creates content rows, not data rows, to summarize the current table
row/column context and operates on the level of the latest row split or the root of the table if no row splits have
occurred.
</p>
<p>If a column split has not yet been performed in the table, <code>col_split</code> must be set to <code>TRUE</code> for the first call of
<code>analyze_patients_exposure_in_cols()</code> or <code>summarize_patients_exposure_in_cols()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">analyze_patients_exposure_in_cols(
  lyt,
  var = NULL,
  ex_var = "AVAL",
  id = "USUBJID",
  add_total_level = FALSE,
  custom_label = NULL,
  col_split = TRUE,
  na_str = default_na_str(),
  .stats = c("n_patients", "sum_exposure"),
  .labels = c(n_patients = "Patients", sum_exposure = "Person time"),
  .indent_mods = 0L,
  ...
)

summarize_patients_exposure_in_cols(
  lyt,
  var,
  ex_var = "AVAL",
  id = "USUBJID",
  add_total_level = FALSE,
  custom_label = NULL,
  col_split = TRUE,
  na_str = default_na_str(),
  ...,
  .stats = c("n_patients", "sum_exposure"),
  .labels = c(n_patients = "Patients", sum_exposure = "Person time"),
  .indent_mods = NULL
)

s_count_patients_sum_exposure(
  df,
  ex_var = "AVAL",
  id = "USUBJID",
  labelstr = "",
  .stats = c("n_patients", "sum_exposure"),
  .N_col,
  custom_label = NULL
)

a_count_patients_sum_exposure(
  df,
  var = NULL,
  ex_var = "AVAL",
  id = "USUBJID",
  add_total_level = FALSE,
  custom_label = NULL,
  labelstr = "",
  .N_col,
  .stats,
  .formats = list(n_patients = "xx (xx.x%)", sum_exposure = "xx")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lyt</code></td>
<td>
<p>(<code>PreDataTableLayouts</code>)<br> layout that analyses will be added to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>(<code>string</code>)<br> single variable name that is passed by <code>rtables</code> when requested
by a statistics function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ex_var</code></td>
<td>
<p>(<code>string</code>)<br> name of the variable in <code>df</code> containing exposure values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>(<code>string</code>)<br> subject variable name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_total_level</code></td>
<td>
<p>(<code>flag</code>)<br> adds a "total" level after the others which includes all the levels
that constitute the split. A custom label can be set for this level via the <code>custom_label</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>custom_label</code></td>
<td>
<p>(<code>string</code> or <code>NULL</code>)<br> if provided and <code>labelstr</code> is empty, this will be used as label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_split</code></td>
<td>
<p>(<code>flag</code>)<br> whether the columns should be split. Set to <code>FALSE</code> when the required
column split has been done already earlier in the layout pipe.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_str</code></td>
<td>
<p>(<code>string</code>)<br> string used to replace all <code>NA</code> or empty values in the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.stats</code></td>
<td>
<p>(<code>character</code>)<br> statistics to select for the table. Run
<code>get_stats("analyze_patients_exposure_in_cols")</code> to see available statistics for this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.labels</code></td>
<td>
<p>(named <code>character</code>)<br> labels for the statistics (without indent).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.indent_mods</code></td>
<td>
<p>(named <code>integer</code>)<br> indent modifiers for the labels. Defaults to 0, which corresponds to the
unmodified default behavior. Can be negative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments for the lower level functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>(<code>data.frame</code>)<br> data set containing all analysis variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelstr</code></td>
<td>
<p>(<code>string</code>)<br> label of the level of the parent split currently being summarized
(must be present as second argument in Content Row Functions). See <code>rtables::summarize_row_groups()</code>
for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.N_col</code></td>
<td>
<p>(<code>integer(1)</code>)<br> column-wise N (column count) for the full column being analyzed that is typically
passed by <code>rtables</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.formats</code></td>
<td>
<p>(named <code>character</code> or <code>list</code>)<br> formats for the statistics. See Details in <code>analyze_vars</code> for more
information on the <code>"auto"</code> setting.</p>
</td>
</tr>
</table>
<h3>Value</h3>


<ul><li> <p><code>analyze_patients_exposure_in_cols()</code> returns a layout object suitable for passing to further
layouting functions, or to <code>rtables::build_table()</code>. Adding this function to an <code>rtable</code> layout will
add formatted data rows, with the statistics from <code>s_count_patients_sum_exposure()</code> arranged in
columns, to the table layout.
</p>
</li></ul>
<ul><li> <p><code>summarize_patients_exposure_in_cols()</code> returns a layout object suitable for passing to further
layouting functions, or to <code>rtables::build_table()</code>. Adding this function to an <code>rtable</code> layout will
add formatted content rows, with the statistics from <code>s_count_patients_sum_exposure()</code> arranged in
columns, to the table layout.
</p>
</li></ul>
<ul><li> <p><code>s_count_patients_sum_exposure()</code> returns a named <code>list</code> with the statistics:
</p>

<ul>
<li> <p><code>n_patients</code>: Number of unique patients in <code>df</code>.
</p>
</li>
<li> <p><code>sum_exposure</code>: Sum of <code>ex_var</code> across all patients in <code>df</code>.
</p>
</li>
</ul>
</li></ul>
<ul><li> <p><code>a_count_patients_sum_exposure()</code> returns formatted <code>rtables::CellValue()</code>.
</p>
</li></ul>
<h3>Functions</h3>


<ul>
<li> <p><code>analyze_patients_exposure_in_cols()</code>: Layout-creating function which can take statistics
function arguments and additional format arguments. This function is a wrapper for
<code>rtables::split_cols_by_multivar()</code> and <code>rtables::analyze_colvars()</code>.
</p>
</li>
<li> <p><code>summarize_patients_exposure_in_cols()</code>: Layout-creating function which can take statistics
function arguments and additional format arguments. This function is a wrapper for
<code>rtables::split_cols_by_multivar()</code> and <code>rtables::summarize_row_groups()</code>.
</p>
</li>
<li> <p><code>s_count_patients_sum_exposure()</code>: Statistics function which counts numbers
of patients and the sum of exposure across all patients.
</p>
</li>
<li> <p><code>a_count_patients_sum_exposure()</code>: Analysis function which is used as <code>afun</code> in
<code>rtables::analyze_colvars()</code> within <code>analyze_patients_exposure_in_cols()</code> and as <code>cfun</code> in
<code>rtables::summarize_row_groups()</code> within <code>summarize_patients_exposure_in_cols()</code>.
</p>
</li>
</ul>
<h3>Note</h3>

<p>As opposed to <code>summarize_patients_exposure_in_cols()</code> which generates content rows,
<code>analyze_patients_exposure_in_cols()</code> generates data rows which will <em>not</em> be repeated on multiple
pages when pagination is used.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)
df &lt;- data.frame(
  USUBJID = c(paste("id", seq(1, 12), sep = "")),
  ARMCD = c(rep("ARM A", 6), rep("ARM B", 6)),
  SEX = c(rep("Female", 6), rep("Male", 6)),
  AVAL = as.numeric(sample(seq(1, 20), 12)),
  stringsAsFactors = TRUE
)
adsl &lt;- data.frame(
  USUBJID = c(paste("id", seq(1, 12), sep = "")),
  ARMCD = c(rep("ARM A", 2), rep("ARM B", 2)),
  SEX = c(rep("Female", 2), rep("Male", 2)),
  stringsAsFactors = TRUE
)

lyt &lt;- basic_table() %&gt;%
  split_cols_by("ARMCD", split_fun = add_overall_level("Total", first = FALSE)) %&gt;%
  summarize_patients_exposure_in_cols(var = "AVAL", col_split = TRUE) %&gt;%
  analyze_patients_exposure_in_cols(var = "SEX", col_split = FALSE)
result &lt;- build_table(lyt, df = df, alt_counts_df = adsl)
result

lyt2 &lt;- basic_table() %&gt;%
  split_cols_by("ARMCD", split_fun = add_overall_level("Total", first = FALSE)) %&gt;%
  summarize_patients_exposure_in_cols(
    var = "AVAL", col_split = TRUE,
    .stats = "n_patients", custom_label = "some custom label"
  ) %&gt;%
  analyze_patients_exposure_in_cols(var = "SEX", col_split = FALSE, ex_var = "AVAL")
result2 &lt;- build_table(lyt2, df = df, alt_counts_df = adsl)
result2

lyt3 &lt;- basic_table() %&gt;%
  analyze_patients_exposure_in_cols(var = "SEX", col_split = TRUE, ex_var = "AVAL")
result3 &lt;- build_table(lyt3, df = df, alt_counts_df = adsl)
result3

# Adding total levels and custom label
lyt4 &lt;- basic_table(
  show_colcounts = TRUE
) %&gt;%
  analyze_patients_exposure_in_cols(
    var = "ARMCD",
    col_split = TRUE,
    add_total_level = TRUE,
    custom_label = "TOTAL"
  ) %&gt;%
  append_topleft(c("", "Sex"))

result4 &lt;- build_table(lyt4, df = df, alt_counts_df = adsl)
result4

lyt5 &lt;- basic_table() %&gt;%
  summarize_patients_exposure_in_cols(var = "AVAL", col_split = TRUE)

result5 &lt;- build_table(lyt5, df = df, alt_counts_df = adsl)
result5

lyt6 &lt;- basic_table() %&gt;%
  summarize_patients_exposure_in_cols(var = "AVAL", col_split = TRUE, .stats = "sum_exposure")

result6 &lt;- build_table(lyt6, df = df, alt_counts_df = adsl)
result6

a_count_patients_sum_exposure(
  df = df,
  var = "SEX",
  .N_col = nrow(df),
  .stats = "n_patients"
)

</code></pre>


</div>