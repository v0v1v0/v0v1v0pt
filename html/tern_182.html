<div class="container">

<table style="width: 100%;"><tr>
<td>g_km</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Kaplan-Meier plot</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>From a survival model, a graphic is rendered along with tabulated annotation
including the number of patient at risk at given time and the median survival
per group.
</p>


<h3>Usage</h3>

<pre><code class="language-R">g_km(
  df,
  variables,
  control_surv = control_surv_timepoint(),
  col = NULL,
  lty = NULL,
  lwd = 0.5,
  censor_show = TRUE,
  pch = 3,
  size = 2,
  max_time = NULL,
  xticks = NULL,
  xlab = "Days",
  yval = c("Survival", "Failure"),
  ylab = paste(yval, "Probability"),
  ylim = NULL,
  title = NULL,
  footnotes = NULL,
  font_size = 10,
  ci_ribbon = FALSE,
  annot_at_risk = TRUE,
  annot_at_risk_title = TRUE,
  annot_surv_med = TRUE,
  annot_coxph = FALSE,
  annot_stats = NULL,
  annot_stats_vlines = FALSE,
  control_coxph_pw = control_coxph(),
  ref_group_coxph = NULL,
  control_annot_surv_med = control_surv_med_annot(),
  control_annot_coxph = control_coxph_annot(),
  legend_pos = NULL,
  rel_height_plot = 0.75,
  ggtheme = NULL,
  as_list = FALSE,
  draw = lifecycle::deprecated(),
  newpage = lifecycle::deprecated(),
  gp = lifecycle::deprecated(),
  vp = lifecycle::deprecated(),
  name = lifecycle::deprecated(),
  annot_coxph_ref_lbls = lifecycle::deprecated(),
  position_coxph = lifecycle::deprecated(),
  position_surv_med = lifecycle::deprecated(),
  width_annots = lifecycle::deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>(<code>data.frame</code>)<br> data set containing all analysis variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>(named <code>list</code>)<br> variable names. Details are:
</p>

<ul>
<li> <p><code>tte</code> (<code>numeric</code>)<br> variable indicating time-to-event duration values.
</p>
</li>
<li> <p><code>is_event</code> (<code>logical</code>)<br> event variable. <code>TRUE</code> if event, <code>FALSE</code> if time to event is censored.
</p>
</li>
<li> <p><code>arm</code> (<code>factor</code>)<br> the treatment group variable.
</p>
</li>
<li> <p><code>strata</code> (<code>character</code> or <code>NULL</code>)<br> variable names indicating stratification factors.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control_surv</code></td>
<td>
<p>(<code>list</code>)<br> parameters for comparison details, specified by using
the helper function <code>control_surv_timepoint()</code>. Some possible parameter options are:
</p>

<ul>
<li> <p><code>conf_level</code> (<code>proportion</code>)<br> confidence level of the interval for survival rate.
</p>
</li>
<li> <p><code>conf_type</code> (<code>string</code>)<br><code>"plain"</code> (default), <code>"log"</code>, <code>"log-log"</code> for confidence interval type,
see more in <code>survival::survfit()</code>. Note that the option "none" is no longer supported.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>(<code>character</code>)<br> lines colors. Length of a vector should be equal
to number of strata from <code>survival::survfit()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lty</code></td>
<td>
<p>(<code>numeric</code>)<br> line type. If a vector is given, its length should be equal to the number of strata from
<code>survival::survfit()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>(<code>numeric</code>)<br> line width. If a vector is given, its length should be equal to the number of strata from
<code>survival::survfit()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censor_show</code></td>
<td>
<p>(<code>flag</code>)<br> whether to show censored observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch</code></td>
<td>
<p>(<code>string</code>)<br> name of symbol or character to use as point symbol to indicate censored cases.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>(<code>numeric(1)</code>)<br> size of censored point symbols.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_time</code></td>
<td>
<p>(<code>numeric(1)</code>)<br> maximum value to show on x-axis. Only data values less than or up to
this threshold value will be plotted (defaults to <code>NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xticks</code></td>
<td>
<p>(<code>numeric</code> or <code>NULL</code>)<br> numeric vector of tick positions or a single number with spacing
between ticks on the x-axis. If <code>NULL</code> (default), <code>labeling::extended()</code> is used to determine
optimal tick positions on the x-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>(<code>string</code>)<br> x-axis label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yval</code></td>
<td>
<p>(<code>string</code>)<br> type of plot, to be plotted on the y-axis. Options are <code>Survival</code> (default) and <code>Failure</code>
probability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>(<code>string</code>)<br> y-axis label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>(<code>numeric(2)</code>)<br> vector containing lower and upper limits for the y-axis, respectively.
If <code>NULL</code> (default), the default scale range is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>(<code>string</code>)<br> plot title.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>footnotes</code></td>
<td>
<p>(<code>string</code>)<br> plot footnotes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>font_size</code></td>
<td>
<p>(<code>numeric(1)</code>)<br> font size to use for all text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_ribbon</code></td>
<td>
<p>(<code>flag</code>)<br> whether the confidence interval should be drawn around the Kaplan-Meier curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annot_at_risk</code></td>
<td>
<p>(<code>flag</code>)<br> compute and add the annotation table reporting the number of patient at risk
matching the main grid of the Kaplan-Meier curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annot_at_risk_title</code></td>
<td>
<p>(<code>flag</code>)<br> whether the "Patients at Risk" title should be added above the <code>annot_at_risk</code>
table. Has no effect if <code>annot_at_risk</code> is <code>FALSE</code>. Defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annot_surv_med</code></td>
<td>
<p>(<code>flag</code>)<br> compute and add the annotation table on the Kaplan-Meier curve estimating the
median survival time per group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annot_coxph</code></td>
<td>
<p>(<code>flag</code>)<br> whether to add the annotation table from a <code>survival::coxph()</code> model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annot_stats</code></td>
<td>
<p>(<code>string</code> or <code>NULL</code>)<br> statistics annotations to add to the plot. Options are
<code>median</code> (median survival follow-up time) and <code>min</code> (minimum survival follow-up time).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annot_stats_vlines</code></td>
<td>
<p>(<code>flag</code>)<br> add vertical lines corresponding to each of the statistics
specified by <code>annot_stats</code>. If <code>annot_stats</code> is <code>NULL</code> no lines will be added.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control_coxph_pw</code></td>
<td>
<p>(<code>list</code>)<br> parameters for comparison details, specified using the helper function
<code>control_coxph()</code>. Some possible parameter options are:
</p>

<ul>
<li> <p><code>pval_method</code> (<code>string</code>)<br> p-value method for testing hazard ratio = 1.
Default method is <code>"log-rank"</code>, can also be set to <code>"wald"</code> or <code>"likelihood"</code>.
</p>
</li>
<li> <p><code>ties</code> (<code>string</code>)<br> method for tie handling. Default is <code>"efron"</code>,
can also be set to <code>"breslow"</code> or <code>"exact"</code>. See more in <code>survival::coxph()</code>
</p>
</li>
<li> <p><code>conf_level</code> (<code>proportion</code>)<br> confidence level of the interval for HR.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_group_coxph</code></td>
<td>
<p>(<code>string</code> or <code>NULL</code>)<br> level of arm variable to use as reference group in calculations for
<code>annot_coxph</code> table. If <code>NULL</code> (default), uses the first level of the arm variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control_annot_surv_med</code></td>
<td>
<p>(<code>list</code>)<br> parameters to control the position and size of the annotation table added
to the plot when <code>annot_surv_med = TRUE</code>, specified using the <code>control_surv_med_annot()</code> function. Parameter
options are: <code>x</code>, <code>y</code>, <code>w</code>, <code>h</code>, and <code>fill</code>. See <code>control_surv_med_annot()</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control_annot_coxph</code></td>
<td>
<p>(<code>list</code>)<br> parameters to control the position and size of the annotation table added
to the plot when <code>annot_coxph = TRUE</code>, specified using the <code>control_coxph_annot()</code> function. Parameter
options are: <code>x</code>, <code>y</code>, <code>w</code>, <code>h</code>, <code>fill</code>, and <code>ref_lbls</code>. See <code>control_coxph_annot()</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_pos</code></td>
<td>
<p>(<code>numeric(2)</code> or <code>NULL</code>)<br> vector containing x- and y-coordinates, respectively, for the legend
position relative to the KM plot area. If <code>NULL</code> (default), the legend is positioned in the bottom right corner of
the plot, or the middle right of the plot if needed to prevent overlapping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rel_height_plot</code></td>
<td>
<p>(<code>proportion</code>)<br> proportion of total figure height to allocate to the Kaplan-Meier plot.
Relative height of patients at risk table is then <code>1 - rel_height_plot</code>. If <code>annot_at_risk = FALSE</code> or
<code>as_list = TRUE</code>, this parameter is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ggtheme</code></td>
<td>
<p>(<code>theme</code>)<br> a graphical theme as provided by <code>ggplot2</code> to format the Kaplan-Meier plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as_list</code></td>
<td>
<p>(<code>flag</code>)<br> whether the two <code>ggplot</code> objects should be returned as a list when <code>annot_at_risk = TRUE</code>.
If <code>TRUE</code>, a named list with two elements, <code>plot</code> and <code>table</code>, will be returned. If <code>FALSE</code> (default) the patients
at risk table is printed below the plot via <code>cowplot::plot_grid()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> This function no longer generates <code>grob</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newpage</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> This function no longer generates <code>grob</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gp</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> This function no longer generates <code>grob</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vp</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> This function no longer generates <code>grob</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> This function no longer generates <code>grob</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annot_coxph_ref_lbls</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> Please use the <code>ref_lbls</code> element of
<code>control_annot_coxph</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position_coxph</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a>  Please use the <code>x</code> and <code>y</code> elements of
<code>control_annot_coxph</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position_surv_med</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> Please use the <code>x</code> and <code>y</code> elements of
<code>control_annot_surv_med</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width_annots</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> Please use the <code>w</code> element of <code>control_annot_surv_med</code>
(for <code>surv_med</code>) and <code>control_annot_coxph</code> (for <code>coxph</code>)."</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>ggplot</code> Kaplan-Meier plot and (optionally) summary table.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(dplyr)
library(nestcolor)

df &lt;- tern_ex_adtte %&gt;%
  filter(PARAMCD == "OS") %&gt;%
  mutate(is_event = CNSR == 0)
variables &lt;- list(tte = "AVAL", is_event = "is_event", arm = "ARMCD")

# Basic examples
g_km(df = df, variables = variables)
g_km(df = df, variables = variables, yval = "Failure")

# Examples with customization parameters applied
g_km(
  df = df,
  variables = variables,
  control_surv = control_surv_timepoint(conf_level = 0.9),
  col = c("grey25", "grey50", "grey75"),
  annot_at_risk_title = FALSE,
  lty = 1:3,
  font_size = 8
)
g_km(
  df = df,
  variables = variables,
  annot_stats = c("min", "median"),
  annot_stats_vlines = TRUE,
  max_time = 3000,
  ggtheme = ggplot2::theme_minimal()
)

# Example with pairwise Cox-PH analysis annotation table, adjusted annotation tables
g_km(
  df = df, variables = variables,
  annot_coxph = TRUE,
  control_coxph = control_coxph(pval_method = "wald", ties = "exact", conf_level = 0.99),
  control_annot_coxph = control_coxph_annot(x = 0.26, w = 0.35),
  control_annot_surv_med = control_surv_med_annot(x = 0.8, y = 0.9, w = 0.35)
)

</code></pre>


</div>