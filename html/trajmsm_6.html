<div class="container">

<table style="width: 100%;"><tr>
<td>pltmle</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Counterfactual means for a Pooled LTMLE</h2>

<h3>Description</h3>

<p>Function to estimate counterfactual means for a pooled LTMLE.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pltmle(
  formula,
  outcome,
  treatment,
  covariates,
  baseline,
  ntimes_interval,
  number_traj,
  time,
  time_values,
  identifier,
  obsdata,
  traj,
  total_followup,
  treshold = treshold,
  class_var,
  class_pred
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Specification of the model for the outcome to be fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>Name of the outcome variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treatment</code></td>
<td>
<p>Time-varying treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>Covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baseline</code></td>
<td>
<p>Name of baseline covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntimes_interval</code></td>
<td>
<p>Length of a time-interval (s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_traj</code></td>
<td>
<p>An integer to choose the number of trajectory groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>Name of the time variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_values</code></td>
<td>
<p>Measuring times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>identifier</code></td>
<td>
<p>Name of the column of the unique identifier.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsdata</code></td>
<td>
<p>Observed data in wide format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traj</code></td>
<td>
<p>Matrix of indicators for the trajectory groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>total_followup</code></td>
<td>
<p>Number of measuring times per interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treshold</code></td>
<td>
<p>For weight truncation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>class_var</code></td>
<td>
<p>Name of the trajectory group variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>class_pred</code></td>
<td>
<p>Vector of predicted trajectory groups.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>list_pltmle_countermeans</code></td>
<td>
<p> Counterfactual means and influence functions with the pooled ltmle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>Influence functions</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Awa Diop, Denis Talbot
</p>


<h3>Examples</h3>

<pre><code class="language-R">
obsdata_long = gendata(n = 2000, format = "long",total_followup = 3, seed = 945)
baseline_var &lt;- c("age","sex")
covariates &lt;- list(c("hyper2011", "bmi2011"),
c("hyper2012", "bmi2012"),c("hyper2013", "bmi2013"))
treatment_var &lt;- c("statins2011","statins2012","statins2013")
time_values &lt;- c(2011,2012,2013)
formulaA = as.formula(cbind(statins, 1 - statins) ~ time)
restraj = build_traj(obsdata = obsdata_long, number_traj = 3,
formula = formulaA, identifier = "id")
datapost = restraj$data_post
trajmsm_long &lt;- merge(obsdata_long, datapost, by = "id")
    AggFormula &lt;- as.formula(paste("statins", "~", "time", "+", "class"))
    AggTrajData &lt;- aggregate(AggFormula, data = trajmsm_long, FUN = mean)
    AggTrajData
trajmsm_long[ , "traj_group"] &lt;- trajmsm_long[ , "class"]
obsdata= reshape(trajmsm_long, direction = "wide", idvar = "id",
v.names = c("statins","bmi","hyper"), timevar = "time", sep ="")
formula =  as.formula(" y ~ statins2011 + statins2012 + statins2013 +
hyper2011 + bmi2011 + hyper2012 + bmi2012 +
 hyper2013 + bmi2013 + age + sex ")
class = factor(predict_traj(identifier = "id", total_followup = 3,
        treatment = "statins", time = "time", time_values = time_values,
        trajmodel = restraj$traj_model)$post_class);
traj=t(sapply(1:8,function(x)sapply(1:3,function(i)ifelse(class[x]==i,1,0))))
traj[,1]=1
res_pltmle = pltmle(formula = formula, outcome = "y",treatment = treatment_var,
covariates = covariates, baseline = baseline_var, ntimes_interval = 3, number_traj = 3,
 time =  "time",time_values = time_values,identifier = "id",obsdata = obsdata,
traj=traj, treshold = 0.99, class_pred= class, class_var = "class")
res_pltmle$counter_means

</code></pre>


</div>