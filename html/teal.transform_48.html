<div class="container">

<table style="width: 100%;"><tr>
<td>data_extract_srv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extraction of the selector(s) details</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>Extracting details of the selection(s) in data_extract_ui elements.
</p>


<h3>Usage</h3>

<pre><code class="language-R">data_extract_srv(id, datasets, data_extract_spec, ...)

## S3 method for class 'FilteredData'
data_extract_srv(id, datasets, data_extract_spec, ...)

## S3 method for class 'list'
data_extract_srv(
  id,
  datasets,
  data_extract_spec,
  join_keys = NULL,
  select_validation_rule = NULL,
  filter_validation_rule = NULL,
  dataset_validation_rule = if (is.null(select_validation_rule) &amp;&amp;
    is.null(filter_validation_rule)) {
     NULL
 } else {
    
    shinyvalidate::sv_required("Please select a dataset")
 },
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>An ID string that corresponds with the ID used to call the module's
UI function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datasets</code></td>
<td>
<p>(<code>FilteredData</code> or <code>list</code> of <code>reactive</code> or non-<code>reactive</code> <code>data.frame</code>)
object containing data either in the form of <code>FilteredData</code> or as a list of <code>data.frame</code>.
When passing a list of non-reactive <code>data.frame</code> objects, they are converted to reactive <code>data.frame</code>s internally.
When passing a list of reactive or non-reactive <code>data.frame</code> objects, the argument <code>join_keys</code> is required also.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_extract_spec</code></td>
<td>
<p>(<code>data_extract_spec</code> or a list of <code>data_extract_spec</code>)
A list of data filter and select information constructed by data_extract_spec.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>An additional argument <code>join_keys</code> is required when <code>datasets</code> is a list of <code>data.frame</code>.
It shall contain the keys per dataset in <code>datasets</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>join_keys</code></td>
<td>
<p>(<code>join_keys</code> or <code>NULL</code>) of keys per dataset in <code>datasets</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select_validation_rule</code></td>
<td>
<p>(<code>NULL</code> or <code>function</code>)
Should there be any <code>shinyvalidate</code> input validation of the select parts of the <code>data_extract_ui</code>.
</p>
<p>You can use a validation function directly (i.e. <code>select_validation_rule = shinyvalidate::sv_required()</code>)
or for more fine-grained control use a function:
</p>
<p><code>select_validation_rule = ~ if (length(.) &gt; 2) "Error"</code>.
</p>
<p>If <code>NULL</code> then no validation will be added. See example for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_validation_rule</code></td>
<td>
<p>(<code>NULL</code> or <code>function</code>) Same as
<code>select_validation_rule</code> but for the filter (values) part of the <code>data_extract_ui</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset_validation_rule</code></td>
<td>
<p>(<code>NULL</code> or <code>function</code>) Same as
<code>select_validation_rule</code> but for the choose dataset part of the <code>data_extract_ui</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A reactive <code>list</code> containing following fields:
</p>

<ul>
<li> <p><code>filters</code>: A list with the information on the filters that are applied to the data set.
</p>
</li>
<li> <p><code>select</code>: The variables that are selected from the dataset.
</p>
</li>
<li> <p><code>always_selected</code>: The column names from the data set that should always be selected.
</p>
</li>
<li> <p><code>reshape</code>: Whether reshape long to wide should be applied or not.
</p>
</li>
<li> <p><code>dataname</code>: The name of the data set.
</p>
</li>
<li> <p><code>internal_id</code>: The <code>id</code> of the corresponding shiny input element.
</p>
</li>
<li> <p><code>keys</code>: The names of the columns that can be used to merge the data set.
</p>
</li>
<li> <p><code>iv</code>: A <code>shinyvalidate::InputValidator</code> containing <code>validator</code> for this <code>data_extract</code>.
</p>
</li>
</ul>
<h3>References</h3>

<p>data_extract_srv
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(shiny)
library(shinyvalidate)
library(teal.data)
library(teal.widgets)

# Sample ADSL dataset
ADSL &lt;- data.frame(
  STUDYID = "A",
  USUBJID = LETTERS[1:10],
  SEX = rep(c("F", "M"), 5),
  AGE = rpois(10, 30),
  BMRKR1 = rlnorm(10)
)

# Specification for data extraction
adsl_extract &lt;- data_extract_spec(
  dataname = "ADSL",
  filter = filter_spec(vars = "SEX", choices = c("F", "M"), selected = "F"),
  select = select_spec(
    label = "Select variable:",
    choices = variable_choices(ADSL, c("AGE", "BMRKR1")),
    selected = "AGE",
    multiple = TRUE,
    fixed = FALSE
  )
)

# Using reactive list of data.frames
data_list &lt;- list(ADSL = reactive(ADSL))

join_keys &lt;- join_keys(join_key("ADSL", "ADSL", c("STUDYID", "USUBJID")))

# App: data extraction with validation
ui &lt;- fluidPage(
  standard_layout(
    output = verbatimTextOutput("out1"),
    encoding = tagList(
      data_extract_ui(
        id = "adsl_var",
        label = "ADSL selection",
        data_extract_spec = adsl_extract
      )
    )
  )
)
server &lt;- function(input, output, session) {
  adsl_reactive_input &lt;- data_extract_srv(
    id = "adsl_var",
    datasets = data_list,
    data_extract_spec = adsl_extract,
    join_keys = join_keys,
    select_validation_rule = sv_required("Please select a variable.")
  )

  iv_r &lt;- reactive({
    iv &lt;- InputValidator$new()
    iv$add_validator(adsl_reactive_input()$iv)
    iv$enable()
    iv
  })

  output$out1 &lt;- renderPrint({
    if (iv_r()$is_valid()) {
      cat(format_data_extract(adsl_reactive_input()))
    } else {
      "Please fix errors in your selection"
    }
  })
}

if (interactive()) {
  shinyApp(ui, server)
}

# App: simplified data extraction
ui &lt;- fluidPage(
  standard_layout(
    output = verbatimTextOutput("out1"),
    encoding = tagList(
      data_extract_ui(
        id = "adsl_var",
        label = "ADSL selection",
        data_extract_spec = adsl_extract
      )
    )
  )
)

server &lt;- function(input, output, session) {
  adsl_reactive_input &lt;- data_extract_srv(
    id = "adsl_var",
    datasets = data_list,
    data_extract_spec = adsl_extract
  )

  output$out1 &lt;- renderPrint(adsl_reactive_input())
}

if (interactive()) {
  shinyApp(ui, server)
}

</code></pre>


</div>