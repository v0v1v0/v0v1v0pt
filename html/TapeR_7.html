<div class="container">

<table style="width: 100%;"><tr>
<td>E_DHx_HmDm_HT.f</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate diameter and approximate confidence and prediction intervals</h2>

<h3>Description</h3>

<p>Calibrates a taper curve based on at least one diameter 
measurement and returns the expected diameters and approximate variances
</p>


<h3>Usage</h3>

<pre><code class="language-R">E_DHx_HmDm_HT.f(
  Hx,
  Hm,
  Dm,
  mHt,
  sHt = 0,
  par.lme,
  Rfn = list(fn = "sig2"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Hx</code></td>
<td>
<p>Numeric vector of stem heights (m) along which to return the 
expected diameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Hm</code></td>
<td>
<p>Numeric vector of stem heights (m) along which diameter 
measurements were taken for calibration. Can be of length 1. Must be of same 
length as <code>Dm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dm</code></td>
<td>
<p>Numeric vector of diameter measurements (cm) taken for calibration.
Can be of length 1. Must be of same length as <code>Hm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mHt</code></td>
<td>
<p>Scalar. Tree height (m).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sHt</code></td>
<td>
<p>Scalar. Standard deviation of stem height. Can be 0 if height was 
measured without error.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.lme</code></td>
<td>
<p>List of taper model parameters obtained by 
<code>TapeR_FIT_LME.f</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rfn</code></td>
<td>
<p>list with function name to provide estimated or assumed residual 
variances for the given measurements, optionally parameters for such functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>not currently used</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>calibrates the tree specific taper curve and calculates approximate
confidence intervals, which can be useful for plotting. Uncertainty resulting
from tariff height estimates if tree height was not measured is incorporated.
Using <code>Rfn</code> the taper curve can be forced through the measured 
diameters, c.f. <code>resVar</code>.
</p>


<h3>Value</h3>

<p>a list holding nine elements:
</p>

<ul>
<li>
<p>DHx: Numeric vector of diameters (cm) (expected value) along the 
heights given by <code>Hx</code>.
</p>
</li>
<li>
<p>Hx: Numeric vector of heights (m) along which to return the expected
diameter.
</p>
</li>
<li>
<p>MSE_Mean: Mean squared error for the expected value of the diameter.
</p>
</li>
<li>
<p>CI_Mean: Confidence interval. Matrix of the 95% conf. int. for the 
expected value of the diameter (cm). First column: lower limit, second 
column: mean, third column: upper limit.
</p>
</li>
<li>
<p>KOV_Mean: Variance-Covariance matrix for the expected value of the 
diameter.
</p>
</li>
<li>
<p>MSE_Pred: Mean squared error for the prediction of the diameter.
</p>
</li>
<li>
<p>CI_Pred: Prediction interval. Matrix of the 95% conf. int. for the 
prediction of the diameter (cm). First column: lower limit, second column: 
mean, third column: upper limit.
</p>
</li>
<li>
<p>KOV_Pred: Variance-Covariance matrix for the prediction of the 
diameter.
</p>
</li>
<li>
<p>Rfn: Function applied for estimated or assumed residual variance.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Edgar Kublin and Christian Vonderach
</p>


<h3>References</h3>

<p>Kublin, E., Breidenbach, J., Kaendler, G. (2013) A flexible stem 
taper and volume prediction method based on mixed-effects B-spline 
regression, Eur J For Res, 132:983-997.
</p>


<h3>See Also</h3>

<p><code>TapeR_FIT_LME.f</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># example data
data(DxHx.df)
# taper curve parameters based on all measured trees
data(SK.par.lme)

#select data of first tree
Idi &lt;- (DxHx.df[,"Id"] == unique(DxHx.df$Id)[1])
(tree1 &lt;- DxHx.df[Idi,])

## Predict the taper curve based on the diameter measurement in 2 m
## height and known height 
tc.tree1 &lt;- E_DHx_HmDm_HT.f(Hx=1:tree1$Ht[1], 
                            Hm=tree1$Hx[3],
                            Dm=tree1$Dx[3], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme)
#plot the predicted taper curve
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1)
#lower CI
lines(tc.tree1$Hx, tc.tree1$CI_Mean[,1], lty=2)
#upper CI
lines(tc.tree1$Hx, tc.tree1$CI_Mean[,3], lty=2)
#lower prediction interval
lines(tc.tree1$Hx, tc.tree1$CI_Pred[,1], lty=3)
#upper prediction interval
lines(tc.tree1$Hx, tc.tree1$CI_Pred[,3], lty=3)
#add measured diameter used for calibration
points(tree1$Hx[3], tree1$Dx[3], pch=3, col=2)
#add the observations
points(tree1$Hx, tree1$Dx)

## feature of forcing taper curve through measured diameters
i &lt;- c(3, 6)
tc.tree1 &lt;- E_DHx_HmDm_HT.f(Hx=seq(0, tree1$Ht[1], 0.1), 
                            Hm=tree1$Hx[i],
                            Dm=tree1$Dx[i], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme,
                            Rfn=list(fn="sig2"))
tc.tree2 &lt;- E_DHx_HmDm_HT.f(Hx=seq(0, tree1$Ht[1], 0.1), 
                            Hm=tree1$Hx[i],
                            Dm=tree1$Dx[i], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme,
                            Rfn=list(fn="zero"))
# plot the predicted taper curve
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1)
# added taper curve through measurement
points(x=tc.tree2$Hx, y=tc.tree2$DHx, type="l", lty=2)
# closer window
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1, xlim=c(0, 8), ylim=c(24, 30))
# added taper curve through measurement
points(x=tc.tree2$Hx, y=tc.tree2$DHx, type="l", lty=2)
# add measured diameter used for calibration
points(tree1$Hx[i], tree1$Dx[i], pch=3, col=2)
# add the observations
points(tree1$Hx, tree1$Dx)

## apply yet another residual variance function
i &lt;- c(1, 2, 3) # calibrating with 0.5, 1m and 2m, assuming no error in 0.5m
zrv &lt;- tree1$Hx[1] / tree1$Ht[1] # assumed zero resiudal variance
# assumed residual variance per measurement
TapeR:::resVar(relH = tree1$Hx[i] / tree1$Ht[1], fn = "dlnorm", 
               sig2 = SK.par.lme$sig2_eps, par = list(zrv=zrv))
tc.tree3 &lt;- E_DHx_HmDm_HT.f(Hx=seq(0, tree1$Ht[1], 0.1), 
                            Hm=tree1$Hx[i],
                            Dm=tree1$Dx[i], 
                            mHt = tree1$Ht[1], 
                            sHt = 0, 
                            par.lme = SK.par.lme,
                            Rfn=list(fn="dlnorm", par=list(zrv=zrv)))
plot(tc.tree1$Hx, tc.tree1$DHx, type="l", las=1, xlim=c(0, 4))
points(x=tc.tree3$Hx, y=tc.tree3$DHx, type="l", lty=2)
points(tree1$Hx[i], tree1$Dx[i], pch=3, col=2)
points(tree1$Hx, tree1$Dx)
</code></pre>


</div>