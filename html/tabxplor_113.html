<div class="container">

<table style="width: 100%;"><tr>
<td>tab</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Single cross-table, with color helpers</h2>

<h3>Description</h3>

<p>A full-featured function to create, manipulate and format single
cross-tables, using colors to make the printed tab more easily readable
(in R terminal or exported to Excel with <code>tab_xl</code>).
Since objects of class <code>tab</code> are also of class <code>tibble</code>, you can then use all
<span class="pkg">dplyr</span> verbs to modify the result, like <code>select</code>,
like <code>arrange</code>, <code>filter</code>
or <code>mutate</code>.
Wrapper around the more powerful <code>tab_many</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tab(
  data,
  row_var,
  col_var,
  tab_vars,
  wt,
  sup_cols,
  pct = "no",
  color = "no",
  OR = "no",
  chi2 = FALSE,
  na = "keep",
  cleannames = NULL,
  other_if_less_than = 0,
  other_level = "Others",
  ref = "auto",
  ref2 = "first",
  comp = "tab",
  ci = "no",
  conf_level = 0.95,
  totaltab = "line",
  totaltab_name = "Ensemble",
  tot = c("row", "col"),
  total_names = "Total",
  add_n = TRUE,
  add_pct = FALSE,
  subtext = "",
  digits = 0,
  filter
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row_var, col_var</code></td>
<td>
<p>The row variable, which will be printed with one level per line,
and the column variable, which will be printed with one level per column.
For numeric variables means are calculated, in a single column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tab_vars</code></td>
<td>
<p>&lt;tidy-select&gt; Tab variables :
a subtable is made for each combination of levels of the selected variables.
Leave empty to make a simple cross-table. All <code>tab_vars</code> are converted to factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wt</code></td>
<td>
<p>A weight variable, of class numeric. Leave empty for unweighted results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sup_cols</code></td>
<td>
<p>&lt;tidy-select&gt;
Supplementary columns variables, with only the first level printed, and row percentages
(for numeric variables, a mean will be calculated for each <code>row_var</code>).
To pass many variables you may use syntax <code>sup_cols = c(sup_col1, sup_col2, ...)</code>.
To keep all levels of other <code>col_vars</code>, or other types of percentages,
use <code>tab_many</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pct</code></td>
<td>
<p>The type of percentages to calculate :
</p>

<ul>
<li> <p><code>"row"</code>: row percentages.
</p>
</li>
<li> <p><code>"col"</code>: column percentages.
</p>
</li>
<li> <p><code>"all"</code>: frequencies for each subtable/group, if there is <code>tab_vars</code>.
</p>
</li>
<li> <p><code>"all_tabs"</code>: frequencies for the whole (set of) table(s).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color</code></td>
<td>
<p>The type of colors to print, as a single string :
</p>

<ul>
<li> <p><code>"no"</code>: by default, no colors are printed.
</p>
</li>
<li> <p><code>"diff"</code>: color percentages and means based on cells differences from
totals (or from first cells when <code>ref = "first"</code>).
</p>
</li>
<li> <p><code>"diff_ci"</code>: color pct and means based on cells differences from totals
or first cells, removing coloring when the confidence interval of this difference
is higher than the difference itself.
</p>
</li>
<li> <p><code>"after_ci"</code>: idem, but cut off the confidence interval from the
difference first.
</p>
</li>
<li> <p><code>"contrib"</code>: color cells based on their contribution to variance
(except mean columns, from numeric variables).
</p>
</li>
<li> <p><code>"OR"</code>: for <code>pct == "col"</code> or <code>pct == "row"</code>,
color based on odds ratios (or relative risks ratios)
</p>
</li>
<li> <p><code>"auto"</code>: frequencies (<code>pct = "all"</code>, <code>pct = "all_tabs"</code>)
and counts are colored with <code>"contrib"</code>.
When <code>ci = "diff"</code>, row and col percentages are colored with "after_ci" ;
otherwise they are colored with "diff".
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OR</code></td>
<td>
<p>With <code>pct = "row"</code> or <code>pct = "col"</code>, calculate and print odds ratios
(for binary variables) or relative risks ratios (for variables with 3 levels
or more).
</p>

<ul>
<li> <p><code>"no"</code>: by default, no OR are calculated.
</p>
</li>
<li> <p><code>"OR"</code>: print OR (instead of percentages).
</p>
</li>
<li> <p><code>"OR_pct"</code>: print OR, with percentages in bracket.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chi2</code></td>
<td>
<p>Set to <code>TRUE</code> to calculate Chi2 summaries with <code>tab_chi2</code>.
Useful to print metadata, and to color cells based on their contribution to variance
(<code>color = "contrib"</code>). Automatically added if needed for <code>color</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na</code></td>
<td>
<p>The policy to adopt for missing values, as a single string :
</p>

<ul>
<li> <p><code>"keep"</code>: by default, <code>NA</code>'s of row, col and tab variables
are printed as an explicit <code>"NA"</code> level.
</p>
</li>
<li> <p><code>"drop"</code>: remove <code>NA</code>'s in row, col and tab variables before calculations
are done. Supplementary columns are then calculated for observations with no <code>NA</code> in
any of the row, col and tab variables.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cleannames</code></td>
<td>
<p>Set to <code>TRUE</code> to clean levels names, by removing
prefix numbers like "1-", and text in parenthesis. All data formatting arguments are
passed to <code>tab_prepare</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>other_if_less_than</code></td>
<td>
<p>When set to a positive integer, levels with less count
than it will be merged into an "Others" level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>other_level</code></td>
<td>
<p>The name of the "Other" level, as a single string.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref</code></td>
<td>
<p>The reference cell to calculate differences and ratios
(used to print <code>colors</code>) :
</p>

<ul>
<li> <p><code>"auto"</code>: by default, cell difference from the corresponding total
(rows or cols depending on <code>pct = "row"</code> or <code>pct = "col"</code>) is
used for <code>diff</code> ; cell ratio from the first line (or col) is use for <code>OR</code>
(odds ratio/relative risks ratio).
</p>
</li>
<li> <p><code>"tot"</code>: totals are always used.
</p>
</li>
<li> <p><code>"first"</code>: calculate cell difference or ratio from the first cell
of the row or column (useful to color temporal developments).
</p>
</li>
<li> <p><code>n</code>: when <code>ref</code> is an integer, the nth row (or column) is used for comparison.
</p>
</li>
<li> <p><code>"regex"</code>: when <code>ref</code> is a string, it it used as a regular expression,
to match with the names of the rows (or columns). Be precise enough to match only one
column or row, otherwise you get a warning message.
</p>
</li>
<li> <p><code>"no"</code>: not use ref and not calculate diffs to gain calculation time.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref2</code></td>
<td>
<p>A second reference cell is needed to calculate odds ratios
(or relative risks ratios). The first cell of the row or column is used by default.
See <code>ref</code> above for the full list of possible values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp</code></td>
<td>
<p>The comparison level : by subtables/groups, or for the whole table.
</p>

<ul>
<li> <p><code>"tab"</code>: by default, contributions to variance,
row differences from totals/first cells, and row confidence intervals for these
differences, are calculated for each <code>tab_vars</code> group.
</p>
</li>
<li> <p><code>"all"</code>: compare cells to the general total line (provided there is
a total table with a total row), or with the first line of the total table
when <code>ref = "first"</code>.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>The type of confidence intervals to calculate, passed to <code>tab_ci</code>
(automatically added if needed for <code>color</code>).
</p>

<ul>
<li> <p><code>"cell"</code>: absolute confidence intervals of cells percentages.
</p>
</li>
<li> <p><code>"diff"</code>: confidence intervals of the difference between a cell and the
relative total cell (or relative first cell when <code>ref = "first"</code>).
</p>
</li>
<li> <p><code>"auto"</code>: <code>ci = "diff"</code> for means and row/col percentages,
<code>ci = "cell"</code> for frequencies ("all", "all_tabs").
</p>
</li>
</ul>
<p>By default, for percentages, with Wilson's method is used,
and with <code>ci = "diff"</code> Wald's method along Agresti and Caffo's adjustment.
Means use classic method. This can be changed in <code>tab_many</code>. By
default, with <code>ci = "cell"</code>, the result is printed in the <code style="white-space: pre;">⁠[inf;sup]⁠</code> form.
Set <code>options("tabxplor.ci_print" = "moe")</code> to print <code>pct +- moe</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf_level</code></td>
<td>
<p>The confidence level, as a single numeric between 0 and 1.
Default to 0.95 (95%).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>totaltab</code></td>
<td>
<p>The total table, if there are subtables/groups
(i.e. when <code>tab_vars</code> is provided) :
</p>

<ul>
<li> <p><code>"line"</code>: by default, add a general total line (necessary for
calculations with <code>comp = "all"</code>)
</p>
</li>
<li> <p><code>"table"</code>: add a complete total table
(i.e. <code>row_var</code> by <code>col_vars</code> without <code>tab_vars</code>).
</p>
</li>
<li> <p><code>"no"</code>: not to draw any total table.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>totaltab_name</code></td>
<td>
<p>The name of the total table, as a single string.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tot</code></td>
<td>
<p>The totals :
</p>

<ul>
<li> <p><code>c("col", "row")</code> or <code>"both"</code> : by default, both total rows and total
columns.
</p>
</li>
<li> <p><code>"row"</code>: only total rows.
</p>
</li>
<li> <p><code>"col"</code>: only total column.
</p>
</li>
<li> <p><code>"no"</code>: remove all totals (after calculations if needed).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>total_names</code></td>
<td>
<p>The names of the totals, as a character vector of length one or two.
Use syntax of type <code>c("Total row", "Total column")</code> to set different names for
rows and cols.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_n</code></td>
<td>
<p>For <code>pct = "row"</code> or <code>pct = "col"</code>, set to <code>FALSE</code> not to add another
column or row with unweighted counts (<code>n</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_pct</code></td>
<td>
<p>Set to <code>TRUE</code> to add a column with the frequencies of the row
variable (for <code>pct = "row"</code>) or a row with the frequencies of the column variable
(for  <code>pct = "col"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subtext</code></td>
<td>
<p>A character vector to print rows of legend under the table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>The number of digits to print, as a single integer. To print a different
number of digits for each <code>sup_cols</code>, an integer vector of length
1 + <code>sup_cols</code> (the first being the number of digits for the base table).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter</code></td>
<td>
<p>A <code>dplyr::filter</code> to apply to the data frame
first, as a single string (which will be converted to code, i.e. to a call).
Useful when printing multiples tabs with <code>tibble::tribble</code>,
to use different filters for similar tables or simply make the field of observation
more visible into the code.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>tibble</code> of class <code>tab</code>, possibly with colored reading helpers.
All non-text columns are of class <code>fmt</code>, storing all
the data necessary to print formats and colors. Columns with <code>row_var</code> and
<code>tab_vars</code> are of class <code>factor</code> : every added <code>factor</code> will be
considered as a <code>tab_vars</code> and used for grouping. To add text columns without
using them in calculations, be sure they are of class <code>character</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># A simple cross-table:
tab(forcats::gss_cat, marital, race)


# With more variables provided, `tab` makes a subtables for each combination of levels:

tab(forcats::gss_cat, marital, tab_vars = c(year, race))


# You can also add supplementary columns, text or numeric:

tab(dplyr::storms, category, status, sup_cols = c("pressure", "wind"))


# Colors to help the user read the table:
data &lt;- forcats::gss_cat %&gt;%
  dplyr::filter(year %in% c(2000, 2006, 2012), !marital %in% c("No answer", "Widowed"))
gss  &lt;- "Source: General social survey 2000-2014"
gss2 &lt;- "Source: General social survey 2000, 2006 and 2012"

# Differences between the cell and it's subtable's total cell:

tab(data, race, marital, year, subtext = gss2, pct = "row", color = "diff")


# Differences between the cell and the whole table's general total cell:

tab(data, race, marital, year, subtext = gss2, pct = "row", color = "diff",
  comp = "all")


# Historical differences:

data2 &lt;- data %&gt;% dplyr::mutate(year = as.factor(year))
tab(data2, year, marital, race, subtext = gss2, pct = "row",
    color = "diff", ref = "first", tot = "col")


# Differences with the total, except if their confidences intervals are superior to them:
tab(forcats::gss_cat, race, marital, subtext = gss, pct = "row", color = "diff_ci")

# Same differences, minus their confidence intervals:
tab(forcats::gss_cat, race, marital, subtext = gss, pct = "row", color = "after_ci")

# Contribution of cells to table's variance, like in a correspondence analysis:
tab(forcats::gss_cat, race, marital, subtext = gss, color = "contrib")


# Since the result is a tibble, you can use all dplyr verbs to modify it :

library(dplyr)
tab(dplyr::storms, category, status, sup_cols = c("pressure", "wind")) %&gt;%
  dplyr::filter(category != "-1") %&gt;%
  dplyr::select(-`tropical depression`) %&gt;%
  dplyr::arrange(is_totrow(.), desc(category))



# With `dplyr::arrange`, don't forget to keep the order of tab variables and total rows:
tab(data, race, marital, year, pct = "row") %&gt;%
  dplyr::arrange(year, is_totrow(.), desc(Married))
  
</code></pre>


</div>