<div class="container">

<table style="width: 100%;"><tr>
<td>DatetimeFilterState</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
<code>FilterState</code> object for date time data</h2>

<h3>Description</h3>

<p>Manages choosing a range of date-times.
</p>


<h3>Super class</h3>

<p><code>teal.slice::FilterState</code> -&gt; <code>DatetimeFilterState</code>
</p>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-DatetimeFilterState-new"><code>DatetimeFilterState$new()</code></a>
</p>
</li>
<li> <p><a href="#method-DatetimeFilterState-get_call"><code>DatetimeFilterState$get_call()</code></a>
</p>
</li>
<li> <p><a href="#method-DatetimeFilterState-clone"><code>DatetimeFilterState$clone()</code></a>
</p>
</li>
</ul>
<details><summary>Inherited methods</summary><ul>
<li><span class="pkg-link" data-pkg="teal.slice" data-topic="FilterState" data-id="destroy_observers"><a href="../../teal.slice/html/FilterState.html#method-FilterState-destroy_observers"><code>teal.slice::FilterState$destroy_observers()</code></a></span></li>
<li><span class="pkg-link" data-pkg="teal.slice" data-topic="FilterState" data-id="format"><a href="../../teal.slice/html/FilterState.html#method-FilterState-format"><code>teal.slice::FilterState$format()</code></a></span></li>
<li><span class="pkg-link" data-pkg="teal.slice" data-topic="FilterState" data-id="get_state"><a href="../../teal.slice/html/FilterState.html#method-FilterState-get_state"><code>teal.slice::FilterState$get_state()</code></a></span></li>
<li><span class="pkg-link" data-pkg="teal.slice" data-topic="FilterState" data-id="print"><a href="../../teal.slice/html/FilterState.html#method-FilterState-print"><code>teal.slice::FilterState$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="teal.slice" data-topic="FilterState" data-id="server"><a href="../../teal.slice/html/FilterState.html#method-FilterState-server"><code>teal.slice::FilterState$server()</code></a></span></li>
<li><span class="pkg-link" data-pkg="teal.slice" data-topic="FilterState" data-id="set_state"><a href="../../teal.slice/html/FilterState.html#method-FilterState-set_state"><code>teal.slice::FilterState$set_state()</code></a></span></li>
<li><span class="pkg-link" data-pkg="teal.slice" data-topic="FilterState" data-id="ui"><a href="../../teal.slice/html/FilterState.html#method-FilterState-ui"><code>teal.slice::FilterState$ui()</code></a></span></li>
</ul></details><hr>
<a id="method-DatetimeFilterState-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Initialize a <code>FilterState</code> object. This class
has an extra field, <code>private$timezone</code>, which is set to <code>Sys.timezone()</code> by
default. However, in case when using this module in <code>teal</code> app, one needs
timezone of the app user. App user timezone is taken from <code>session$userData$timezone</code>
and is set only if object is initialized in <code>shiny</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>DatetimeFilterState$new(
  x,
  x_reactive = reactive(NULL),
  extract_type = character(0),
  slice
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt>
<dd>
<p>(<code>POSIXct</code> or <code>POSIXlt</code>)
variable to be filtered.</p>
</dd>
<dt><code>x_reactive</code></dt>
<dd>
<p>(<code>reactive</code>)
returning vector of the same type as <code>x</code>. Is used to update
counts following the change in values of the filtered dataset.
If it is set to <code>reactive(NULL)</code> then counts based on filtered
dataset are not shown.</p>
</dd>
<dt><code>extract_type</code></dt>
<dd>
<p>(<code>character</code>)
specifying whether condition calls should be prefixed by <code>dataname</code>. Possible values:
</p>

<ul>
<li> <p><code>character(0)</code> (default) <code>varname</code> in the condition call will not be prefixed
</p>
</li>
<li> <p><code>"list"</code> <code>varname</code> in the condition call will be returned as <code style="white-space: pre;">⁠&lt;dataname&gt;$&lt;varname&gt;⁠</code>
</p>
</li>
<li> <p><code>"matrix"</code> <code>varname</code> in the condition call will be returned as <code style="white-space: pre;">⁠&lt;dataname&gt;[, &lt;varname&gt;]⁠</code>
</p>
</li>
</ul>
</dd>
<dt><code>slice</code></dt>
<dd>
<p>(<code>teal_slice</code>)
specification of this filter state.
<code>teal_slice</code> is stored in the object and <code>set_state</code> directly manipulates values within <code>teal_slice</code>.
<code>get_state</code> returns <code>teal_slice</code> object which can be reused in other places.
Note that <code>teal_slice</code> is a <code>reactiveValues</code>, which means it has reference semantics, i.e.
changes made to an object are automatically reflected in all places that refer to the same <code>teal_slice</code>.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>Object of class <code>DatetimeFilterState</code>, invisibly.
</p>


<hr>
<a id="method-DatetimeFilterState-get_call"></a>



<h4>Method <code>get_call()</code>
</h4>

<p>Returns reproducible condition call for current selection.
For this class returned call looks like
<code style="white-space: pre;">⁠&lt;varname&gt; &gt;= as.POSIXct(&lt;min&gt;) &amp; &lt;varname&gt; &lt;= &lt;max&gt;)⁠</code> with optional <code style="white-space: pre;">⁠is.na(&lt;varname&gt;)⁠</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>DatetimeFilterState$get_call(dataname)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>dataname</code></dt>
<dd>
<p>name of data set; defaults to <code>private$get_dataname()</code></p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p><code>call</code>
</p>


<hr>
<a id="method-DatetimeFilterState-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>DatetimeFilterState$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>Examples</h3>

<pre><code class="language-R"># use non-exported function from teal.slice
include_css_files &lt;- getFromNamespace("include_css_files", "teal.slice")
include_js_files &lt;- getFromNamespace("include_js_files", "teal.slice")
DatetimeFilterState &lt;- getFromNamespace("DatetimeFilterState", "teal.slice")

library(shiny)

filter_state &lt;- DatetimeFilterState$new(
  x = c(Sys.time() + seq(0, by = 3600, length.out = 10), NA),
  slice = teal_slice(varname = "x", dataname = "data"),
  extract_type = character(0)
)
isolate(filter_state$get_call())
filter_state$set_state(
  teal_slice(
    dataname = "data",
    varname = "x",
    selected = c(Sys.time() + 3L, Sys.time() + 8L),
    keep_na = TRUE
  )
)
isolate(filter_state$get_call())

# working filter in an app
library(shinyjs)

datetimes &lt;- as.POSIXct(c("2012-01-01 12:00:00", "2020-01-01 12:00:00"))
data_datetime &lt;- c(seq(from = datetimes[1], to = datetimes[2], length.out = 100), NA)
fs &lt;- DatetimeFilterState$new(
  x = data_datetime,
  slice = teal_slice(
    varname = "x", dataname = "data", selected = data_datetime[c(47, 98)], keep_na = TRUE
  )
)

ui &lt;- fluidPage(
  useShinyjs(),
  include_css_files(pattern = "filter-panel"),
  include_js_files(pattern = "count-bar-labels"),
  column(4, tags$div(
    tags$h4("DatetimeFilterState"),
    fs$ui("fs")
  )),
  column(4, tags$div(
    id = "outputs", # div id is needed for toggling the element
    tags$h4("Condition (i.e. call)"), # display the condition call generated by this FilterState
    textOutput("condition_datetime"), tags$br(),
    tags$h4("Unformatted state"), # display raw filter state
    textOutput("unformatted_datetime"), tags$br(),
    tags$h4("Formatted state"), # display human readable filter state
    textOutput("formatted_datetime"), tags$br()
  )),
  column(4, tags$div(
    tags$h4("Programmatic filter control"),
    actionButton("button1_datetime", "set drop NA", width = "100%"), tags$br(),
    actionButton("button2_datetime", "set keep NA", width = "100%"), tags$br(),
    actionButton("button3_datetime", "set a range", width = "100%"), tags$br(),
    actionButton("button4_datetime", "set full range", width = "100%"), tags$br(),
    actionButton("button0_datetime", "set initial state", width = "100%"), tags$br()
  ))
)

server &lt;- function(input, output, session) {
  fs$server("fs")
  output$condition_datetime &lt;- renderPrint(fs$get_call())
  output$formatted_datetime &lt;- renderText(fs$format())
  output$unformatted_datetime &lt;- renderPrint(fs$get_state())
  # modify filter state programmatically
  observeEvent(
    input$button1_datetime,
    fs$set_state(teal_slice(dataname = "data", varname = "x", keep_na = FALSE))
  )
  observeEvent(
    input$button2_datetime,
    fs$set_state(teal_slice(dataname = "data", varname = "x", keep_na = TRUE))
  )
  observeEvent(
    input$button3_datetime,
    fs$set_state(
      teal_slice(dataname = "data", varname = "x", selected = data_datetime[c(34, 56)])
    )
  )
  observeEvent(
    input$button4_datetime,
    fs$set_state(
      teal_slice(dataname = "data", varname = "x", selected = datetimes)
    )
  )
  observeEvent(
    input$button0_datetime,
    fs$set_state(
      teal_slice(
        dataname = "data", varname = "x", selected = data_datetime[c(47, 98)], keep_na = TRUE
      )
    )
  )
}

if (interactive()) {
  shinyApp(ui, server)
}

</code></pre>


</div>