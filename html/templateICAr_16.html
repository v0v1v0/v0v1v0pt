<div class="container">

<table style="width: 100%;"><tr>
<td>EM_templateICA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>EM Algorithms for Template ICA Models</h2>

<h3>Description</h3>

<p>EM Algorithms for Template ICA Models
</p>


<h3>Usage</h3>

<pre><code class="language-R">EM_templateICA.spatial(
  template_mean,
  template_var,
  meshes,
  BOLD,
  theta0,
  C_diag,
  H,
  Hinv,
  maxiter = 100,
  usePar = FALSE,
  epsilon = 0.001,
  reduce_dim = TRUE,
  verbose = FALSE
)

EM_templateICA.independent(
  template_mean,
  template_var,
  BOLD,
  theta0,
  C_diag,
  H,
  Hinv,
  maxiter = 100,
  epsilon = 0.001,
  reduce_dim = FALSE,
  usePar = FALSE,
  verbose
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>template_mean</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) mean maps for each IC in template,
where <code class="reqn">Q</code> is the number of ICs, <code class="reqn">V=nvox</code> is the number of data locations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>template_var</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) between-subject variance maps
for each IC in template</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meshes</code></td>
<td>
<p><code>NULL</code> for spatial independence model, otherwise a list of
objects of class "templateICA_mesh" containing the triangular mesh (see
<code>make_mesh</code>) for each brain structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BOLD</code></td>
<td>
<p>(<code class="reqn">V \times Q</code> matrix) dimension-reduced fMRI data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta0</code></td>
<td>
<p>(list) initial guess at parameter values: A (<code class="reqn">QxQ</code> mixing matrix),
nu0_sq (residual variance from first level) and (for spatial model only)
kappa (SPDE smoothness parameter for each IC map)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C_diag</code></td>
<td>
<p>(<code class="reqn">Qx1</code>) diagonal elements of matrix proportional to
residual variance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>H, Hinv</code></td>
<td>
<p>For dimension reduction
of the spatial template ICA model, which assumes that all IC's have the
same smoothness parameter, <code class="reqn">\kappa</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>Maximum number of EM iterations. Default: 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usePar</code></td>
<td>
<p>Parallelize the computation? Default: <code>FALSE</code>. Can be the
number of cores to use or <code>TRUE</code>, which will use the number available minus two.
Not yet implemented for spatial template ICA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
<p>Smallest proportion change between iterations. Default: 0.001.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reduce_dim</code></td>
<td>
<p>Reduce the temporal dimension of the data using PCA?
Default: <code>TRUE</code> for the spatial EM algorithm, and <code>FALSE</code> for the
independent EM algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If <code>TRUE</code>, display progress of algorithm. Default: <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>EM_templateICA.spatial</code> implements the expectation-maximization
(EM) algorithm described in Mejia et al. (2019+) for estimating the
subject-level ICs and unknown parameters in the template ICA model with
spatial priors on subject effects.
</p>
<p>In both models, if original fMRI timeseries has covariance
<code class="reqn">\sigma^2 I_T</code>, the prewhitened timeseries achieved by premultiplying
by (<code class="reqn">QxT</code>) matrix <code class="reqn">H</code> from PCA has diagonal covariance
<code class="reqn">\sigma^2HH'</code>, so C_diag is <code class="reqn">diag(HH')</code>.
</p>


<h3>Value</h3>

<p>A list: theta (list of final parameter estimates), subICmean
(estimates of subject-level ICs), subICvar (variance of subject-level ICs,
for non-spatial model) or subjICcov (covariance matrix of subject-level ICs,
for spatial model â€“ note that only diagonal and values for neighbors are
computed), and success (flag indicating convergence (<code>TRUE</code>) or not
(<code>FALSE</code>))
</p>


</div>