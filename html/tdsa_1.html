<div class="container">

<table style="width: 100%;"><tr>
<td>parm_sens</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Time-Dependent Parameter Sensitivities</h2>

<h3>Description</h3>

<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script><p>Function to calculate time-dependent parameter sensitivities.
</p>
<p>Assume the same model and reward as described in <code>state_sens</code>. Unlike perturbations of the state variables, since the model parameters are not treated as dynamic quantities (even if they may be time-varying), an explicit perturbation of a parameter will only temporarily change the parameter while the perturbation lasts. Now consider a very brief perturbation (i.e., a sharp spike or dip) of the parameter \(b_i\), centered at time \(t\). We define the time-dependent parameter sensitivity \(\kappa_i(t)\) as the sensitivity of the reward to such a perturbation. See Ng et al. (in press, submitted) for a more precise definition.
</p>
<p>This function uses the output returned by <code>state_sens</code> (which contain elements <code>parms</code> and <code>times</code>) to calculate the sensitivity for every parameter in <code>parms</code> at every time step in <code>times</code>.
</p>
<p>See <code>state_sens</code> for examples.
</p>


<h3>Usage</h3>

<pre><code class="language-R">parm_sens(
  state_sens_out,
  numDeriv_arglist = list(),
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>state_sens_out</code></td>
<td>
<p>Output returned by <code>state_sens</code>. List containing the elements <code>model_type</code>, <code>dynamic_fn</code>, <code>parms</code>, <code>dynamic_fn_arglist</code>, <code>times</code>, <code>state</code> and <code>tdss</code>.
</p>
<p>To make this help page easier to read, from now on, any time we mention <code>dynamic_fn</code>, <code>parms</code>, etc., we refer to the corresponding elements in <code>state_sens_out</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numDeriv_arglist</code></td>
<td>
<p>Optional list of arguments passed to the function <code>jacobian</code> from the <span class="pkg">numDeriv</span> package, when calculating derivatives. Can be used to specify the method, and arguments controlling the method. For example, if the parameter sensitivities take too long to calculate, try setting <code>numDeriv_arglist = list(method="simple")</code> to replace Richardson's extrapolation by a simple one-sided epsilon difference.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Whether to display progress messages in the console. Either <code>TRUE</code> (the default) or <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Parameter sensitivities can be obtained from the state sensitivities using the following formulae.
</p>

<ul>
<li>
<p><b>Continuous-time models:</b> 
\[ \kappa_i(t) = \sum_{j=1}^{n_y} \left. \frac{\partial g_j(t,\mathbf{y}(t), \mathbf{b})}{\partial b_i}\right\vert_{\mathbf{b}=\mathbf{b}(t)} \lambda_j(t), \]
where \(\lambda_j(t)\) is the state sensitivity of \(y_j\) at time \(t\).
</p>
</li>
<li>
<p><b>Discrete-time models:</b> 
\[ \kappa_i(t) = \sum_{j=1}^{n_y} \left. \frac{\partial g_j(t,\mathbf{y}(t), \mathbf{b})}{\partial b_i}\right\vert_{\mathbf{b}=\mathbf{b}(t)} \lambda_j(t+1), \]
where \(\lambda_j(t+1)\) is the state sensitivity of \(y_j\) at time step \(t+1\). This also means that the parameter sensitivities are always zero at the final time step \(t_1\), because \(\lambda_j(t_1+1)=0\) for all \(j\).
</p>
</li>
</ul>
<p>To apply these formulae, we need to calculate derivatives of <code>dynamic_fn</code> with respect to <code>parms</code>, using the function <code>jacobian</code> from <span class="pkg">numDeriv</span>. The main coding challenge that we have addressed is to make this work even when the structure of <code>parms</code> is only under the relatively mild restrictions imposed in <code>state_sens</code>.
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>times</code></td>
<td>
<p>Time steps at which the parameter sensitivities are evaluated, a numeric vector. Same as <code>times</code> from <code>state_sens_out</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tdps</code></td>
<td>
<p>Time-dependent parameter sensitivities. An object whose structure depends on the structure of <code>parms</code>.
</p>

<ul>
<li>
<p>If <code>parms</code> is a numeric object, then <code>tdps</code> is an array with one more index than the object, so a vector becomes a matrix, a matrix becomes a 3-index array, etc. The first index is new and is associated with the time step.
</p>
</li>
<li>
<p>If <code>parms</code> is a function of the form <code>function(t)</code> that returns a numeric object (i.e., time-varying parameters), then <code>tdps</code> is an array with one more index than the returned object. Again, the first index is new and is associated with the time step.
</p>
</li>
<li>
<p>If <code>parms</code> is a list containing any combination of numeric objects and functions, then <code>tdps</code> is a list of the same length, with the previous "rules" applied element-wise.
</p>
</li>
</ul>
<p>As a concrete example, say <code>parms</code> is a matrix of dimension <code>c(3,2)</code>, and <code>times</code> a vector of length <code>50</code>. Then <code>tdps</code> is a 3-index array of dimension <code>c(50,3,2)</code>, and the array element <code>tdps[20,1,2]</code> gives the sensitivity for the parameter <code>parms[1,2]</code> at time step <code>times[20]</code>.
</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Ng, W. H., Myers, C. R., McArt, S., &amp; Ellner, S. P. (in press). A time for every purpose: using time-dependent sensitivity analysis to help understand and manage dynamic ecological systems. American Naturalist. eprint doi: <a href="https://doi.org/10.1101/2023.04.13.536769">10.1101/2023.04.13.536769</a>.
</p>
<p>Ng, W. H., Myers, C. R., McArt, S., &amp; Ellner, S. P. (submitted). tdsa: An R package to perform time-dependent sensitivity analysis. Methods in Ecology and Evolution.
</p>


<h3>See Also</h3>

<p><code>state_sens</code> for time-dependent state sensitivities.
</p>


</div>