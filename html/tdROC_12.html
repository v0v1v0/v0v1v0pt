<div class="container">

<table style="width: 100%;"><tr>
<td>tdROC.cr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate time-dependent prediction accuracy measures, including the ROC, AUC, Brier score, and survival probability difference, with competing risk data.</h2>

<h3>Description</h3>

<p>This is a core function of the ‘tdROC‘ package. It uses the nonparametric weights proposed by Wu (Wu and Li, 2018)
to estimate a number of time-dependent prediction accuracy measures for right-censored survival outcomes,
including ROC curve, AUC, Brier score, and survival difference, with competing risk data. For each measure, the variance can be estimated
through bootstrap resampling.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tdROC.cr(
  X,
  Y,
  delta,
  tau,
  span = 0.1,
  h = NULL,
  type = "uniform",
  epsilon = 0.01,
  cut.off = NULL,
  n.grid = 1000,
  nboot = 0,
  alpha = 0.05,
  method = "both",
  output = "both"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a numeric vector of risk score in the same length as <code>Y</code> and <code>delta</code>, such as biomarker or predicted probability. A higher value indicates higher risk of the event.
The calibration results (Brier score, survival difference) are applicable only when the risk score has the predicted probability interpretation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>a numeric vector of time to event in the same length as <code>X</code> and <code>delta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>a vector of numeric indicator of event type in the same length as <code>X</code> and <code>Y</code>. The primary event should be coded as 1,
the competing event should be coded as 2, and censoring should be coded as 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>a scalar, the prediction horizon at which the prediction is evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>span</code></td>
<td>
<p>a numeric value, the proportion of neighbour observations used in nearest neighbor method. The default is 0.1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>a numeric value, the bandwidth of kernel weights, the defualt is <code>NULL</code>. If not specified, the function will use the value of
<code>span</code> to calculate kernel weights. In case both <code>span</code> and <code>h</code> are specified, the function will use <code>h</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character value, indicating the type of kernel function used to calculate kernel weights. The default is <code>"uniform"</code> kernel. Other options are <code>"Epanechnikov"</code> and <code>"normal"</code>.
It will only be used when the bandwidth <code>h</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
<p>The precision parameter used in an approximation to the weight calculation when the sample size is large. If a weight corresponding to a specific risk score is already calculated,
then the weights corresponding to adjacent risk scores, within the distance specified by epsilon, will be the same under the approximation. This approximation avoids repeated
calculation of weights that are almost the same, and hence increases the speed of computation in this situation. The default is NULL, which means no approximation is used. A higher
value indicates less precision.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cut.off</code></td>
<td>
<p>a vector of <code>X</code> cut-off values at which sensitivity and specificity will be calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.grid</code></td>
<td>
<p>a positive integer, the number of grid points used when calculating the ROC curve. The default is <code>1000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>the number of bootstrap replications to be used for variance estimation. The default is <code>nboot = 0</code>, corresponding to no variance estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>It is (1 - level of confidence interval)/2, default is <code>0.05</code>. It is used only when <code>nboot &gt; 0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>It is used to specify which method you would like to use to estimate AUC, default to <code>"both"</code>. Other options are <code>"integral"</code> and <code>"empirical"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>It is used to specify which kind of output you want, default to <code>"both"</code>. Other options are <code>"AUC"</code>, including AUC, sensitivity, and specificity are included,
and <code>"calibration"</code> including Brier Score and survival difference.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function takes the risk score value <code>X</code>, the time-to-event data <code>Y</code> and censoring indicator <code>delta</code> as input to estimate
a number of time-dependent prediction accuracy measures for survival outcomes, including ROC curve, AUC, Brier score, and survival difference, with competing risk.
The confidence intervals of above quantities are estimated by bootstrap.
</p>
<p>For competing risk data, there are two definition of controls introduced by Zheng et al, which are listed below
</p>
<p style="text-align: center;"><code class="reqn">
 \text{Definition A:} \text{Case} k:T \le \tau, \delta = k; \text{Control}_A: (T&gt;\tau)\cup (T \le \tau \cap \delta \ne k)
 </code>
</p>

<p style="text-align: center;"><code class="reqn">
 \text{Definition B:} \text{Case} k:T \le \tau, \delta = k; \text{Control}_B: (T&gt;\tau)
 </code>
</p>

<p>Based on the definition A, both the event-free subjects and subjects who experience other competing events were included as controls. While definition B include only event-free subjects.
This function offers two options to estimate AUC. The first one make use of estimated sensitivity and specificity to calculate the AUC via trapezoidal integration
by setting a series of cutoff point. For the two different definition, we separately calculate the sensitivity, specificity and AUC. The output will also include the sensitivities
and specificities for our plot function. The other one estimates AUC by the empirical estimator of the proportion of concordance pairs with proposed weight estimator (Wu and Li, 2018).
These two methods generate quite similar estimates. The option can be set by the argument <code>method</code>.
</p>
<p>In addition to the above prediction measures, we include Brier Score and survival difference to evaluate the calibration metrics. Their definitions are included below.
They can be estimated with the proposed conditional probability weight (Wu and Li, 2018).
Both of them are measures to assess the accuracy of probabilistic predictions <code>X</code>. The calibration result makes sense only
when the risk score <code>X</code> is a predicted probability, and should be ignored otherwise.
</p>
<p style="text-align: center;"><code class="reqn">
 \text{Brier Score} = E{[1(T \le \tau, \delta = 1) - X]^2}
 </code>
</p>

<p style="text-align: center;"><code class="reqn">
 \text{Survival difference} = E[1(T \le \tau, \delta = 1) - X]
 </code>
</p>

<p>This function uses the same approximation as <code>tdROC</code> with the argument <code>epsilon</code>
</p>


<h3>Value</h3>

<p>Returns a list of the following items:
</p>
<p><code>main_res:</code> a list of <code>AUC.A.integral</code> estimated by trapezoidal integration for definition A,
<code>AUC.A.empirical</code> estimated by empirical estimator for definition A,
<code>AUC.B.integral</code> estimated by trapezoidal integration for definition B,
<code>AUC.B.empirical</code> estimated by empirical estimator for definition B,
and a data frame <code>ROC</code> with dimension <code>(2+n.grid) x 4</code> with columns <code>cut.off</code>, <code>sens</code>, <code>specA</code> and <code>specB</code>.
</p>
<p><code>calibration_res:</code> brier score and survival difference estimated based on the formula similar to Wu and Li (2018). When the risk score <code>X</code>
is a biomarker value instead of a predicted cumulative incidence probability, the brier score and survival difference cannot be calculated. In this case, please disregard the calibration results.
</p>
<p><code>boot_res:</code> a list of bootstrap results, including <code>bAUC.A.integral</code>, <code>bAUC.A.empirical</code>,  <code>bAUC.B.integral</code>, <code>bAUC.B.empirical</code>, <code>bBS</code>, <code>bSurvDiff</code>, <code>bROC</code>.
For <code>bAUC.A.integral</code>, <code>bAUC.A.empirical</code>,  <code>bAUC.B.integral</code>, <code>bAUC.B.empirical</code>, <code>bBS</code>, <code>bSurvDiff</code>, each one is a list including corresponding mean, standard deviation, confidence interval.
<code>bROC</code> is a data frame with colomns <code>sens.mean</code>, <code>sens.sd</code>, <code>sens.lower</code>, <code>sens.upper</code>,
<code>specA.mean</code>, <code>specA.sd</code>, <code>specA.lower</code>, <code>specA.upper</code>, <code>specB.mean</code>, <code>specB.sd</code>, <code>specB.lower</code>, <code>specB.upper</code>
</p>


<h3>References</h3>

<p>Zheng Y, Cai T, Jin Y, Feng Z. Evaluating prognostic accuracy of biomarkers under competing risk. Biometrics. 2012;68(2):388-396. doi:10.1111/j.1541-0420.2011.01671.x
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(survival)
data(Melano)
expit &lt;- function(x){ 1/(1+exp(-x)) }
tdROC.cr(X = expit(Melano$thick) , Y = Melano$time, delta = Melano$status, tau = 1800, nboot = 10)

</code></pre>


</div>