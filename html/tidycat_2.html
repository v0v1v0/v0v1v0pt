<div class="container">

<table style="width: 100%;"><tr>
<td>tidy_categorical</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Expand broom::tidy() Outputs for Categorical Parameter Estimates</h2>

<h3>Description</h3>

<p>Create additional columns in a tidy model output (such as broom::tidy.lm()) to allow for easier control when plotting categorical parameter estimates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tidy_categorical(
  d = NULL,
  m = NULL,
  include_reference = TRUE,
  reference_label = "Baseline Category",
  non_reference_label = paste0("Non-", reference_label),
  exponentiate = FALSE,
  n_level = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>A data frame tibble::tibble() output from broom::tidy.lm(); with one row for each term in the regression, including column <code>term</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>A model object, created using a function such as lm()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_reference</code></td>
<td>
<p>Logical indicating to include additional rows in output for reference categories, obtained from dummy.coef(). Defaults to <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference_label</code></td>
<td>
<p>Character string. When used will create an additional column in output with labels to indicate if terms correspond to reference categories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>non_reference_label</code></td>
<td>
<p>Character string. When <code>reference_label</code> is used will be in output to indicate if terms not corresponding to reference categories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exponentiate</code></td>
<td>
<p>Logical indicating whether or not the results in broom::tidy.lm() are exponentiated. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_level</code></td>
<td>
<p>Logical indicating whether or not to include a column <code>n_level</code> for the number of observations per category. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Expanded tibble::tibble() from the version passed to <code>d</code> including additional columns:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>variable</code></td>
<td>
<p>The name of the variable that the regression term belongs to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The level of the categorical variable that the regression term belongs to. Will be an the term name for numeric variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effect</code></td>
<td>
<p>The type of term (<code>main</code> or <code>interaction</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference</code></td>
<td>
<p>The type of term (<code>reference</code> or <code>non-reference</code>) with label passed from <code>reference_label</code>. If <code>reference_label</code> is set <code>NULL</code> will not be created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_level</code></td>
<td>
<p>The the number of observations per category. If <code>n_level</code> is set <code>NULL</code> (default) will not be created.</p>
</td>
</tr>
</table>
<p>In addition, extra rows will be added, if <code>include_reference</code> is set to <code>FALSE</code> for the reference categories, obtained from dummy.coef()
</p>


<h3>Author(s)</h3>

<p>Guy J. Abel
</p>


<h3>See Also</h3>

<p>broom::tidy.lm()
</p>


<h3>Examples</h3>

<pre><code class="language-R"># strip ordering in factors (currently ordered factor not supported)
library(dplyr)
library(broom)

m0 &lt;- esoph %&gt;%
  mutate_if(is.factor, ~factor(., ordered = FALSE)) %&gt;%
  glm(cbind(ncases, ncontrols) ~ agegp + tobgp * alcgp, data = .,
        family = binomial())
# tidy
tidy(m0)

# add further columns to tidy output to help manage categorical variables
m0 %&gt;%
 tidy() %&gt;%
 tidy_categorical(m = m0, include_reference = FALSE)

# include reference categories and column to indicate the additional terms
m0 %&gt;%
 tidy() %&gt;%
 tidy_categorical(m = m0)

# coefficient plots
d0 &lt;- m0 %&gt;%
  tidy(conf.int = TRUE) %&gt;%
  tidy_categorical(m = m0) %&gt;%
  # drop the intercept term
  slice(-1)
d0

# typical coefficient plot
library(ggplot2)
library(tidyr)
ggplot(data = d0 %&gt;% drop_na(),
       mapping = aes(x = term, y = estimate,
                     ymin = conf.low, ymax = conf.high)) +
  coord_flip() +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_pointrange()

# enhanced coefficient plot using additional columns from tidy_categorical and ggforce::facet_row()
library(ggforce)
ggplot(data = d0,
       mapping = aes(x = level, colour = reference,
                     y = estimate, ymin = conf.low, ymax = conf.high)) +
  facet_row(facets = vars(variable), scales = "free_x", space = "free") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_pointrange() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
</code></pre>


</div>