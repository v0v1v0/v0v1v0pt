<div class="container">

<table style="width: 100%;"><tr>
<td>response_subgroups</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Tabulate binary response by subgroup</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>The <code>tabulate_rsp_subgroups()</code> function creates a layout element to tabulate binary response by subgroup, returning
statistics including response rate and odds ratio for each population subgroup. The table is created from <code>df</code>, a
list of data frames returned by <code>extract_rsp_subgroups()</code>, with the statistics to include specified via the <code>vars</code>
parameter.
</p>
<p>A forest plot can be created from the resulting table using the <code>g_forest()</code> function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tabulate_rsp_subgroups(
  lyt,
  df,
  vars = c("n_tot", "n", "prop", "or", "ci"),
  groups_lists = list(),
  label_all = "All Patients",
  riskdiff = NULL,
  na_str = default_na_str(),
  .formats = c(n = "xx", n_rsp = "xx", prop = "xx.x%", n_tot = "xx", or =
    list(format_extreme_values(2L)), ci = list(format_extreme_values_ci(2L)), pval =
    "x.xxxx | (&lt;0.0001)")
)

a_response_subgroups(
  .formats = list(n = "xx", n_rsp = "xx", prop = "xx.x%", n_tot = "xx", or =
    list(format_extreme_values(2L)), ci = list(format_extreme_values_ci(2L)), pval =
    "x.xxxx | (&lt;0.0001)", riskdiff = "xx.x (xx.x - xx.x)"),
  na_str = default_na_str()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lyt</code></td>
<td>
<p>(<code>PreDataTableLayouts</code>)<br> layout that analyses will be added to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>(<code>list</code>)<br> a list of data frames containing all analysis variables. List should be
created using <code>extract_rsp_subgroups()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>(<code>character</code>)<br> the names of statistics to be reported among:
</p>

<ul>
<li> <p><code>n</code>: Total number of observations per group.
</p>
</li>
<li> <p><code>n_rsp</code>: Number of responders per group.
</p>
</li>
<li> <p><code>prop</code>: Proportion of responders.
</p>
</li>
<li> <p><code>n_tot</code>: Total number of observations.
</p>
</li>
<li> <p><code>or</code>: Odds ratio.
</p>
</li>
<li> <p><code>ci</code> : Confidence interval of odds ratio.
</p>
</li>
<li> <p><code>pval</code>: p-value of the effect.
Note, the statistics <code>n_tot</code>, <code>or</code>, and <code>ci</code> are required.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups_lists</code></td>
<td>
<p>(named <code>list</code> of <code>list</code>)<br> optionally contains for each <code>subgroups</code> variable a
list, which specifies the new group levels via the names and the
levels that belong to it in the character vectors that are elements of the list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_all</code></td>
<td>
<p>(<code>string</code>)<br> label for the total population analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>riskdiff</code></td>
<td>
<p>(<code>list</code>)<br> if a risk (proportion) difference column should be added, a list of settings to apply
within the column. See <code>control_riskdiff()</code> for details. If <code>NULL</code>, no risk difference column will be added. If
<code>riskdiff$arm_x</code> and <code>riskdiff$arm_y</code> are <code>NULL</code>, the first level of <code>df$prop$arm</code> will be used as <code>arm_x</code> and
the second level as <code>arm_y</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_str</code></td>
<td>
<p>(<code>string</code>)<br> string used to replace all <code>NA</code> or empty values in the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.formats</code></td>
<td>
<p>(named <code>character</code> or <code>list</code>)<br> formats for the statistics. See Details in <code>analyze_vars</code> for more
information on the <code>"auto"</code> setting.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These functions create a layout starting from a data frame which contains
the required statistics. Tables typically used as part of forest plot.
</p>


<h3>Value</h3>

<p>An <code>rtables</code> table summarizing binary response by subgroup.
</p>

<ul><li> <p><code>a_response_subgroups()</code> returns the corresponding list with formatted <code>rtables::CellValue()</code>.
</p>
</li></ul>
<h3>Functions</h3>


<ul>
<li> <p><code>tabulate_rsp_subgroups()</code>: Table-creating function which creates a table
summarizing binary response by subgroup. This function is a wrapper for <code>rtables::analyze_colvars()</code>
and <code>rtables::summarize_row_groups()</code>.
</p>
</li>
<li> <p><code>a_response_subgroups()</code>: Formatted analysis function which is used as <code>afun</code> in <code>tabulate_rsp_subgroups()</code>.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>extract_rsp_subgroups()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(dplyr)
library(forcats)

adrs &lt;- tern_ex_adrs
adrs_labels &lt;- formatters::var_labels(adrs)

adrs_f &lt;- adrs %&gt;%
  filter(PARAMCD == "BESRSPI") %&gt;%
  filter(ARM %in% c("A: Drug X", "B: Placebo")) %&gt;%
  droplevels() %&gt;%
  mutate(
    # Reorder levels of factor to make the placebo group the reference arm.
    ARM = fct_relevel(ARM, "B: Placebo"),
    rsp = AVALC == "CR"
  )
formatters::var_labels(adrs_f) &lt;- c(adrs_labels, "Response")

# Unstratified analysis.
df &lt;- extract_rsp_subgroups(
  variables = list(rsp = "rsp", arm = "ARM", subgroups = c("SEX", "BMRKR2")),
  data = adrs_f
)
df

# Stratified analysis.
df_strat &lt;- extract_rsp_subgroups(
  variables = list(rsp = "rsp", arm = "ARM", subgroups = c("SEX", "BMRKR2"), strata = "STRATA1"),
  data = adrs_f
)
df_strat

# Grouping of the BMRKR2 levels.
df_grouped &lt;- extract_rsp_subgroups(
  variables = list(rsp = "rsp", arm = "ARM", subgroups = c("SEX", "BMRKR2")),
  data = adrs_f,
  groups_lists = list(
    BMRKR2 = list(
      "low" = "LOW",
      "low/medium" = c("LOW", "MEDIUM"),
      "low/medium/high" = c("LOW", "MEDIUM", "HIGH")
    )
  )
)
df_grouped

# Table with default columns
basic_table() %&gt;%
  tabulate_rsp_subgroups(df)

# Table with selected columns
basic_table() %&gt;%
  tabulate_rsp_subgroups(
    df = df,
    vars = c("n_tot", "n", "n_rsp", "prop", "or", "ci")
  )

# Table with risk difference column added
basic_table() %&gt;%
  tabulate_rsp_subgroups(
    df,
    riskdiff = control_riskdiff(
      arm_x = levels(df$prop$arm)[1],
      arm_y = levels(df$prop$arm)[2]
    )
  )

</code></pre>


</div>