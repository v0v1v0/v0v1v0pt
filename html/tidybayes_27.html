<div class="container">

<table style="width: 100%;"><tr>
<td>compare_levels</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compare the value of draws of some variable from a Bayesian model for
different levels of a factor</h2>

<h3>Description</h3>

<p>Given posterior draws from a Bayesian model in long format (e.g. as
returned by <code>spread_draws()</code>), compare the value of a variable in those draws
across different paired combinations of levels of a factor.
</p>


<h3>Usage</h3>

<pre><code class="language-R">compare_levels(
  data,
  variable,
  by,
  fun = `-`,
  comparison = "default",
  draw_indices = c(".chain", ".iteration", ".draw"),
  ignore_groups = ".row"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Long-format <code>data.frame</code> of draws such as returned by
<code>spread_draws()</code> or <code>gather_draws()</code>. If <code>data</code>
is a grouped data frame, comparisons will be made within groups (if
one of the groups in the data frame is the <code>by</code> column, that specific
group will be ignored, as it is not possible to make comparisons both
within some variable and across it simultaneously).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variable</code></td>
<td>
<p>Bare (unquoted) name of a column in data representing the
variable to compare across levels. Can be a numeric variable (as in
long-data-frame-of-draws format) or a <code>posterior::rvar</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>Bare (unquoted) name of a column in data that is a
<code>factor</code> or <code>ordered</code>. The value of <code>variable</code> will be
compared across pairs of levels of this <code>factor</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>Binary function to use for comparison. For each pair of levels of
<code>by</code> we are comparing (as determined by <code>comparison</code>), compute the
result of this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comparison</code></td>
<td>
<p>One of (a) the comparison types <code>ordered</code>,
<code>control</code>, <code>pairwise</code>, or <code>default</code> (may also be given as
strings, e.g. <code>"ordered"</code>), see <em>Details</em>; (b) a user-specified
function that takes a <code>factor</code> and returns a list of pairs of names of
levels to compare (as strings) and/or unevaluated expressions containing
representing the comparisons to make; or (c) a list of pairs of names of
levels to compare (as strings) and/or unevaluated expressions representing
the comparisons to make, e.g.: <code>list(c("a", "b"), c("b", "c"))</code> or
<code>exprs(a - b, b - c)</code>, both of which would compare level <code>"a"</code> against
<code>"b"</code> and level <code>"b"</code> against <code>"c"</code>. Note that the
unevaluated expression syntax ignores the <code>fun</code> argument, can include
any other functions desired (e.g. variable transformations), and can even
include more than two levels or other columns in <code>data</code>. Types (b) and
(c) may use named lists, in which case the provided names are used
in the output <code>variable</code> column instead converting the unevaluated
expression to a string. You can also use <code>emmeans_comparison()</code> to generate
a comparison function based on contrast methods from the <code>emmeans</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw_indices</code></td>
<td>
<p>Character vector of column names that should be treated
as indices of draws. Operations are done within combinations of these values.
The default is <code>c(".chain", ".iteration", ".draw")</code>, which is the same names
used for chain, iteration, and draw indices returned by <code>tidy_draws()</code>.
Names in <code>draw_indices</code> that are not found in the data are ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore_groups</code></td>
<td>
<p>character vector of names of groups to ignore by
default in the input grouping. This is primarily provided to make it
easier to pipe output of <code>add_epred_draws()</code> into this function,
as that function provides a <code>".row"</code> output column that is grouped,
but which is virtually never desired to group by when using <code>compare_levels</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function simplifies conducting comparisons across levels of some
variable in a tidy data frame of draws. It applies <code>fun</code> to all
values of <code>variable</code> for each pair of levels of <code>by</code> as selected
by <code>comparison</code>. By default, all pairwise comparisons are generated if
<code>by</code> is an unordered <code>factor</code> and ordered comparisons are made if
<code>by</code> is <code>ordered</code>.
</p>
<p>The included <code>comparison</code> types are: </p>
 <ul>
<li> <p><code>ordered</code>:
compare each level <code>i</code> with level <code>i - 1</code>; e.g. <code>fun(i, i - 1)</code> </p>
</li>
<li> <p><code>pairwise</code>: compare each level of <code>by</code> with every other
level.  </p>
</li>
<li> <p><code>control</code>: compare each level of <code>by</code> with the first
level of <code>by</code>.  If you wish to compare with a different level, you can
first apply <code>relevel()</code> to <code>by</code> to set the control
(reference) level.  </p>
</li>
<li> <p><code>default</code>: use <code>ordered</code> if
<code>is.ordered(by)</code> and <code>pairwise</code> otherwise.  </p>
</li>
</ul>
<h3>Value</h3>

<p>A <code>data.frame</code> with the same columns as <code>data</code>, except
that the <code>by</code> column contains a symbolic representation of the
comparison of pairs of levels of <code>by</code> in <code>data</code>, and
<code>variable</code> contains the result of that comparison.
</p>


<h3>Author(s)</h3>

<p>Matthew Kay
</p>


<h3>See Also</h3>

<p><code>emmeans_comparison()</code> to use <code>emmeans</code>-style contrast methods with
<code>compare_levels()</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(dplyr)
library(ggplot2)

data(RankCorr, package = "ggdist")

# Let's do all pairwise comparisons of b[i,1]:
RankCorr %&gt;%
  spread_draws(b[i,j]) %&gt;%
  filter(j == 1) %&gt;%
  compare_levels(b, by = i) %&gt;%
  median_qi()

# Or let's plot all comparisons against the first level (control):
RankCorr %&gt;%
  spread_draws(b[i,j]) %&gt;%
  filter(j == 1) %&gt;%
  compare_levels(b, by = i, comparison = control) %&gt;%
  ggplot(aes(x = b, y = i)) +
  stat_halfeye()

# Or let's plot comparisons of all levels of j within
# all levels of i
RankCorr %&gt;%
  spread_draws(b[i,j]) %&gt;%
  group_by(i) %&gt;%
  compare_levels(b, by = j) %&gt;%
  ggplot(aes(x = b, y = j)) +
  stat_halfeye() +
  facet_grid(cols = vars(i))

</code></pre>


</div>