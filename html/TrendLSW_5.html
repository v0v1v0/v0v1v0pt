<div class="container">

<table style="width: 100%;"><tr>
<td>ewspec.diff</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimation of Evolutionary Wavelet Spectrum of Non-Zero Mean Time
Series via Differencing</h2>

<h3>Description</h3>

<p>Internal function to estimate the evolutionary wavelet spectrum (EWS) of
a time series that may include a trend component. The estimate is computed
by taking the non-decimated wavelet transform of the first differenced time
series data, squaring it; smoothing using a running mean and then correcting
for bias using the appropriate correction matrix. Inherits the smoothing
functionality from the <code>ewspec3</code> function in the R package <code>locits</code>.
This function is not intended for general use by regular users of the package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ewspec.diff(
  x,
  lag = 1,
  filter.number = 4,
  family = "DaubExPhase",
  binwidth = floor(2 * sqrt(length(x))),
  diff.number = 1,
  max.scale = floor(log2(length(x)) * 0.7),
  S.smooth = TRUE,
  smooth.type = "epan",
  boundary.handle = FALSE,
  AutoReflect = FALSE,
  supply.inv.mat = FALSE,
  inv.mat = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The time series you wish to analyse.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lag</code></td>
<td>
<p>An integer indicating which lag to use for differencing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter.number</code></td>
<td>
<p>The index number for the wavelet used to analyse the
time series. For the "DaubExPhase" family, the filter number can be between
1 to 10. For the "DaubLeAsymm" family, the filter number can be between 4 to
10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>The family of the wavelet used. It is recommended to use
either the Daubechies Extremal Phase family, or the Daubechies Least
Asymmetric family, corresponding to the "DaubExPhase" or the "DaubLeAsymm"
options.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binwidth</code></td>
<td>
<p>The bin width of the running mean smoother used to smooth
the raw wavelet periodogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diff.number</code></td>
<td>
<p>The number of differences used to remove the trend of the
series. A first difference is recommended as default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.scale</code></td>
<td>
<p>The coarsest level to which the time series is analysed to.
Should be a positive integer less than <code class="reqn">J</code>, where <code class="reqn">T=2^J</code> is the length of the
time series. The default setting is <code class="reqn">0.7J</code>, to control for bias.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S.smooth</code></td>
<td>
<p>Argument that dictates if smoothing is performed on the raw
wavelet periodogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth.type</code></td>
<td>
<p>String indicating which type of smoothing to use on wavelet periodogram.
Can be <code>"mean"</code>, <code>"median"</code>, or <code>"epan"</code>. Default is <code>"epan"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boundary.handle</code></td>
<td>
<p>Logical variable, if TRUE, then boundary handling
will be applied when computing the periodogram. Recommended to set as FALSE,
will be set as TRUE automatically if non-dyadic data is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AutoReflect</code></td>
<td>
<p>As in <code>wavethresh</code>. Decides whether or not the time series
is reflected when computing the wavelet transform. Strongly recommended to
leave as FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>supply.inv.mat</code></td>
<td>
<p>Not intended for general use. If TRUE, user must supply the
appropriate correction matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inv.mat</code></td>
<td>
<p>Not intended for general use. If supply.mat is TRUE, user must supply the
appropriate correction matrix used to correct the raw wavelet periodogram.
Equal to <code class="reqn">(2A-2A_1)^{-1}</code> for first differences.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Computes an estimate of the evolutionary wavelet spectrum of a
time series that displays nonstationary mean and autocovariance. The
estimation procedure is as follows:
</p>
<p>1. The time series is differenced to remove the trend.
</p>
<p>2. The squared modulus of the non-decimated wavelet transform is computed,
known as the raw wavelet periodogram. This is returned by the function.
</p>
<p>3. The raw wavelet periodogram is smoothed using a running mean smoother.
</p>
<p>4. The smoothed periodogram is bias corrected using the inverse of the bias
matrix.
</p>
<p>The final estimate, stored in the S component, can be plotted using the plot
function, please see the example below.
</p>


<h3>Value</h3>

<p>A list object, containing the following fields:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>The evolutionary wavelet spectral estimate of the input data. This object is of
class wd and so can be plotted and printed in the usual way using wavethresh
functionality. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>WavPer</code></td>
<td>
<p> The raw wavelet periodogram of the input
data. The EWS estimate (above) is the smoothed corrected version of the
wavelet periodogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SmoothWavPer</code></td>
<td>
<p> The smoothed, un-corrected raw
wavelet periodogram of the input data. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.scale, boundary.handle, S.smooth, smooth.type, binwidth, lag, diff.number</code></td>
<td>
<p>Input parameters</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>McGonigle, E. T., Killick, R., and Nunes, M. (2022). Modelling
time-varying first and second-order structure of time series via wavelets
and differencing. <em>Electronic Journal of Statistics</em>, 6(2), 4398-4448.
wavethresh::plot.wd(spec.est$S)
</p>


<h3>See Also</h3>

<p><code>TLSW</code>, <code>ewspec3</code>
</p>


</div>