<div class="container">

<table style="width: 100%;"><tr>
<td>seqsha</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Sequence History Analysis (SHA)
</h2>

<h3>Description</h3>

<p>Sequence History Analysis (SHA) aims to study how a previous trajectory is linked to an upcoming event. This procedure relies on sequence analysis typologies to identify the type of previous trajectory as a time-varying covariate and uses discrete-time survival models to estimate its relationship with the upcoming event under consideration.
</p>


<h3>Usage</h3>

<pre><code class="language-R">seqsha(seqdata, time, event, include.present = FALSE, align.end = FALSE, covar = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>seqdata</code></td>
<td>
<p>State sequence object created with the <code>seqdef</code> function. The whole trajectory followed by individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>Numeric. The time of occurrence of the event or the observation time for censored observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>Logical. Whether the event occured or not (censored observations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include.present</code></td>
<td>
<p>Logical. If <code>FALSE</code> (default), the state occurring at the current time is not included in the previous trajectory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>align.end</code></td>
<td>
<p>Logical. If <code>FALSE</code> (default), the previous trajectories are aligned at the beginning of the trajectory. If <code>TRUE</code>, the previous trajectories are aligned on the end.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar</code></td>
<td>
<p>Optional <code>data.frame</code> storing covariates of interest. These covariates are added to the final data set. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>SHA works in four steps. First, it makes use of a discrete-time representation of the data also known as person-period file. In this format, one observation is generated for each individual  at each time point. Second, the previous trajectory at each time point is coded as the sequence of states from the beginning (t=1 in our example) until the previous position t-1. Third, a typology of the previous trajectory is created using standard sequence analysis procedure. This results in a new time-varying covariate coding the type of previous trajectory at each time point. Fourth, the relationship between the previous trajectory and the subsequent event is estimated using a discrete-time model, which includes the past trajectory type as a covariate. In this step, other covariates can be included as well.
</p>
<p>The <code>seqsha</code> function can be used to automatically reorganize the data according to the first two steps described above. Then, a standard procedure can be applied on the resulting data set. The example section below provides an example of the whole procedure.
</p>


<h3>Value</h3>

<p>A data frame with the following variables:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>Numeric. The ID of the observation as the row number in the original <code>seqdata</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>Numeric. The time unit from the beginning of the original sequence until the occurence of the event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>Logical. Whether the event occured within this time unit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>T1 until T...</code></td>
<td>
<p>The state sequence coding the previous trajectory. Columns names depends on <code>seqdata</code> and <code>aligne.end</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Optional covariate list</code></td>
<td>
<p>The covariates provided with the <code>covar</code> argument.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Matthias Studer
</p>


<h3>References</h3>

<p>Rossignon F., Studer M., Gauthier JA., Le Goff JM. (2018). Sequence History Analysis (SHA): Estimating the Effect of Past Trajectories on an Upcoming Event. In: Ritschard G., Studer M. (eds) <em>Sequence Analysis and Related Approaches</em>. Life Course Research and Social Policies, vol 10. Springer: Cham. <a href="https://doi.org/10.1007/978-3-319-95420-2_6">doi:10.1007/978-3-319-95420-2_6</a>
</p>


<h3>See Also</h3>

<p><code>seqcta</code>, <code>seqsamm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Create seq object for biofam data.
data(biofam)
## Reduce the biofam data to accelerate example
biofam &lt;- biofam[100:300,]
bf.shortlab &lt;- c("P","L","M","LM","C","LC", "LMC", "D")
bf.seq &lt;- seqdef(biofam[,10:25], states=bf.shortlab)

## We focus on the occurrence the start of a LMC spell
## The code below aims to find when this event occurred (and whether it occurred).
bf.seq2 &lt;- seqrecode(bf.seq, recodes=list(LMC="LMC"), otherwise = "Other")
dss &lt;- seqdss(bf.seq2)
## Time until LMC spell
time &lt;- ifelse(dss[, 1]=="LMC", 1, seqdur(bf.seq2)[, 1])
## Whether the event (start of LMC spell) started or not
event &lt;- dss[, 1]=="LMC"|dss[, 2]=="LMC"

## The seqsha function will convert the data to person period.
## At each time point, the previous trajectory until that point is stored
sha &lt;- seqsha(bf.seq, time, event, covar=biofam[, c("sex", "birthyr")])
summary(sha)

## Not run: 
## Now we build a sequence object for the previous trajectory
previousTraj &lt;- seqdef(sha[, 4:19])
seqdplot(previousTraj)
## Now we cluster the previous trajectories
##Compute distances using only the dss
## Ensure high sensitivity to ordering of the states
diss &lt;- seqdist(seqdss(previousTraj), method="LCS")
##Clustering with pam
library(cluster)
pclust &lt;- pam(diss, diss=TRUE, k=4, cluster.only=TRUE)
#Naming the clusters
sha$pclustname &lt;- factor(paste("Type", pclust))
##Plotting the clusters to make senses of them.
seqdplot(previousTraj, sha$pclustname)


## Now we use a discrete time model include the type of previous trajectory as covariate.
summary(glm(event~time+pclustname+sex, data=sha, family=binomial))

## End(Not run)

</code></pre>


</div>