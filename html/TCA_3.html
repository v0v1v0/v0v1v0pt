<div class="container">

<table style="width: 100%;"><tr>
<td>tcareg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting a TCA regression model</h2>

<h3>Description</h3>

<p>TCA regression allows to test, under several types of statistical tests, the effects of source-specific values on an outcome of interest (or on mediating components thereof). For example, in the context of tissue-level bulk DNA methylation data coming from a mixture of cell types (i.e. the input is methylation sites by individuals), <code>tcareg</code> allows to test for cell-type-specific effects of methylation on outcomes of interest (or on mediating components thereof).
</p>


<h3>Usage</h3>

<pre><code class="language-R">tcareg(
  X,
  tca.mdl,
  y,
  C3 = NULL,
  test = "marginal_conditional",
  null_model = NULL,
  alternative_model = NULL,
  save_results = FALSE,
  fast_mode = TRUE,
  output = "TCA",
  sort_results = FALSE,
  parallel = FALSE,
  num_cores = NULL,
  log_file = "TCA.log",
  features_metadata = NULL,
  debug = FALSE,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>An <code>m</code> by <code>n</code> matrix of measurements of <code>m</code> features for <code>n</code> observations. Each column in <code>X</code> is assumed to be a mixture of <code>k</code> sources. Note that <code>X</code> must include row names and column names and that NA values are currently not supported. <code>X</code> should not include features that are constant across all observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tca.mdl</code></td>
<td>
<p>The value returned by applying tca to <code>X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>An <code>n</code> by 1 matrix of an outcome of interest for each of the <code>n</code> observations in <code>X</code>. Note that <code>y</code> must include row names and column names and that NA values are currently not supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C3</code></td>
<td>
<p>An <code>n</code> by <code>p3</code> design matrix of covariates that may affect <code>y</code>. Note that <code>C3</code> must include row names and column names and should not include an intercept term. NA values are currently not supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>
<p>A character vector with the type of test to perform on each of the features in <code>X</code>; one of the following options: <code>'marginal'</code>, <code>'marginal_conditional'</code>, <code>'joint'</code>, <code>'single_effect'</code>, or <code>'custom'</code>. Setting <code>'marginal'</code> or <code>'marginal_conditional'</code> corresponds to testing each feature in <code>X</code> for a statistical relation between <code>y</code> and each of the <code>k</code> sources separately; for any particular source under test, the <code>marginal_conditional</code> option further accounts for possible effects of the rest of the <code>k-1</code> sources (<code>'marginal'</code> will therefore tend to be more powerful in discovering truly related features, but at the same time more prone to falsely tagging the correct related sources if sources are highly correlated). Setting <code>'joint'</code> or <code>'single_effect'</code> corresponds to testing each feature for an overall statistical relation with <code>y</code>, while modeling source-specific effects; the latter option further assumes that the source-specific effects are the same within each feature (<code>'single_effect'</code> means only one degree of freedom and will therefore be more powerful when the assumption of a single effect within a feature holds). Finally, <code>'custom'</code> corresponds to testing each feature in <code>X</code> for a statistical relation with <code>y</code> under a user-specified model (alternative model) with respect to a null model (null model); for example, for testing for relation of the combined (potentially different) effects of features 1 and 2 while accounting for the (potentially different) effects of 3 and 4, set the null model to be sources 3, 4 and the alternative model to be sources 1, 2, 3, 4. Indicating that <code>null_model</code> assumes no effect for any of the sources can be done by setting it to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null_model</code></td>
<td>
<p>A vector with a subset of the names of the sources in <code>tca.mdl$W</code> to be used as a null model (activated only if <code>test == 'custom'</code>). Note that the null model must be nested within the alternative model; set <code>null_model</code> to be <code>NULL</code> for indicating no effect for any of the sources under the null model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative_model</code></td>
<td>
<p>A vector with a subset (or all) of the names of the sources in <code>tca.mdl$W</code> to be used as an alternative model (activated only if <code>test == 'custom'</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_results</code></td>
<td>
<p>A logical value indicating whether to save the returned results in a file. If <code>test == 'marginal'</code> or (<code>fast_mode == TRUE</code> and <code>test == 'marginal_conditional'</code>) then <code>k</code> files will be saved (one for the results of each source).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fast_mode</code></td>
<td>
<p>A logical value indicating whether to use a fast version of TCA regression, in which source-specific-values are first estimated using the <code>tensor</code> function and then tested under a standard regression framework (see more details below).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>Prefix for output files (activated only if <code>save_results == TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sort_results</code></td>
<td>
<p>A logical value indicating whether to sort the results by their p-value (i.e. features with lower p-value will appear first in the results). This option is not available if <code>fast_mode == TRUE</code> and <code>test == "marginal_conditional"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>A logical value indicating whether to use parallel computing (possible when using a multi-core machine).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_cores</code></td>
<td>
<p>A numeric value indicating the number of cores to use (activated only if <code>parallel == TRUE</code>). If <code>num_cores == NULL</code> then all available cores except for one will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log_file</code></td>
<td>
<p>A path to an output log file. Note that if the file <code>log_file</code> already exists then logs will be appended to the end of the file. Set <code>log_file</code> to <code>NULL</code> to prevent output from being saved into a file; note that if <code>verbose == FALSE</code> then no output file will be generated regardless of the value of <code>log_file</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>features_metadata</code></td>
<td>
<p>A path to a csv file containing metadata about the features in <code>X</code> that will be added to the output files (activated only if <code>save_results == TRUE</code>). Each row in the metadata file should correspond to one feature in <code>X</code> (with the row name being the feature identifier, as it appears in the rows of <code>X</code>) and each column should correspond to one metadata descriptor (with an appropriate column name). Features that do not exist in <code>X</code> will be ignored and features in <code>X</code> with missing metadata information will show missing values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>debug</code></td>
<td>
<p>A logical value indicating whether to set the logger to a more detailed debug level; set <code>debug</code> to <code>TRUE</code> before reporting issues.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A logical value indicating whether to print logs.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>TCA models <code class="reqn">Z_{hj}^i</code> as the source-specific value of observation <code class="reqn">i</code> in feature <code class="reqn">j</code> coming from source <code class="reqn">h</code> (see tca for more details). A TCA regression model tests an outcome <code class="reqn">Y</code> for a linear statistical relation with the source-specific values of a feature <code class="reqn">j</code> by assuming: </p>
<p style="text-align: center;"><code class="reqn">Y_i =  \alpha_{j,0} + \sum_{h=1}^k\beta_{hj} Z_{hj}^i + c_i^{(3)}\alpha_{j}  + e_i</code>
</p>
<p> where <code class="reqn">\alpha_{j,0}</code> is an intercept term, <code class="reqn">\beta_{hj}</code> is the effect of source <code class="reqn">h</code>, <code class="reqn">c_i^{(3)}</code> and <code class="reqn">\alpha_j</code> correspond to the <code class="reqn">p_3</code> covariate values of observation <code class="reqn">i</code> (i.e. a row vector from <code>C3</code>) and their effect sizes, respectively, and <code class="reqn">e_i \sim N(0,\phi^2)</code>. In practice, if <code>fast_mode == FALSE</code> then <code>tcareg</code> fits this model using the conditional distribution <code class="reqn">Y|X</code>, which, effectively, integrates over the random <code class="reqn">Z_{hj}^i</code>. Statistical significance is then calculated using a likelihood ratio test (LRT).
Alternatively, in case <code>fast_mode == TRUE</code> the above model is fitted by first learning point estimates for <code class="reqn">Z_{hj}^i</code> using the tensor function and then assessing statistical significance using T-tests and partial F-tests under a standard regression framework. This alternative provides a substantial boost in speed.
</p>
<p>Note that the null and alternative models will be set automatically, except when <code>test == 'custom'</code>, in which case they will be set according to the user-specified null and alternative hypotheses.
</p>
<p>Under the TCA regression model, several statistical tests can be performed by setting the argument <code>test</code> according to one of the following options:
</p>
<p>1. If <code>test == 'marginal'</code>, <code>tcareg</code> will perform the following for each source <code class="reqn">l</code>. For each feature <code class="reqn">j</code>, <code class="reqn">\beta_{lj}</code> will be estimated and tested for a non-zero effect, while assuming <code class="reqn">\beta_{hj}=0</code> for all other sources <code class="reqn">h\neq l</code>.
</p>
<p>2. If <code>test == 'marginal_conditional'</code>, <code>tcareg</code> will perform the following for each source <code class="reqn">l</code>. For each feature <code class="reqn">j</code>, <code class="reqn">\beta_{lj}</code> will be estimated and tested for a non-zero effect, while also estimating the effect sizes <code class="reqn">\beta_{hj}</code> for all other sources <code class="reqn">h\neq l</code> (thus accounting for covariances between the estimated effects of different sources).
</p>
<p>3. If <code>test == 'joint'</code>, <code>tcareg</code> will estimate for each feature <code class="reqn">j</code> the effect sizes of all <code class="reqn">k</code> sources <code class="reqn">\beta_{1j},…,\beta_{kj}</code> and then test the set of <code class="reqn">k</code> estimates of each feature <code>j</code> for a joint effect.
</p>
<p>4. If <code>test == 'single_effect'</code>, <code>tcareg</code> will estimate for each feature <code class="reqn">j</code> the effect sizes of all <code class="reqn">k</code> sources <code class="reqn">\beta_{1j},…,\beta_{kj}</code>, under the assumption that <code class="reqn">\beta_{1j} = … = \beta_{kj}</code>, and then test the set of <code class="reqn">k</code> estimates of each feature <code>j</code> for a joint effect.
</p>
<p>5. If <code>test == 'custom'</code>, <code>tcareg</code> will estimate for each feature <code class="reqn">j</code> the effect sizes of a predefined set of sources (defined by a user-specified alternative model) and then test their estimates for a joint effect, while accounting for a nested predefined set of sources (defined by a user-specified null model).
</p>


<h3>Value</h3>

<p>A list with the results of applying the TCA regression model to each of the features in <code>X</code>. If <code>test == 'marginal'</code> or (<code>test == 'marginal_conditional'</code> and <code>fast_mode == FALSE</code>) then a list of <code>k</code> such lists of results are returned, one for the results of each source.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>An estimate of the standard deviation of the i.i.d. component of variation in the TCA regression model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>A matrix of effect size estimates for the source-specific effects, such that each row corresponds to the estimated effect sizes of one feature in <code>X</code>. The number of columns corresponds to the number of estimated effects (e.g., if <code>test</code> is set to <code>marginal</code> then <code>beta</code> will include a single column, if <code>test</code> is set to <code>joint</code> then <code>beta</code> will include <code>k</code> columns etc.).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>An <code>m</code> by <code>1</code> matrix of estimates for the intercept term of each feature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>An <code>m</code> by <code>p3</code> matrix of effect size estimates for the <code>p3</code> covariates in <code>C3</code>, such that each row corresponds to the estimated effect sizes of one feature in <code>X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null_ll</code></td>
<td>
<p>An <code>m</code> by <code>1</code> matrix of the log-likelihood of the model under the null hypothesis. Returned only if <code>fast_mode == FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative_ll</code></td>
<td>
<p>An <code>m</code> by <code>1</code> matrix of the log-likelihood of the model under the alternative hypothesis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stats</code></td>
<td>
<p>An <code>m</code> by <code>k</code> matrix of T statistics for each source in each feature in <code>X</code> assuming <code>test == "marginal_conditional"</code> and <code>fast_mode == TRUE</code>; otherwise, an <code>m</code> by <code>1</code> matrix of an (partial) F statistic (if <code>fast_mode == TRUE</code>) or a likelihood-ratio test statistic (if <code>fast_mode == FALSE</code>) for each feature in <code>X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>The degrees of freedom for deriving p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvals</code></td>
<td>
<p>An <code>m</code> by <code>k</code> matrix of p-values for each source in each feature in <code>X</code> assuming <code>test == "marginal_conditional"</code> and <code>fast_mode == TRUE</code>; otherwise, an <code>m</code> by <code>1</code> matrix of the p-value for each feature in <code>X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qvals</code></td>
<td>
<p>An <code>m</code> by <code>k</code> matrix of q-values (FDR-adjusted p-values) for each source in each feature in <code>X</code> assuming <code>test == "marginal_conditional"</code> and <code>fast_mode == TRUE</code>; otherwise, an <code>m</code> by <code>1</code> matrix of the q-value for each feature in <code>X</code>. Note that if <code>test == "marginal_conditional"</code> and <code>fast_mode == TRUE</code> then q-values are calculated for each source separately.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Rahmani E, Schweiger R, Rhead B, Criswell LA, Barcellos LF, Eskin E, Rosset S, Sankararaman S, Halperin E. Cell-type-specific resolution epigenetics without the need for cell sorting or single-cell biology. Nature Communications 2019.
</p>


<h3>Examples</h3>

<pre><code class="language-R">n &lt;- 50
m &lt;- 10
k &lt;- 3
p1 &lt;- 1
p2 &lt;- 1
data &lt;- test_data(n, m, k, p1, p2, 0.01)
tca.mdl &lt;- tca(X = data$X, W = data$W, C1 = data$C1, C2 = data$C2)
y &lt;- matrix(rexp(n, rate=.1), ncol=1)
rownames(y) &lt;- rownames(data$W)
# marginal conditional test:
res0 &lt;- tcareg(data$X, tca.mdl, y)
# joint test:
res1 &lt;- tcareg(data$X, tca.mdl, y, test = "joint")
# custom test, testing for a joint effect of sources 1,2 while accounting for source 3
res2 &lt;- tcareg(data$X, tca.mdl, y, test = "custom", null_model = c("3"),
alternative_model = c("1","2","3"))
# custom test, testing for a joint effect of sources 1,2 assuming no effects under the null
res3 &lt;- tcareg(data$X, tca.mdl, y, test = "custom", null_model = NULL,
alternative_model = c("1","2"))

</code></pre>


</div>