<div class="container">

<table style="width: 100%;"><tr>
<td>tk_tsfeatures</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Time series feature matrix (Tidy)</h2>

<h3>Description</h3>

<p><code>tk_tsfeatures()</code> is a tidyverse compliant wrapper for <code>tsfeatures::tsfeatures()</code>.
The function computes a matrix of time series features that describes the various time
series. It's designed for groupwise analysis using <code>dplyr</code> groups.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tk_tsfeatures(
  .data,
  .date_var,
  .value,
  .period = "auto",
  .features = c("frequency", "stl_features", "entropy", "acf_features"),
  .scale = TRUE,
  .trim = FALSE,
  .trim_amount = 0.1,
  .parallel = FALSE,
  .na_action = na.pass,
  .prefix = "ts_",
  .silent = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.data</code></td>
<td>
<p>A <code>tibble</code> or <code>data.frame</code> with a time-based column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.date_var</code></td>
<td>
<p>A column containing either date or date-time values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.value</code></td>
<td>
<p>A column containing numeric values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.period</code></td>
<td>
<p>The periodicity (frequency) of the time series data. Values can be provided as follows:
</p>

<ul>
<li>
<p> "auto" (default) Calculates using <code>tk_get_frequency()</code>.
</p>
</li>
<li>
<p> "2 weeks": Would calculate the median number of observations in a 2-week window.
</p>
</li>
<li>
<p> 7 (numeric): Would interpret the <code>ts</code> frequency as 7 observations per cycle (common for weekly data)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.features</code></td>
<td>
<p>Passed to <code>features</code> in the underlying <code>tsfeatures()</code> function.
A vector of function names that represent a feature aggregation function. Examples:
</p>

<ol>
<li>
<p> Use one of the function names from <code>tsfeatures</code> R package e.g.("lumpiness", "stl_features").
</p>
</li>
<li>
<p> Use a function name (e.g. "mean" or "median")
</p>
</li>
<li>
<p> Create your own function and provide the function name
</p>
</li>
</ol>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.scale</code></td>
<td>
<p>If <code>TRUE</code>, time series are scaled to mean 0 and sd 1 before features are computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.trim</code></td>
<td>
<p>If <code>TRUE</code>, time series are trimmed by trim_amount before features are computed.
Values larger than trim_amount in absolute value are set to <code>NA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.trim_amount</code></td>
<td>
<p>Default level of trimming if trim==TRUE. Default: 0.1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.parallel</code></td>
<td>
<p>If TRUE, multiple cores (or multiple sessions) will be used.
This only speeds things up when there are a large number of time series.
</p>
<p>When <code>.parallel = TRUE</code>, the <code>multiprocess = future::multisession</code>.
This can be adjusted by setting <code>multiprocess</code> parameter.
See the <code>tsfeatures::tsfeatures()</code> function for mor details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.na_action</code></td>
<td>
<p>A function to handle missing values. Use na.interp to estimate missing values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.prefix</code></td>
<td>
<p>A prefix to prefix the feature columns. Default: <code>"ts_"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.silent</code></td>
<td>
<p>Whether or not to show messages and warnings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments get passed to the feature functions.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>timetk::tk_tsfeatures()</code> function implements the <code>tsfeatures</code> package
for computing aggregated feature matrix for time series that is useful in many types of
analysis such as clustering time series.
</p>
<p>The <code>timetk</code> version ports the <code>tsfeatures::tsfeatures()</code> function to a <code>tidyverse</code>-compliant
format that uses a tidy data frame containing grouping columns (optional), a date column, and
a value column. Other columns are ignored.
</p>
<p>It then becomes easy to summarize each time series by group-wise application of <code>.features</code>,
which are simply functions that evaluate a time series and return single aggregated value.
(Example: "mean" would return the mean of the time series (note that values are scaled to mean 1 and sd 0 first))
</p>
<p><strong>Function Internals:</strong>
</p>
<p>Internally, the time series are converted to <code>ts</code> class using <code>tk_ts(.period)</code> where the
period is the frequency of the time series. Values can be provided for <code>.period</code>, which will be used
prior to convertion to <code>ts</code> class.
</p>
<p>The function then leverages <code>tsfeatures::tsfeatures()</code> to compute the feature matrix of summarized
feature values.
</p>


<h3>Value</h3>

<p>A <code>tibble</code> or <code>data.frame</code> with aggregated features that describe each time series.
</p>


<h3>References</h3>


<ol><li>
<p> Rob Hyndman, Yanfei Kang, Pablo Montero-Manso, Thiyanga Talagala, Earo Wang, Yangzhuoran Yang,
Mitchell O'Hara-Wild: tsfeatures R package
</p>
</li></ol>
<h3>Examples</h3>

<pre><code class="language-R">library(dplyr)

walmart_sales_weekly %&gt;%
    group_by(id) %&gt;%
    tk_tsfeatures(
      .date_var = Date,
      .value    = Weekly_Sales,
      .period   = 52,
      .features = c("frequency", "stl_features", "entropy", "acf_features", "mean"),
      .scale    = TRUE,
      .prefix   = "ts_"
    )

</code></pre>


</div>