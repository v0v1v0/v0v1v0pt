<div class="container">

<table style="width: 100%;"><tr>
<td>olc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate open-loop control</h2>

<h3>Description</h3>

<p>Simulate open-loop control with target-controlled infusion for a 'pkmod' object.
Infusion rates are calculated using 'pkmod_prior' to reach 'target_vals' at
'target_tms'. Data values are simulated using 'pkmod_true' at 'obs_tms'.
'pkmod_prior' and 'pkmod_true' do not need to have the same structure.
</p>


<h3>Usage</h3>

<pre><code class="language-R">olc(
  pkmod_prior,
  pkmod_true,
  target_vals,
  target_tms,
  obs_tms,
  type = c("effect", "plasma"),
  custom_alg = NULL,
  resp_bounds = NULL,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pkmod_prior</code></td>
<td>
<p>'pkmod' object describing a PK/PK-PD model that is used to calculate
TCI infusion rates and is updated as data are simulated and incorporated. Must have an
associated Omega matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pkmod_true</code></td>
<td>
<p>‘pkmod' object describing the patient’s "true" response. This model
will be used to simulate observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_vals</code></td>
<td>
<p>A vector of numeric values indicating PK or PD targets for TCI algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_tms</code></td>
<td>
<p>A vector of numeric values indicating times at which the TCI algorithm should
begin targeting each value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_tms</code></td>
<td>
<p>Times at which data values should be simulated from 'pkmod_true'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of TCI algorithm to be used. Options are "plasma" and "effect".
Defaults to "effect". Will be overwritten if 'custom_alg' is non-null.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>custom_alg</code></td>
<td>
<p>Custom TCI algorithm to overwrite default plasma- or effect-site targeting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp_bounds</code></td>
<td>
<p>Optional vector of two values indicating minimum and maximum values possible for the response.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>An integer used to initialize the random number generator.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">pkmod_prior &lt;- pkmod(pars_pk = c(cl = 10, q2 = 2, q3 =20, v = 15, v2 = 30, v3 = 50, ke0 = 1.2))
pkmod_true  &lt;- pkmod(pars_pk = c(cl = 16, q2 = 4, q3 =10, v = 20, v2 = 20, v3 = 80, ke0 = 0.8),
sigma_add = 0.1, log_response = TRUE)
target_vals &lt;- c(2,3,4,3,3)
target_tms &lt;- c(0,5,10,36,60)
obs_tms &lt;- c(1,2,4,8,12,16,24,36,48)
sim &lt;- olc(pkmod_prior, pkmod_true, target_vals, target_tms, obs_tms)
len &lt;- 500
tms &lt;- seq(0,60,length.out = len)
df &lt;- data.frame(time = rep(tms,2),
                 value = c(predict(pkmod_true, sim$inf,tms)[,1],
                 predict(pkmod_prior, sim$inf,tms)[,1]),
                 type = c(rep("true",len),rep("prior",len)))
library(ggplot2)
ggplot(df, aes(x = time, y = value, color = type)) +
  geom_step(data = data.frame(time = target_tms, value = target_vals),
  aes(x = time, y = value), inherit.aes = FALSE) +
  geom_line() +
  geom_point(data = sim$obs, aes(x = time, y = obs), inherit.aes = FALSE)
</code></pre>


</div>