<div class="container">

<table style="width: 100%;"><tr>
<td>tq_mutate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mutates quantitative data</h2>

<h3>Description</h3>

<p><code>tq_mutate()</code> adds new variables to an existing tibble;
<code>tq_transmute()</code> returns only newly created columns and is typically
used when periodicity changes
</p>


<h3>Usage</h3>

<pre><code class="language-R">tq_mutate(
  data,
  select = NULL,
  mutate_fun,
  col_rename = NULL,
  ohlc_fun = NULL,
  ...
)

tq_mutate_(data, select = NULL, mutate_fun, col_rename = NULL, ...)

tq_mutate_xy(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_mutate_xy_(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_mutate_fun_options()

tq_transmute(
  data,
  select = NULL,
  mutate_fun,
  col_rename = NULL,
  ohlc_fun = NULL,
  ...
)

tq_transmute_(data, select = NULL, mutate_fun, col_rename = NULL, ...)

tq_transmute_xy(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_transmute_xy_(data, x, y = NULL, mutate_fun, col_rename = NULL, ...)

tq_transmute_fun_options()
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>tibble</code> (tidy data frame) of data typically from <code>tq_get()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select</code></td>
<td>
<p>The columns to send to the mutation function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mutate_fun</code></td>
<td>
<p>The mutation function from either the <code>xts</code>,
<code>quantmod</code>, or <code>TTR</code> package. Execute <code>tq_mutate_fun_options()</code>
to see the full list of options by package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_rename</code></td>
<td>
<p>A string or character vector containing names that can be used
to quickly rename columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ohlc_fun</code></td>
<td>
<p>Deprecated. Use <code>select</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters passed to the appropriate mutatation
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x, y</code></td>
<td>
<p>Parameters used with <code style="white-space: pre;">⁠_xy⁠</code> that consist of column names of variables
to be passed to the mutatation function (instead of OHLC functions).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>tq_mutate</code> and <code>tq_transmute</code> are very flexible wrappers for various <code>xts</code>,
<code>quantmod</code> and <code>TTR</code> functions. The main advantage is the
results are returned as a <code>tibble</code> and the
function can be used with the <code>tidyverse</code>. <code>tq_mutate</code> is used when additional
columns are added to the return data frame. <code>tq_transmute</code> works exactly like <code>tq_mutate</code>
except it only returns the newly created columns. This is helpful when
changing periodicity where the new columns would not have the same number of rows
as the original tibble.
</p>
<p><code>select</code> specifies the columns that get passed to the mutation function. Select works
as a more flexible version of the OHLC extractor functions from <code>quantmod</code> where
non-OHLC data works as well. When <code>select</code> is <code>NULL</code>, all columns are selected.
In Example 1 below, <code>close</code> returns the "close" price and sends this to the
mutate function, <code>periodReturn</code>.
</p>
<p><code>mutate_fun</code> is the function that performs the work. In Example 1, this
is <code>periodReturn</code>, which calculates the period returns. The <code>...</code>
are additional arguments passed to the <code>mutate_fun</code>. Think of
the whole operation in Example 1 as the close price, obtained by <code>select = close</code>,
being sent to the <code>periodReturn</code> function along
with additional arguments defining how to perform the period return, which
includes <code>period = "daily"</code> and <code>type = "log"</code>.
Example 4 shows how to apply a rolling regression.
</p>
<p><code>tq_mutate_xy</code> and <code>tq_transmute_xy</code> are designed to enable working with mutatation
functions that require two primary inputs (e.g. EVWMA, VWAP, etc).
Example 2 shows this benefit in action: using the EVWMA function that uses
volume to define the moving average period.
</p>
<p><code>tq_mutate_</code>, <code>tq_mutate_xy_</code>, <code>tq_transmute_</code>, and <code>tq_transmute_xy_</code>
are setup for Non-Standard
Evaluation (NSE). This enables programatically changing column names by modifying
the text representations. Example 5 shows the difference in implementation.
Note that character strings are being passed to the variables instead of
unquoted variable names. See <code>vignette("nse")</code> for more information.
</p>
<p><code>tq_mutate_fun_options</code> and <code>tq_transmute_fun_options</code> return a list of various
financial functions that are compatible with <code>tq_mutate</code> and <code>tq_transmute</code>,
respectively.
</p>


<h3>Value</h3>

<p>Returns mutated data in the form of a <code>tibble</code> object.
</p>


<h3>See Also</h3>

<p><code>tq_get()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load libraries
library(dplyr)

##### Basic Functionality

fb_stock_prices  &lt;- tidyquant::FANG %&gt;%
    filter(symbol == "META") %&gt;%
        filter(
            date &gt;= "2016-01-01",
            date &lt;= "2016-12-31"
        )

goog_stock_prices  &lt;- FANG %&gt;%
    filter(symbol == "GOOG") %&gt;%
        filter(
            date &gt;= "2016-01-01",
            date &lt;= "2016-12-31"
        )

# Example 1: Return logarithmic daily returns using periodReturn()
fb_stock_prices %&gt;%
    tq_mutate(select = close, mutate_fun = periodReturn,
              period = "daily", type = "log")

# Example 2: Use tq_mutate_xy to use functions with two columns required
fb_stock_prices %&gt;%
    tq_mutate_xy(x = close, y = volume, mutate_fun = EVWMA,
                 col_rename = "EVWMA")

# Example 3: Using tq_mutate to work with non-OHLC data
tq_get("DCOILWTICO", get = "economic.data") %&gt;%
    tq_mutate(select = price, mutate_fun = lag.xts, k = 1, na.pad = TRUE)

# Example 4: Using tq_mutate to apply a rolling regression
fb_returns &lt;- fb_stock_prices %&gt;%
    tq_transmute(adjusted, periodReturn, period = "monthly", col_rename = "fb.returns")
goog_returns &lt;- goog_stock_prices %&gt;%
    tq_transmute(adjusted, periodReturn, period = "monthly", col_rename = "goog.returns")
returns_combined &lt;- left_join(fb_returns, goog_returns, by = "date")
regr_fun &lt;- function(data) {
    coef(lm(fb.returns ~ goog.returns, data = as_tibble(data)))
}
returns_combined %&gt;%
    tq_mutate(mutate_fun = rollapply,
              width      = 6,
              FUN        = regr_fun,
              by.column  = FALSE,
              col_rename = c("coef.0", "coef.1"))

# Example 5: Non-standard evaluation:
# Programming with tq_mutate_() and tq_mutate_xy_()
col_name &lt;- "adjusted"
mutate &lt;- c("MACD", "SMA")
tq_mutate_xy_(fb_stock_prices, x = col_name, mutate_fun = mutate[[1]])
</code></pre>


</div>